import{r as x,j as e,n as g,o as W,p as Z,u as Q,I as i,B as h,P as O,O as p,v as _,w as ee,x as M,y as c,z as se,A as o,ah as te,aA as ae,ad as le,G as re,J as ne,ac as ie,D as ce,f as oe,h as de,l as me,e as ue,K as n,V as R,W as U,X as V,Y as H,Z as N,U as xe,k as he,a8 as pe}from"./index-CewaSTRD.js";import{T as je,a as ge,b}from"./tabs-b2piEQ7z.js";import{f as y}from"./exportUtils-B5u6ZY-6.js";import{S as Ne}from"./save-CV1km07e.js";import"./currencyUtils-RmnVW5tT.js";const Te=({project:d,settings:v,onProjectUpdate:I,userRole:be})=>{var L;const[G,m]=x.useState("0"),[X,f]=x.useState(!1),[A,w]=x.useState(null),[S,Y]=x.useState(""),[a,j]=x.useState({id:"",subcontractorId:"",billNumber:"",description:"",netAmount:0,grossAmount:0,date:new Date().toISOString().split("T")[0],periodFrom:"",periodTo:"",status:"Draft",retentionPercent:0,items:[]}),[D,C]=x.useState(!1),F=((L=d.agencies)==null?void 0:L.filter(s=>s.type==="subcontractor"))||[],u=d.subcontractorBills||[],P=u.filter(s=>{var B,E;if(!S)return!0;const t=S.toLowerCase(),l=F.find(K=>K.id===s.subcontractorId);return s.description.toLowerCase().includes(t)||(l==null?void 0:l.name.toLowerCase().includes(t))||!1||((B=s.billNumber)==null?void 0:B.toLowerCase().includes(t))||((E=s.subcontractorId)==null?void 0:E.toLowerCase().includes(t))}),r=(s,t)=>{j(l=>({...l,[s]:t}))},k=()=>{var s;j({id:`bill-${Date.now()}`,subcontractorId:"",billNumber:`SB-${(((s=d.subcontractorBills)==null?void 0:s.length)||0)+1}`,description:"",netAmount:0,grossAmount:0,date:new Date().toISOString().split("T")[0],periodFrom:"",periodTo:"",status:"Draft",retentionPercent:0,items:[]}),C(!0),f(!0)},$=s=>{j({...s}),w(s),C(!0),f(!0)},q=s=>{var t;if(window.confirm("Are you sure you want to delete this bill?")){const l={...d,subcontractorBills:((t=d.subcontractorBills)==null?void 0:t.filter(B=>B.id!==s))||[]};I(l)}},J=()=>{var t;const s={...d};D&&(A!=null&&A.id)?s.subcontractorBills=((t=s.subcontractorBills)==null?void 0:t.map(l=>l.id===A.id?{...a}:l))||[]:s.subcontractorBills=[...d.subcontractorBills||[],a],I(s),f(!1),j({id:"",subcontractorId:"",description:"",date:new Date().toISOString().split("T")[0],status:"Draft"}),w(null),C(!1)},z=()=>{f(!1),j({id:"",subcontractorId:"",billNumber:"",description:"",netAmount:0,grossAmount:0,date:new Date().toISOString().split("T")[0],periodFrom:"",periodTo:"",status:"Draft",retentionPercent:0,items:[]}),w(null),C(!1)},T={totalBills:u.length,totalAmount:u.reduce((s,t)=>s+t.netAmount,0),pendingAmount:u.filter(s=>s.status==="Submitted").reduce((s,t)=>s+t.netAmount,0),approvedAmount:u.filter(s=>s.status==="Approved").reduce((s,t)=>s+t.netAmount,0),paidAmount:u.filter(s=>s.status==="Paid").reduce((s,t)=>s+t.netAmount,0)};return e.jsxs("div",{className:"h-[calc(100vh-140px)] flex gap-3",children:[e.jsxs(g,{className:"w-80 rounded-xl flex flex-col overflow-hidden border",children:[e.jsxs(W,{className:"pb-4 border-b border-slate-100 bg-slate-50",children:[e.jsx(Z,{className:"text-lg font-extrabold",children:"Subcontractor Billing"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage subcontractor bills and payments"}),e.jsxs("div",{className:"relative mt-4",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(i,{placeholder:"Search bills...",value:S,onChange:s=>Y(s.target.value),className:"pl-10"})]}),e.jsxs(h,{className:"w-full mt-4 rounded-xl",onClick:k,children:[e.jsx(O,{size:18,className:"mr-2"}),"New Bill"]})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-auto",children:[e.jsx("h3",{className:"text-sm font-bold mb-4",children:"BILLING SUMMARY"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(g,{className:"p-4 text-center bg-slate-50",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Total Bills"}),e.jsx("p",{className:"text-lg font-bold",children:T.totalBills})]}),e.jsxs(g,{className:"p-4 text-center bg-slate-50",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Total Amount"}),e.jsx("p",{className:"text-lg font-bold",children:y(T.totalAmount,v)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsxs(g,{className:"p-4 text-center bg-slate-50",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Pending"}),e.jsx("p",{className:"text-lg font-bold text-yellow-600",children:y(T.pendingAmount,v)})]}),e.jsxs(g,{className:"p-4 text-center bg-slate-50",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Paid"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:y(T.paidAmount,v)})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-bold mb-3",children:"STATUS FILTERS"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(p,{variant:"outline",className:"cursor-pointer",onClick:()=>m("0"),children:"All"}),e.jsx(p,{variant:"outline",className:"cursor-pointer",onClick:()=>m("1"),children:"Draft"}),e.jsx(p,{variant:"outline",className:"cursor-pointer",onClick:()=>m("2"),children:"Submitted"}),e.jsx(p,{variant:"outline",className:"cursor-pointer",onClick:()=>m("3"),children:"Approved"}),e.jsx(p,{variant:"outline",className:"cursor-pointer",onClick:()=>m("4"),children:"Paid"})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx(je,{value:G,onValueChange:m,className:"border-b",children:e.jsxs(ge,{children:[e.jsx(b,{value:"0",children:"All Bills"}),e.jsx(b,{value:"1",children:"Drafts"}),e.jsx(b,{value:"2",children:"Pending"}),e.jsx(b,{value:"3",children:"Approved"}),e.jsx(b,{value:"4",children:"Paid"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs(_,{children:[e.jsx(ee,{children:e.jsxs(M,{children:[e.jsx(c,{children:"Bill #"}),e.jsx(c,{children:"Subcontractor"}),e.jsx(c,{children:"Description"}),e.jsx(c,{className:"text-right",children:"Net Amount"}),e.jsx(c,{children:"Date"}),e.jsx(c,{children:"Period To"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Actions"})]})}),e.jsx(se,{children:P.map(s=>{const t=F.find(l=>l.id===s.subcontractorId);return e.jsxs(M,{children:[e.jsx(o,{children:e.jsx("div",{className:"font-medium",children:s.billNumber||"N/A"})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-6 h-6",children:e.jsx(ae,{children:e.jsx(le,{size:14})})}),e.jsx("span",{className:"text-sm",children:(t==null?void 0:t.name)||"Unknown"})]})}),e.jsx(o,{children:e.jsxs("div",{className:"text-sm max-w-xs truncate",title:s.description,children:[s.description.substring(0,30),s.description.length>30?"...":""]})}),e.jsx(o,{className:"text-right",children:e.jsx("div",{className:"font-medium",children:y(s.netAmount,v)})}),e.jsx(o,{children:e.jsx("div",{className:"text-sm",children:s.date})}),e.jsx(o,{children:e.jsx("div",{className:"text-sm",children:s.periodTo||"N/A"})}),e.jsx(o,{children:e.jsx(p,{variant:s.status==="Draft"?"secondary":s.status==="Submitted"||s.status==="Approved"||s.status==="Paid"?"default":"secondary",children:s.status})}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(h,{size:"sm",variant:"outline",onClick:()=>$(s),children:e.jsx(re,{size:16})}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>q(s.id),children:e.jsx(ne,{size:16})})]})})]},s.id)})})]}),P.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(ie,{size:60,className:"mx-auto mb-4 opacity-30"}),e.jsx("h3",{className:"text-lg font-bold",children:"No bills found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:S?"No bills match your search":"Create your first subcontractor bill to get started"}),e.jsxs(h,{className:"mt-4 rounded-xl",onClick:k,children:[e.jsx(O,{size:16,className:"mr-2"}),"Create New Bill"]})]})]})]}),e.jsxs(ce,{open:X,onOpenChange:z,children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"text-indigo-600",size:20}),D?"Edit Bill":"Create New Bill"]})}),e.jsx(ue,{className:"max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"subcontractor-select",children:"Subcontractor"}),e.jsxs(R,{value:a.subcontractorId||"",onValueChange:s=>r("subcontractorId",s),children:[e.jsx(U,{children:e.jsx(V,{placeholder:"Select subcontractor"})}),e.jsx(H,{children:F.map(s=>e.jsx(N,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"bill-number",children:"Bill Number"}),e.jsx(i,{id:"bill-number",value:a.billNumber||"",onChange:s=>r("billNumber",s.target.value),placeholder:"Enter bill number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"gross-amount",children:"Gross Amount"}),e.jsx(i,{id:"gross-amount",type:"number",value:a.grossAmount||0,onChange:s=>r("grossAmount",parseFloat(s.target.value)||0),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"net-amount",children:"Net Amount"}),e.jsx(i,{id:"net-amount",type:"number",value:a.netAmount||0,onChange:s=>r("netAmount",parseFloat(s.target.value)||0),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"retention-percent",children:"Retention (%)"}),e.jsx(i,{id:"retention-percent",type:"number",value:a.retentionPercent||0,onChange:s=>r("retentionPercent",parseFloat(s.target.value)||0),placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"bill-date",children:"Bill Date"}),e.jsx(i,{id:"bill-date",type:"date",value:a.date||"",onChange:s=>r("date",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"period-from",children:"Period From"}),e.jsx(i,{id:"period-from",type:"date",value:a.periodFrom||"",onChange:s=>r("periodFrom",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"period-to",children:"Period To"}),e.jsx(i,{id:"period-to",type:"date",value:a.periodTo||"",onChange:s=>r("periodTo",s.target.value)})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(n,{htmlFor:"bill-description",children:"Description"}),e.jsx(xe,{id:"bill-description",value:a.description||"",onChange:s=>r("description",s.target.value),placeholder:"Enter bill description",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"bill-status",children:"Status"}),e.jsxs(R,{value:a.status||"Draft",onValueChange:s=>r("status",s),children:[e.jsx(U,{children:e.jsx(V,{placeholder:"Select status"})}),e.jsxs(H,{children:[e.jsx(N,{value:"Draft",children:"Draft"}),e.jsx(N,{value:"Submitted",children:"Submitted"}),e.jsx(N,{value:"Approved",children:"Approved"}),e.jsx(N,{value:"Paid",children:"Paid"})]})]})]})]})}),e.jsxs(he,{className:"bg-muted/50",children:[e.jsxs(h,{variant:"outline",onClick:z,children:[e.jsx(pe,{size:16,className:"mr-2"}),"Cancel"]}),e.jsxs(h,{onClick:J,disabled:!a.subcontractorId||!a.description||a.netAmount===0,children:[e.jsx(Ne,{size:16,className:"mr-2"}),D?"Update Bill":"Create Bill"]})]})]})]})};export{Te as default};
