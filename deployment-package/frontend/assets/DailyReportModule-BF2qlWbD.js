import{c as de,r as l,a5 as z,j as e,B as c,D as oe,e as he,f as xe,h as me,v as je,w as ue,x as V,y as g,z as pe,A as v,C as ge,n as m,K as d,I as j,V as _,W as k,X as D,Y as T,Z as x,a0 as Q,av as ve,a1 as H,a2 as U,o as Ne,p as fe,ad as be,t as ye,R as we,J,P as R,aw as Ce,ax as Se,ac as _e,U as I,au as ke}from"./index-CewaSTRD.js";import{T as De,a as Te,b as P,c as E}from"./tabs-b2piEQ7z.js";import{P as Y}from"./printer-DtXb5IMq.js";import{W as Re}from"./wifi-gGBct8gZ.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=de("CloudSun",[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z",key:"s09mg5"}]]),Qe=({project:h,userRole:M,onProjectUpdate:Pe})=>{const[N,Z]=l.useState(new Date().toISOString().split("T")[0]),[A,W]=l.useState("Sunny"),[G,K]=l.useState(0),[X,y]=l.useState(!1),[$,B]=l.useState(!1),[Ee,ee]=l.useState({reportDate:"",submittedBy:"",receivedBy:"",workItems:[]}),[o,f]=l.useState([]),[Me,se]=l.useState(navigator.onLine),[L,Ae]=l.useState(""),[O,We]=l.useState(""),[q,Be]=l.useState(""),[u,b]=l.useState([{id:Date.now().toString(),name:"",organization:""}]),[Le,Oe]=l.useState([{id:Date.now().toString(),material:"",stockQty:"",deliverQty:"",consumeQty:""}]),[w,F]=l.useState([""]),[C,ae]=l.useState(""),[S,te]=l.useState("");l.useEffect(()=>{const s=()=>{se(navigator.onLine)};return window.addEventListener("online",s),window.addEventListener("offline",s),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",s)}},[]);const ne=()=>{const s={id:Date.now().toString(),location:"",quantity:0,description:""};f([...o,s])},ie=async()=>{var s,n,a,t;B(!0);try{const r=((n=(s=h.staffLocations)==null?void 0:s[0])==null?void 0:n.latitude)||27.66,i=((t=(a=h.staffLocations)==null?void 0:a[0])==null?void 0:t.longitude)||83.465;W("Sunny")}finally{B(!1)}},p=(s,n,a)=>{const t=[...o];t[s]={...t[s],[n]:a},f(t)},le=M===z.ADMIN||M===z.PROJECT_MANAGER,re=s=>{if(!le){alert("Only Admin and Project Manager can delete daily work entries");return}f(o.filter((n,a)=>a!==s))},ce=()=>{let s=!0;const n={reportDate:N?"":"Report date is required",submittedBy:C?"":"Submitted by is required",receivedBy:S?"":"Received by is required",workItems:Array(o.length).fill({})};o.forEach((a,t)=>{var i;const r={};(i=a.description)!=null&&i.trim()||(r.description="Description is required",s=!1),a.assetId||(r.assetId="Structure is required",s=!1),a.componentId||(r.componentId="Component is required",s=!1),a.quantity<=0&&(r.quantity="Quantity must be greater than 0",s=!1),n.workItems[t]=r}),ee(n),alert(s?"Report submitted. Physical progress updated in linked assets and BOQ ledger.":"Please fix the validation errors before submitting.")};return e.jsxs("div",{className:"animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex justify-between mb-4 items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-foreground",children:"Daily Site Operations (DPR)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Execution logging and resource allocation oversight"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",onClick:()=>y(!0),className:"rounded-lg",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Print Official Form"]}),e.jsx(oe,{open:X,onOpenChange:y,children:e.jsxs(he,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsx(me,{children:"Daily Site Report - Print Preview"})}),e.jsxs("div",{className:"p-6 print-container",children:[e.jsxs("div",{className:"flex justify-between mb-6 pb-4 border-b-2 border-black",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"DAILY SITE REPORT"}),e.jsxs("h2",{className:"text-xl text-muted-foreground",children:["Project: ",h.name]}),e.jsxs("p",{className:"text-sm",children:["Report Date: ",N]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm",children:["Report No: DPR-",N.replace(/-/g,"")]}),e.jsxs("p",{className:"text-sm",children:["Location: ",h.location]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Weather Conditions"}),e.jsxs("p",{className:"text-base",children:["Condition: ",A]}),L&&e.jsxs("p",{className:"text-base",children:["Rainfall: ",L," mm"]}),(O||q)&&e.jsxs("p",{className:"text-base",children:["Temperature: Min ",O||"N/A","°C / Max ",q||"N/A","°C"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Project Team Present"}),e.jsx("p",{className:"text-base",children:"Site Engineer: N/A"}),e.jsxs("p",{className:"text-base",children:["Project Manager: ",h.projectManager||"N/A"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Execution Logging"}),e.jsxs(je,{children:[e.jsx(ue,{children:e.jsxs(V,{children:[e.jsx(g,{children:"Structure"}),e.jsx(g,{children:"Component"}),e.jsx(g,{children:"Description"}),e.jsx(g,{children:"Quantity"}),e.jsx(g,{children:"Location (Chainage)"})]})}),e.jsx(pe,{children:o.map((s,n)=>{var r;const a=(r=h.structures)==null?void 0:r.find(i=>i.id===s.assetId),t=a==null?void 0:a.components.find(i=>i.id===s.componentId);return e.jsxs(V,{children:[e.jsx(v,{children:(a==null?void 0:a.name)||""}),e.jsx(v,{children:(t==null?void 0:t.name)||""}),e.jsx(v,{children:s.description}),e.jsx(v,{children:s.quantity}),e.jsx(v,{children:s.location})]},s.id)})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-8",children:[e.jsxs("div",{className:"text-center pt-16",children:[e.jsx("div",{className:"h-16 border border-gray-400 w-4/5 mx-auto mb-2"}),e.jsx("p",{className:"text-base",children:"Submitted By (Contractor)"}),e.jsx("p",{className:"text-xs",children:C||"_________________________"})]}),e.jsxs("div",{className:"text-center pt-16",children:[e.jsx("div",{className:"h-16 border border-gray-400 w-4/5 mx-auto mb-2"}),e.jsx("p",{className:"text-base",children:"Received By (Engineer)"}),e.jsx("p",{className:"text-xs",children:S||"_________________________"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(c,{onClick:()=>y(!1),children:"Close"}),e.jsxs(c,{onClick:()=>window.print(),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Print Report"]})]})]})}),e.jsxs(c,{variant:"default",onClick:ce,className:"rounded-lg",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Submit & Sync Data"]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full bg-green-100 text-green-800",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Online"})]})]})]}),e.jsx(m,{className:"p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"report-date",children:"Site Date"}),e.jsx(j,{id:"report-date",type:"date",value:N,onChange:s=>Z(s.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{value:A,onValueChange:W,children:[e.jsx(k,{children:e.jsx(D,{placeholder:"Weather Context"})}),e.jsxs(T,{children:[e.jsx(x,{value:"Sunny",children:"Clear / Sunny"}),e.jsx(x,{value:"Cloudy",children:"Partly Cloudy"}),e.jsx(x,{value:"Rainy",children:"Inclement Weather (Rainy)"}),e.jsx(x,{value:"Foggy",children:"Low Visibility (Foggy)"}),e.jsx(x,{value:"Windy",children:"Windy"}),e.jsx(x,{value:"Dusty",children:"Dusty"})]})]}),e.jsx(c,{variant:"outline",size:"icon",onClick:ie,disabled:$,children:e.jsx(Ie,{className:"w-5 h-5"})})]}),e.jsxs(Q,{children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx(H,{children:"Info"}),e.jsx(U,{children:"Linked DPR entries update structural asset progress and BOQ completion."})]})]})}),e.jsxs(m,{className:"p-6 mb-6",children:[e.jsx(Ne,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Visitors on Site"]})}),e.jsx(ye,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:u.map((s,n)=>e.jsxs(we.Fragment,{children:[e.jsxs("div",{className:"md:col-span-5",children:[e.jsx(d,{children:"Name"}),e.jsx(j,{value:s.name,onChange:a=>{const t=[...u];t[n]={...t[n],name:a.target.value},b(t)}})]}),e.jsxs("div",{className:"md:col-span-5",children:[e.jsx(d,{children:"Organization"}),e.jsx(j,{value:s.organization,onChange:a=>{const t=[...u];t[n]={...t[n],organization:a.target.value},b(t)}})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[n>0&&e.jsx(c,{variant:"destructive",size:"icon",onClick:()=>b(u.filter((a,t)=>t!==n)),children:e.jsx(J,{className:"w-4 h-4"})}),n===u.length-1&&e.jsx(c,{variant:"outline",size:"icon",onClick:()=>b([...u,{id:Date.now().toString(),name:"",organization:""}]),children:e.jsx(R,{className:"w-4 h-4"})})]})]},s.id))})})]}),e.jsx(m,{className:"overflow-hidden",children:e.jsxs(De,{value:G.toString(),onValueChange:s=>K(parseInt(s)),className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-3",children:[e.jsxs(P,{value:"0",className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Execution Logging"]}),e.jsxs(P,{value:"1",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Manpower & Fleet"]}),e.jsxs(P,{value:"2",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Description & Remarks"]})]}),e.jsx(E,{value:"0",className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[o.map((s,n)=>{var r;const a=(r=h.structures)==null?void 0:r.find(i=>i.id===s.assetId),t=(a==null?void 0:a.components)||[];return e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:[e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Target Structure"}),e.jsxs(_,{value:s.assetId||"",onValueChange:i=>p(n,"assetId",i),children:[e.jsx(k,{children:e.jsx(D,{placeholder:"Select structure"})}),e.jsx(T,{children:(h.structures||[]).map(i=>e.jsx(x,{value:i.id,children:i.name},i.id))})]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Component"}),e.jsxs(_,{value:s.componentId||"",onValueChange:i=>p(n,"componentId",i),disabled:!s.assetId,children:[e.jsx(k,{children:e.jsx(D,{placeholder:"Select component"})}),e.jsx(T,{children:t.map(i=>e.jsx(x,{value:i.id,children:i.name},i.id))})]})]})]}),e.jsxs("div",{className:"md:col-span-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Detailed Work Description"}),e.jsx(I,{value:s.description,onChange:i=>p(n,"description",i.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Qty"}),e.jsx(j,{type:"number",value:s.quantity,onChange:i=>p(n,"quantity",Number(i.target.value))})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Chainage"}),e.jsx(j,{value:s.location,onChange:i=>p(n,"location",i.target.value)})]})]})]}),e.jsx("div",{className:"md:col-span-2 flex justify-end items-center",children:e.jsx(c,{variant:"destructive",size:"icon",onClick:()=>re(n),children:e.jsx(J,{className:"w-4 h-4"})})})]})},s.id)}),e.jsxs(c,{variant:"outline",onClick:ne,className:"w-full border-dashed",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Add Another Entry"]})]})}),e.jsxs(E,{value:"1",className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Manpower & Fleet Tracking"}),e.jsxs(Q,{children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx(H,{children:"Coming Soon"}),e.jsx(U,{children:"Manpower and fleet tracking functionality coming soon."})]})]}),e.jsxs(E,{value:"2",className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Description of Works Done & Remarks"}),e.jsxs(m,{className:"p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Description of Works Done"}),e.jsx(I,{placeholder:"Sample collection for Test performance, etc.",value:o.map(s=>s.description).join(`
`),onChange:s=>{const n=s.target.value.split(`
`),a=[...o];for(let t=0;t<a.length;t++)n[t]&&(a[t]={...a[t],description:n[t]});f(a)},rows:4})]}),e.jsxs(m,{className:"p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Remarks"}),w.map((s,n)=>e.jsx("div",{className:"mb-4",children:e.jsx(I,{placeholder:`Remark ${n+1}...`,value:s,onChange:a=>{const t=[...w];t[n]=a.target.value,F(t)},rows:2})},n)),e.jsxs(c,{variant:"outline",onClick:()=>F([...w,""]),children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Add Remark"]})]}),e.jsxs(m,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Submission"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Submitted By (Contractor)"}),e.jsx(j,{value:C,onChange:s=>ae(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Received By (Engineer)"}),e.jsx(j,{value:S,onChange:s=>te(s.target.value)})]})]})]})]})]})})]})};export{Qe as default};
