import{c as me,r as t,j as e,B as n,aI as $,ac as Ae,n as r,t as o,u as Fe,I as D,V as T,W as k,X as I,Y as R,Z as p,aJ as J,v as K,w as Z,x as j,y as x,z as _,A as h,O as M,T as Q,E as X,F as Y,H as ee,J as Te,a6 as se,ab as te,P as ae,aK as ke,ag as Ie,a0 as Re,a1 as Me,a2 as Oe,D as le,e as ne,f as re,h as ie,i as oe,K as C,k as ce,Q as Le,aC as Ee}from"./index-CewaSTRD.js";import{a as ze}from"./geminiService-BRShGGEe.js";import{T as Ue,a as Be,b as P,c as A}from"./tabs-b2piEQ7z.js";import{U as Ve}from"./upload-CcYQvXh5.js";import{F as Ge,E as He}from"./folder-BKxSgyFR.js";import{I as de}from"./image-Bteq2faF.js";import{B as he}from"./book-open-BI8Hswt2.js";import{F as We}from"./file-spreadsheet-B5YUu3jb.js";import{C as qe}from"./cloud-DTtErTyH.js";import{P as $e}from"./printer-DtXb5IMq.js";import{S as Je}from"./sparkles-CWxKTUax.js";import"./exportUtils-B5u6ZY-6.js";import"./currencyUtils-RmnVW5tT.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=me("CloudRain",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=me("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),bs=({project:l,userRole:O,onProjectUpdate:xe})=>{const[ue,L]=t.useState("documents"),[je,_e]=t.useState(l.documents||[]),[g,pe]=t.useState(""),[f,ge]=t.useState("All"),[fe,N]=t.useState(!1),[m,w]=t.useState({name:"",description:"",folder:"General"}),[E,z]=t.useState(null);t.useRef(null);const[Ne,Qe]=t.useState(l.sitePhotos||[]),[v,we]=t.useState("All"),[ve,y]=t.useState(!1),[u,U]=t.useState(null),[B,V]=t.useState(!1),ye=t.useRef(null),[F,Xe]=t.useState(l.dailyReports||[]),[Ye,es]=t.useState(new Date().toISOString().split("T")[0]),[ss,ts]=t.useState("Sunny"),[as,ls]=t.useState(!1),[ns,be]=t.useState(navigator.onLine),[rs,is]=t.useState(new Date().toISOString().slice(0,7)),[os,cs]=t.useState(!1),G=["General","Contracts","Drawings","Reports","Correspondence","Financials","Sub-Docs"],Se=["General","Earthwork","Structures","Pavement","Safety"];t.useEffect(()=>{const s=()=>be(navigator.onLine);return window.addEventListener("online",s),window.addEventListener("offline",s),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",s)}},[]);const H=t.useMemo(()=>(l.documents||[]).filter(s=>{var d;const a=s.name.toLowerCase().includes(g.toLowerCase())||((d=s.description)==null?void 0:d.toLowerCase().includes(g.toLowerCase())),c=f==="All"||s.folder===f;return a&&c}),[l.documents,g,f]),W=t.useMemo(()=>(l.sitePhotos||[]).filter(s=>v==="All"||s.category===v),[l.sitePhotos,v]),b=t.useMemo(()=>{var s,a,c,d;return{total:((s=l.documents)==null?void 0:s.length)||0,contracts:((a=l.documents)==null?void 0:a.filter(i=>i.folder==="Contracts").length)||0,drawings:((c=l.documents)==null?void 0:c.filter(i=>i.folder==="Drawings").length)||0,reports:((d=l.documents)==null?void 0:d.filter(i=>i.folder==="Reports").length)||0}},[l.documents]),S=t.useMemo(()=>{var s,a,c,d;return{total:((s=l.sitePhotos)==null?void 0:s.length)||0,today:((a=l.sitePhotos)==null?void 0:a.filter(i=>new Date(i.date).toDateString()===new Date().toDateString()).length)||0,earthwork:((c=l.sitePhotos)==null?void 0:c.filter(i=>i.category==="Earthwork").length)||0,structures:((d=l.sitePhotos)==null?void 0:d.filter(i=>i.category==="Structures").length)||0}},[l.sitePhotos]),De=async()=>{if(!E)return;const s=E,a=new FileReader;a.onload=async c=>{var q;const d=(q=c.target)==null?void 0:q.result,i={id:`doc-${Date.now()}`,name:m.name||s.name,type:s.type,date:new Date().toISOString(),size:String(s.size),folder:m.folder,subject:m.name||s.name,uploadDate:new Date().toISOString(),uploadedBy:O,tags:[],fileUrl:d,description:m.description,currentVersion:1,versions:[],createdBy:O.toString(),lastModified:new Date().toISOString(),status:"Active",comments:[]},Pe=[...l.documents||[],i];xe({...l,documents:Pe}),w({name:"",description:"",folder:"General"}),z(null),N(!1)},a.readAsDataURL(s)},Ce=async s=>{V(!0);try{const a=await ze(s.url,s.category||"General");U({...s,caption:`${s.caption}

AI Analysis: ${a}`})}catch(a){console.error("Photo analysis failed:",a),alert("AI Photo analysis failed. Please try again.")}finally{V(!1)}};return e.jsxs("div",{className:"p-4 h-[calc(100vh-140px)] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between mb-4 items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Documentation Hub"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Unified document, photo, and reporting management"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",onClick:()=>N(!0),children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"})," Upload Document"]}),e.jsxs(n,{variant:"outline",onClick:()=>y(!0),children:[e.jsx($,{className:"mr-2 h-4 w-4"})," Add Photo"]}),e.jsxs(n,{onClick:()=>L("daily-reports"),children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"})," New Daily Report"]})]})]}),e.jsx(r,{children:e.jsxs(Ue,{value:ue,onValueChange:L,children:[e.jsxs(Be,{className:"grid w-full grid-cols-4 h-12",children:[e.jsxs(P,{value:"documents",children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"})," Documents (",je.length,")"]}),e.jsxs(P,{value:"site-photos",children:[e.jsx(de,{className:"mr-2 h-4 w-4"})," Site Photos (",Ne.length,")"]}),e.jsxs(P,{value:"daily-reports",children:[e.jsx(he,{className:"mr-2 h-4 w-4"})," Daily Reports (",F.length,")"]}),e.jsxs(P,{value:"mpr-reports",children:[e.jsx(We,{className:"mr-2 h-4 w-4"})," MPR Reports"]})]}),e.jsxs(A,{value:"documents",className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsx(r,{children:e.jsxs(o,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Total Documents"}),e.jsx("p",{className:"text-2xl font-bold",children:b.total})]})}),e.jsx(r,{children:e.jsxs(o,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Contracts"}),e.jsx("p",{className:"text-2xl font-bold",children:b.contracts})]})}),e.jsx(r,{children:e.jsxs(o,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Drawings"}),e.jsx("p",{className:"text-2xl font-bold",children:b.drawings})]})}),e.jsx(r,{children:e.jsxs(o,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Reports"}),e.jsx("p",{className:"text-2xl font-bold",children:b.reports})]})})]}),e.jsx(r,{className:"mb-4",children:e.jsxs(o,{className:"p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto flex-grow",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Search documents...",value:g,onChange:s=>pe(s.target.value),className:"pl-10 w-full"})]}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsxs(T,{value:f,onValueChange:ge,children:[e.jsx(k,{className:"w-full",children:e.jsx(I,{placeholder:"All Folders"})}),e.jsxs(R,{children:[e.jsx(p,{value:"All",children:"All Folders"}),G.map(s=>e.jsx(p,{value:s,children:s},s))]})]})})]})}),e.jsx(r,{children:e.jsx(o,{className:"p-0",children:e.jsx(J,{className:"h-[400px] w-full rounded-md border",children:e.jsxs(K,{children:[e.jsx(Z,{className:"bg-slate-50",children:e.jsxs(j,{children:[e.jsx(x,{children:"Document"}),e.jsx(x,{children:"Folder"}),e.jsx(x,{children:"Size"}),e.jsx(x,{children:"Uploaded"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(_,{children:H.length>0?H.map(s=>e.jsxs(j,{children:[e.jsxs(h,{children:[e.jsx("p",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description||"No description"})]}),e.jsx(h,{children:e.jsx(M,{variant:"secondary",children:s.folder})}),e.jsxs(h,{children:[(parseInt(s.size)/1024/1024).toFixed(2)," MB"]}),e.jsx(h,{children:new Date(s.uploadDate).toLocaleDateString()}),e.jsxs(h,{className:"text-right",children:[e.jsx(Q,{children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"icon",children:e.jsx(He,{className:"h-4 w-4"})})}),e.jsx(ee,{children:"View Document"})]})}),e.jsx(Q,{children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"icon",children:e.jsx(Te,{className:"h-4 w-4 text-destructive"})})}),e.jsx(ee,{children:"Delete Document"})]})})]})]},s.id)):e.jsx(j,{children:e.jsxs(h,{colSpan:5,className:"text-center py-8",children:[e.jsx(Ze,{className:"h-12 w-12 text-muted-foreground mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No documents found."})]})})})]})})})})]}),e.jsxs(A,{value:"site-photos",className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsx(r,{children:e.jsxs(o,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Total Photos"}),e.jsx("p",{className:"text-2xl font-bold",children:S.total})]})}),e.jsx(r,{children:e.jsxs(o,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Today"}),e.jsx("p",{className:"text-2xl font-bold",children:S.today})]})}),e.jsx(r,{children:e.jsxs(o,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Earthwork"}),e.jsx("p",{className:"text-2xl font-bold",children:S.earthwork})]})}),e.jsx(r,{children:e.jsxs(o,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Structures"}),e.jsx("p",{className:"text-2xl font-bold",children:S.structures})]})})]}),e.jsx(r,{className:"mb-4",children:e.jsxs(o,{className:"p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs(T,{value:v,onValueChange:we,children:[e.jsx(k,{className:"w-full sm:w-auto",children:e.jsx(I,{placeholder:"All Categories"})}),e.jsxs(R,{children:[e.jsx(p,{value:"All",children:"All Categories"}),Se.map(s=>e.jsx(p,{value:s,children:s},s))]})]}),e.jsxs(n,{className:"w-full sm:w-auto",onClick:()=>{var s;return(s=ye.current)==null?void 0:s.click()},children:[e.jsx($,{className:"mr-2 h-4 w-4"})," Add Photos"]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:W.length>0?W.map(s=>e.jsxs(r,{className:"cursor-pointer",onClick:()=>{U(s),y(!0)},children:[e.jsx("img",{src:s.url,alt:s.caption,className:"w-full h-48 object-cover rounded-t-lg"}),e.jsxs(o,{className:"p-4",children:[e.jsx("p",{className:"font-semibold mb-1",children:s.caption}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(se,{className:"h-3 w-3"})," ",new Date(s.date).toLocaleDateString(),e.jsx(te,{className:"h-3 w-3 ml-2"})," ",s.location,e.jsx(M,{variant:"secondary",className:"ml-auto",children:s.category})]})]})]},s.id)):e.jsxs("div",{className:"col-span-full text-center py-8 border-2 border-dashed rounded-lg text-muted-foreground",children:[e.jsx(de,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No site photos found."})]})})]}),e.jsxs(A,{value:"daily-reports",className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4 items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Daily Site Reports"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track daily activities, resources, and progress."})]}),e.jsxs(n,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"})," New Report"]})]}),e.jsx(r,{children:e.jsx(o,{className:"p-0",children:e.jsx(J,{className:"h-[400px] w-full rounded-md border",children:e.jsxs(K,{children:[e.jsx(Z,{className:"bg-slate-50",children:e.jsxs(j,{children:[e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Weather"}),e.jsx(x,{children:"Work Items"}),e.jsx(x,{children:"Remarks"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(_,{children:F.length>0?F.map(s=>{var a;return e.jsxs(j,{children:[e.jsxs(h,{children:[e.jsx("p",{className:"font-semibold",children:s.date}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.submittedBy})]}),e.jsxs(h,{children:[s.weather==="Sunny"&&e.jsx(ke,{className:"h-4 w-4"}),s.weather==="Cloudy"&&e.jsx(qe,{className:"h-4 w-4"}),s.weather==="Rainy"&&e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.weather})]}),e.jsx(h,{children:e.jsx("ul",{className:"list-disc list-inside text-sm",children:s.workItems.map((c,d)=>e.jsxs("li",{children:[c.description," (",c.quantity,")"]},d))})}),e.jsx(h,{className:"text-sm text-muted-foreground",children:((a=s.remarks)==null?void 0:a.substring(0,50))||"..."}),e.jsxs(h,{className:"text-right",children:[e.jsx(n,{variant:"ghost",size:"icon",children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",children:e.jsx($e,{className:"h-4 w-4"})})]})]},s.id)}):e.jsx(j,{children:e.jsxs(h,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:[e.jsx(he,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No daily reports found."})]})})})]})})})})]}),e.jsxs(A,{value:"mpr-reports",className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4 items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Monthly Progress Reports"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Generate comprehensive monthly reports."})]}),e.jsxs(n,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"})," Generate MPR"]})]}),e.jsxs(Re,{children:[e.jsx(Me,{children:"MPR Generation"}),e.jsx(Oe,{children:"Monthly Progress Report generation functionality will be implemented here."})]})]})]})}),e.jsx(le,{open:fe,onOpenChange:N,children:e.jsxs(ne,{className:"sm:max-w-md",children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Upload New Document"}),e.jsx(oe,{children:"Attach files relevant to the project documentation."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(C,{htmlFor:"documentName",children:"Document Name"}),e.jsx(D,{id:"documentName",value:m.name,onChange:s=>w({...m,name:s.target.value}),placeholder:"e.g. Contract Agreement_Phase1",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(C,{htmlFor:"documentDescription",children:"Description (Optional)"}),e.jsx(D,{id:"documentDescription",value:m.description,onChange:s=>w({...m,description:s.target.value}),placeholder:"Brief description of the document"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(C,{htmlFor:"documentFolder",children:"Folder"}),e.jsxs(T,{value:m.folder,onValueChange:s=>w({...m,folder:s}),children:[e.jsx(k,{children:e.jsx(I,{placeholder:"Select Folder"})}),e.jsx(R,{children:G.map(s=>e.jsx(p,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(C,{htmlFor:"fileInput",children:"Select File"}),e.jsx(D,{id:"fileInput",type:"file",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",onChange:s=>{var a;return z(((a=s.target.files)==null?void 0:a[0])||null)}})]})]}),e.jsxs(ce,{children:[e.jsx(n,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(n,{onClick:De,children:"Upload Document"})]})]})}),e.jsx(le,{open:ve,onOpenChange:y,children:e.jsxs(ne,{className:"sm:max-w-lg",children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Site Photo Details"}),e.jsx(oe,{children:"View photo and AI analysis."})]}),u&&e.jsxs("div",{className:"py-4",children:[e.jsx("img",{src:u.url,alt:u.caption,className:"w-full h-auto object-cover rounded-lg mb-4"}),e.jsx("p",{className:"font-semibold mb-2",children:u.caption}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(se,{className:"h-4 w-4"})," ",new Date(u.date).toLocaleDateString(),e.jsx(te,{className:"h-4 w-4"})," ",u.location,e.jsx(M,{variant:"secondary",className:"ml-auto",children:u.category})]}),e.jsx(Le,{className:"my-4"}),e.jsxs(n,{onClick:()=>Ce(u),disabled:B,children:[B?e.jsx(Ee,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Je,{className:"mr-2 h-4 w-4"}),"AI Analyze Photo"]})]}),e.jsx(ce,{children:e.jsx(n,{onClick:()=>y(!1),children:"Close"})})]})})]})};export{bs as default};
