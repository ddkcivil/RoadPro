import{c as H,r as i,j as e,aB as C,a8 as F,ac as z,aC as D,E as N}from"./index-CewaSTRD.js";import{c as O}from"./geminiService-BRShGGEe.js";import{S as Y}from"./switch-4wBij9kJ.js";import{Z as K}from"./zap-D8JIRj-h.js";import{S as T}from"./sparkles-CWxKTUax.js";import{P as $}from"./paperclip-ovr-ZkE1.js";import{S as q}from"./send-2vQ7VqjI.js";import"./exportUtils-B5u6ZY-6.js";import"./currencyUtils-RmnVW5tT.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=H("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),te=({project:u,onClose:j})=>{const[f,v]=i.useState(""),[c,m]=i.useState([]),[x,w]=i.useState(!1),[p,P]=i.useState(!1),h=i.useRef(null),[o,S]=i.useState(null),I=i.useRef(null),b=i.useRef(null),E=()=>{var r;(r=I.current)==null||r.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{var t;const r=(t=b.current)==null?void 0:t.querySelector('input[type="text"]');return r&&r.focus(),document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[]);const g=i.useCallback(r=>{var t;if(r.key==="Tab"){const s=(t=b.current)==null?void 0:t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!s)return;const d=s[0],a=s[s.length-1];r.shiftKey&&document.activeElement===d?(a.focus(),r.preventDefault()):!r.shiftKey&&document.activeElement===a&&(d.focus(),r.preventDefault())}},[]);i.useEffect(()=>(document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}),[g]),i.useEffect(()=>{E()},[c]),i.useEffect(()=>{c.length===0&&m([{role:"model",text:`Hello! I'm your AI assistant for project **${u.code}**. 

You can:
• Upload **RFI Documents (PDF)** to extract description, status, and dates.
• Upload Site Photos/Videos for progress analysis.
• Ask about the project schedule or BOQ status.`}])},[u.code]);const L=r=>{if(r.target.files&&r.target.files[0]){const t=r.target.files[0],s=t.type.startsWith("video/"),d=t.type==="application/pdf",a=URL.createObjectURL(t);S({file:t,preview:a,type:s?"video":d?"pdf":"image"})}},k=()=>{o&&(URL.revokeObjectURL(o.preview),S(null)),h.current&&(h.current.value="")},R=async r=>{const t=r||f.trim();if(!t&&!o||x)return;let s=o?await new Promise(n=>{const l=new FileReader;l.onloadend=()=>{const y=l.result;n(y.split(",")[1])},l.readAsDataURL(o.file)}):void 0;const d={role:"user",text:t,attachment:o?{mimeType:o.file.type,data:s,type:o.type}:void 0},a=[...c,d];m(a),v(""),w(!0);let B="";if(o)try{B=await new Promise(n=>{const l=new FileReader;l.onloadend=()=>{const y=l.result;n(y.split(",")[1])},l.readAsDataURL(o.file)})}catch(n){console.error("File read error",n)}const V=await O(t||(o?"Analyze this attachment.":""),a,u,o?{mimeType:o.file.type,data:B}:void 0,p);m(n=>[...n,{role:"model",text:V}]),w(!1),k()},W=r=>{r.preventDefault(),R()},M=r=>{let t=r;r==="Extract RFI Details"?t="Analyze this RFI document. Extract key details including Description of Work, Inspection Status, Inspection Date, and Location in a summary table.":r==="Analyze Invoice"?t="Extract invoice details: Vendor, Date, Bill No, Amount.":r==="Assess Site Progress"&&(t="Analyze this site image/video and describe the construction progress and machinery used."),R(t)},U=()=>{if(x)return null;const r=[];return o?((o.type==="pdf"||o.type==="image")&&(r.push("Extract RFI Details"),r.push("Analyze Invoice")),(o.type==="image"||o.type==="video")&&(r.push("Assess Site Progress"),r.push("Check Safety Compliance"))):c.length===1&&(r.push("Project Schedule Summary"),r.push("Pending RFIs Status"),r.push("BOQ Financial Progress")),r.length===0?null:e.jsx(Box,{sx:{display:"flex",gap:2,mb:4,overflowX:"auto",pb:2,px:1,"&::-webkit-scrollbar":{display:"none"}},children:r.map((t,s)=>e.jsx(Chip,{label:t,onClick:()=>M(t),sx:{cursor:"pointer",bgcolor:"white",border:"1px solid",borderColor:"divider",fontWeight:500,borderRadius:2,"&:hover":{bgcolor:"primary.light",borderColor:"primary.main",color:"primary.main",transform:"translateY(-1px)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}},icon:e.jsx(T,{size:14,style:{color:"primary.main"}})},s))})};return e.jsx(Box,{ref:b,sx:{position:"fixed",inset:0,zIndex:50,display:"flex",alignItems:"center",justifyContent:"center",p:4,bgcolor:"rgba(0,0,0,0.6)",backdropFilter:"blur(10px)"},onClick:j,children:e.jsxs(Box,{sx:{bgcolor:"background.paper",width:"100%",maxWidth:"600px",height:"85vh",borderRadius:4,boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",border:"1px solid",borderColor:"divider"},onClick:r=>r.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"chat-modal-title",children:[e.jsxs(Box,{sx:{bgcolor:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",p:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white",flexShrink:0},id:"chat-modal-title",children:[e.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(Box,{sx:{bgcolor:"rgba(255,255,255,0.2)",p:2,borderRadius:"50%",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.2)"},children:e.jsx(C,{size:24})}),e.jsxs(Box,{children:[e.jsx(Typography,{variant:"h6",fontWeight:"bold",sx:{lineHeight:"1.4"},children:"RoadMaster AI"}),e.jsxs(Box,{sx:{fontSize:"0.75rem",color:"rgba(255,255,255,0.7)",display:"flex",alignItems:"center",gap:1},children:["Powered by Gemini ",p?"Flash Lite":"3.0 Pro"]})]})]}),e.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(FormControlLabel,{control:e.jsx(Y,{size:"small",checked:p,onChange:r=>P(r.target.checked),color:"secondary",sx:{"& .MuiSwitch-track":{bgcolor:"rgba(255,255,255,0.4)"},"& .Mui-checked + .MuiSwitch-track":{bgcolor:"rgba(156, 163, 175, 0.7)"}}}),label:e.jsxs(Box,{sx:{fontSize:"0.75rem",fontWeight:"medium",color:"white",display:"flex",alignItems:"center",gap:1},children:[e.jsx(K,{size:12,className:p?"text-[#fbbf24]":"text-inherit"}),"Fast Mode"]})}),e.jsx(IconButton,{onClick:j,sx:{color:"white",bgcolor:"rgba(255,255,255,0.1)","&:hover":{bgcolor:"rgba(255,255,255,0.2)"},borderRadius:2},children:e.jsx(F,{size:20})})]})]}),e.jsxs(Box,{sx:{flex:1,overflowY:"auto",p:3,bgcolor:"grey.50",display:"flex",flexDirection:"column",gap:3},children:[c.map((r,t)=>e.jsx(Box,{sx:{display:"flex",justifyContent:r.role==="user"?"flex-end":"flex-start"},children:e.jsxs(Box,{sx:{display:"flex",maxWidth:"85%",flexDirection:r.role==="user"?"row-reverse":"row",gap:3},children:[e.jsx(Box,{sx:{width:36,height:36,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,mt:.5,boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",bgcolor:r.role==="user"?"primary.light":"grey.100",border:"1px solid",borderColor:"divider"},children:r.role==="user"?e.jsx(Typography,{variant:"caption",fontWeight:"bold",color:"primary.main",children:"ME"}):e.jsx(T,{size:18,style:{color:"primary.main"}})}),e.jsxs(Box,{sx:{p:2.5,borderRadius:3,boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",fontSize:"0.9rem",lineHeight:"1.5",bgcolor:r.role==="user"?"primary.main":"background.paper",color:r.role==="user"?"primary.contrastText":"text.primary",borderTopRightRadius:r.role==="user"?0:3,borderTopLeftRadius:r.role==="user"?3:0,border:r.role!=="user"?"1px solid":"none",borderColor:r.role!=="user"?"divider":"transparent","&:hover":{boxShadow:(r.role!=="user","0 4px 6px -1px rgba(0, 0, 0, 0.1)")}},children:[r.attachment&&e.jsx(Box,{sx:{mb:2,borderRadius:2,overflow:"hidden",border:"1px solid",borderColor:"divider",bgcolor:"background.paper"},children:r.attachment.type==="video"?e.jsxs(Box,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:40,px:2,gap:1},children:[e.jsx(A,{size:16,style:{color:"text.secondary"}}),e.jsx(Typography,{variant:"caption",color:"text.secondary",children:"Video Attached"})]}):r.attachment.type==="pdf"?e.jsxs(Box,{sx:{p:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(Box,{sx:{bgcolor:"error.light",p:1.5,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(z,{size:18,style:{color:"#ef4444"}})}),e.jsxs(Box,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(Typography,{variant:"caption",fontWeight:"medium",color:r.role==="user"?"primary.contrastText":"text.primary",children:"PDF Document"}),e.jsx(Typography,{variant:"caption",color:r.role==="user"?"primary.light":"text.secondary",children:"Attached for analysis"})]})]}):e.jsx(Box,{sx:{position:"relative"},children:e.jsx("img",{src:`data:${r.attachment.mimeType};base64,${r.attachment.data}`,alt:"Upload",style:{maxWidth:"200px",maxHeight:"192px",objectFit:"cover",display:"block"}})})}),e.jsx(Box,{sx:{whiteSpace:"pre-wrap",fontFamily:"Inter, sans-serif"},children:r.text})]})]})},t)),x&&e.jsx(Box,{sx:{display:"flex",justifyContent:"flex-start"},children:e.jsxs(Box,{sx:{display:"flex",gap:3,maxWidth:"85%"},children:[e.jsx(Box,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"background.paper",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,mt:.25,boxShadow:1},children:e.jsx(C,{size:16,style:{color:"primary.main"}})}),e.jsxs(Box,{sx:{bgcolor:"background.paper",p:2,borderRadius:2,borderTopLeftRadius:0,border:"1px solid",borderColor:"divider",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)",display:"flex",alignItems:"center",gap:1},children:[e.jsx(D,{size:16,style:{animation:"spin 1s linear infinite",color:"primary.main"}}),e.jsx(Typography,{variant:"caption",color:"text.secondary",fontWeight:"medium",children:"Analyzing..."})]})]})}),e.jsx("div",{ref:I})]}),e.jsxs(Box,{sx:{p:3,bgcolor:"background.paper",borderTop:"1px solid",borderColor:"divider",boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[o&&e.jsxs(Box,{sx:{mb:2,display:"flex",alignItems:"center",gap:2,bgcolor:"background.paper",p:1.5,borderRadius:2,border:"1px solid",borderColor:"divider",width:"fit-content",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)"},children:[e.jsx(Box,{sx:{width:48,height:48,bgcolor:"grey.100",borderRadius:1,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",border:"1px solid",borderColor:"divider"},children:o.type==="image"?e.jsx("img",{src:o.preview,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):o.type==="pdf"?e.jsx(z,{size:20,style:{color:"#ef4444"}}):e.jsx(A,{size:18,style:{color:"text.secondary"}})}),e.jsxs(Box,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(Typography,{variant:"caption",fontWeight:"medium",color:"text.primary",sx:{maxWidth:"150px",textOverflow:"ellipsis",overflow:"hidden"},children:o.file.name}),e.jsx(Typography,{variant:"caption",color:"text.secondary",textTransform:"uppercase",fontWeight:"regular",children:o.type})]}),e.jsx(IconButton,{size:"small",onClick:k,sx:{ml:1,borderRadius:1,"&:hover":{bgcolor:"error.light",color:"error.dark"}},children:e.jsx(F,{size:14})})]}),U(),e.jsxs(Box,{component:"form",onSubmit:W,sx:{display:"flex",gap:3,alignItems:"flex-end"},children:[e.jsx("input",{type:"file",id:"file-upload-input",ref:h,onChange:L,className:"hidden",accept:"image/*,video/*,application/pdf"}),e.jsx("label",{htmlFor:"file-upload-input",className:"sr-only",children:"Upload PDF (RFI/Invoice) or Media"}),e.jsxs(N,{title:"Upload PDF (RFI/Invoice) or Media",arrow:!0,children:["                    ",e.jsx("span",{children:e.jsx(IconButton,{onClick:()=>{var r;return(r=h.current)==null?void 0:r.click()},sx:{bgcolor:o?"indigo.50":"grey.100",color:o?"indigo.600":"grey.600",border:"1px solid",borderColor:o?"indigo.200":"grey.300",borderRadius:2,p:1.5,"&:hover":{bgcolor:"indigo.100",color:"indigo.700",transform:"translateY(-1px)"}},children:e.jsx($,{size:20})})})]}),e.jsx(Box,{sx:{flex:1,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:3,display:"flex",alignItems:"center",px:2,py:1.5,transition:"all 0.2s",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)","&:focus-within":{boxShadow:"0 0 0 3px rgba(99, 102, 241, 0.2) !important",borderColor:"primary.main"}},children:e.jsx("input",{type:"text",value:f,onChange:r=>v(r.target.value),placeholder:"Ask about schedule, or upload RFI PDF for extraction...",className:"flex-1 bg-transparent outline-none text-sm text-foreground p-0",autoFocus:!0,"aria-label":"Ask about schedule or upload RFI PDF"})}),e.jsx(IconButton,{type:"submit",disabled:x||!f.trim()&&!o,sx:{bgcolor:"primary.main",color:"white",p:1.5,borderRadius:2,boxShadow:"0 4px 6px -1px rgba(79, 70, 229, 0.5), 0 2px 4px -1px rgba(79, 70, 229, 0.3)","&:hover":{bgcolor:"primary.dark",transform:"translateY(-1px)",boxShadow:"0 6px 12px -2px rgba(79, 70, 229, 0.6)"},"&.Mui-disabled":{bgcolor:"grey.300",color:"grey.500",boxShadow:"none",transform:"none"}},children:x?e.jsx(D,{size:20,style:{animation:"spin 1s linear infinite"}}):e.jsx(q,{size:20})})]}),e.jsx(Box,{sx:{textAlign:"center",mt:1},children:e.jsx(Typography,{variant:"caption",color:"text.disabled",fontSize:10,children:"AI can make mistakes. Verify important project information."})})]})]})})};export{te as default};
