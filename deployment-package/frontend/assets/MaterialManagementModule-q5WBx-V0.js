import{r as u,j as e,B as x,P as me,n as y,aH as T,aZ as xe,ay as he,u as pe,I as o,t as L,a8 as k,m as je,v as ve,w as ge,x as H,y as h,z as ye,A as p,O as R,T as z,E as F,F as O,H as q,G as fe,J as Ne,D as W,f as B,h as K,e as P,K as i,U as X,V as Z,W as $,X as G,Y as J,Z as I,k as Y}from"./index-CewaSTRD.js";import{T as be,a as Ce,b as E}from"./tabs-b2piEQ7z.js";import{f as Q}from"./exportUtils-B5u6ZY-6.js";import{F as Se}from"./filter-BSFQ0ETk.js";import{T as Me}from"./triangle-alert-DCByPDj1.js";import{C as _}from"./calculator-D9vHTubs.js";import{S as ee}from"./save-CV1km07e.js";import"./currencyUtils-RmnVW5tT.js";const Oe=({project:j,onProjectUpdate:C,userRole:we})=>{const[S,ae]=u.useState("0"),[f,te]=u.useState(""),[se,N]=u.useState(!1),[ie,M]=u.useState(!1),[w,A]=u.useState(null),[De,V]=u.useState(null),[a,r]=u.useState({name:"",category:"",unit:"",quantity:0,availableQuantity:0,unitCost:0,reorderLevel:10,location:"Warehouse",status:"Available",criticality:"Medium"}),[s,v]=u.useState({materialId:"",supplierId:"",rate:0,effectiveDate:new Date().toISOString().split("T")[0],description:""}),n=j.materials||[],re=j.agencies||[],D=u.useMemo(()=>{const t=n.length,l=n.filter(m=>m.availableQuantity<=m.reorderLevel).length,d=n.filter(m=>m.availableQuantity===0).length,g=n.reduce((m,b)=>m+(b.totalValue||0),0);return{totalMaterials:t,lowStock:l,outOfStock:d,totalValue:g}},[n]),U=u.useMemo(()=>n.filter(t=>{var l;return t.name.toLowerCase().includes(f.toLowerCase())||((l=t.category)==null?void 0:l.toLowerCase().includes(f.toLowerCase()))||t.location.toLowerCase().includes(f.toLowerCase())}),[n,f]),le=()=>{r({name:"",category:"",unit:"",quantity:0,availableQuantity:0,unitCost:0,reorderLevel:10,location:"Warehouse",status:"Available",criticality:"Medium"}),A(null),N(!0)},ne=t=>{r({...t}),A(t.id),N(!0)},de=t=>{if(!window.confirm("Are you sure you want to delete this material?"))return;const l=n.filter(d=>d.id!==t);C({...j,materials:l})},ce=()=>{var g,m;if(!((g=a.name)!=null&&g.trim())||!((m=a.unit)!=null&&m.trim())){alert("Material name and unit are required");return}const t=(a.quantity||0)*(a.unitCost||0),l=a.availableQuantity??a.quantity??0,d=l===0?"Out of Stock":l<=(a.reorderLevel||10)?"Low Stock":"Available";if(w){const b=n.map(c=>c.id===w?{id:c.id,name:a.name||c.name,description:a.description,category:a.category||c.category,unit:a.unit||c.unit,quantity:a.quantity||c.quantity||0,location:a.location||c.location||"Warehouse",status:d,lastUpdated:new Date().toISOString().split("T")[0],availableQuantity:l,unitCost:a.unitCost||c.unitCost||0,totalValue:t,reorderLevel:a.reorderLevel||c.reorderLevel||10,maxStockLevel:a.maxStockLevel,criticality:a.criticality||c.criticality||"Medium",notes:a.notes,tags:a.tags,deliveryLocation:a.deliveryLocation,transportMode:a.transportMode,driverName:a.driverName,vehicleNumber:a.vehicleNumber,deliveryCharges:a.deliveryCharges,taxAmount:a.taxAmount,batchNumber:a.batchNumber,expiryDate:a.expiryDate,qualityCertification:a.qualityCertification,supplierInvoiceRef:a.supplierInvoiceRef,orderedDate:a.orderedDate,expectedDeliveryDate:a.expectedDeliveryDate,deliveryDate:a.deliveryDate,supplierId:a.supplierId,supplierName:a.supplierName,supplierRate:a.supplierRate}:c);C({...j,materials:b})}else{const b={id:`mat-${Date.now()}`,name:a.name||"",description:a.description,category:a.category,unit:a.unit||"",quantity:a.quantity||0,location:a.location||"Warehouse",status:d,lastUpdated:new Date().toISOString().split("T")[0],availableQuantity:l,unitCost:a.unitCost||0,totalValue:t,reorderLevel:a.reorderLevel||10,maxStockLevel:a.maxStockLevel,criticality:a.criticality||"Medium",notes:a.notes,tags:a.tags,deliveryLocation:a.deliveryLocation,transportMode:a.transportMode,driverName:a.driverName,vehicleNumber:a.vehicleNumber,deliveryCharges:a.deliveryCharges,taxAmount:a.taxAmount,batchNumber:a.batchNumber,expiryDate:a.expiryDate,qualityCertification:a.qualityCertification,supplierInvoiceRef:a.supplierInvoiceRef,orderedDate:a.orderedDate,expectedDeliveryDate:a.expectedDeliveryDate,deliveryDate:a.deliveryDate,supplierId:a.supplierId,supplierName:a.supplierName,supplierRate:a.supplierRate};C({...j,materials:[...n,b]})}N(!1),r({name:"",category:"",unit:"",quantity:0,availableQuantity:0,unitCost:0,reorderLevel:10,location:"Warehouse",status:"Available",criticality:"Medium"}),A(null)},oe=t=>{v({materialId:t,supplierId:"",rate:0,effectiveDate:new Date().toISOString().split("T")[0],description:""}),V(null),M(!0)},ue=()=>{if(!s.supplierId||s.rate<=0){alert("Please select supplier and enter valid rate");return}const t={id:`rate-${Date.now()}`,materialId:s.materialId,supplierId:s.supplierId,rate:s.rate,effectiveDate:s.effectiveDate,description:s.description,status:"Active"},l=n.map(d=>{if(d.id===s.materialId){const g=[...d.rateHistory||[],t];return{...d,rateHistory:g,supplierId:s.supplierId,supplierRate:s.rate,lastUpdated:new Date().toISOString().split("T")[0]}}return d});C({...j,materials:l}),M(!1),v({materialId:"",supplierId:"",rate:0,effectiveDate:new Date().toISOString().split("T")[0],description:""}),V(null)};return e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex justify-between mb-6 items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-extrabold tracking-tight text-primary",children:"Material Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Unified system for material inventory and supplier rate management"})]}),e.jsxs(x,{onClick:le,className:"px-4 py-2 font-bold rounded-lg",children:[e.jsx(me,{size:18,className:"mr-2"}),"Add Material"]})]}),e.jsxs(y,{className:"rounded-xl overflow-hidden mb-6",children:[e.jsx(be,{value:S,onValueChange:ae,className:"border-b",children:e.jsxs(Ce,{children:[e.jsxs(E,{value:"0",children:[e.jsx(T,{size:20,className:"mr-2"}),"Materials"]}),e.jsxs(E,{value:"1",children:[e.jsx(xe,{size:20,className:"mr-2"}),"Suppliers"]}),e.jsxs(E,{value:"2",children:[e.jsx(he,{size:20,className:"mr-2"}),"Analytics"]})]})}),e.jsxs("div",{className:"p-6",children:[S==="0"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-4 items-center",children:[e.jsxs("div",{className:"relative w-96",children:[e.jsx(pe,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),e.jsx(o,{placeholder:"Search materials...",value:f,onChange:t=>te(t.target.value),className:"pl-10"})]}),e.jsxs(x,{variant:"outline",children:[e.jsx(Se,{size:14,className:"mr-2"}),"Filter Materials"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(y,{className:"border-l-4 border-l-green-500",children:e.jsxs(L,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wide",children:"TOTAL MATERIALS"}),e.jsx(T,{size:16,className:"text-green-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:D.totalMaterials})]})}),e.jsx(y,{className:"border-l-4 border-l-yellow-500",children:e.jsxs(L,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wide",children:"LOW STOCK"}),e.jsx(Me,{size:16,className:"text-yellow-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:D.lowStock})]})}),e.jsx(y,{className:"border-l-4 border-l-red-500",children:e.jsxs(L,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wide",children:"OUT OF STOCK"}),e.jsx(k,{size:16,className:"text-red-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:D.outOfStock})]})}),e.jsx(y,{className:"border-l-4 border-l-blue-500",children:e.jsxs(L,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wide",children:"TOTAL VALUE"}),e.jsx(je,{size:16,className:"text-blue-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Q(D.totalValue)})]})})]}),e.jsxs(y,{children:[e.jsxs(ve,{children:[e.jsx(ge,{children:e.jsxs(H,{className:"bg-primary",children:[e.jsx(h,{className:"text-primary-foreground font-bold",children:"Material"}),e.jsx(h,{className:"text-primary-foreground font-bold",children:"Category"}),e.jsx(h,{className:"text-primary-foreground font-bold",children:"Available"}),e.jsx(h,{className:"text-primary-foreground font-bold",children:"Unit Cost"}),e.jsx(h,{className:"text-primary-foreground font-bold",children:"Total Value"}),e.jsx(h,{className:"text-primary-foreground font-bold",children:"Location"}),e.jsx(h,{className:"text-primary-foreground font-bold",children:"Status"}),e.jsx(h,{className:"text-primary-foreground font-bold text-right",children:"Actions"})]})}),e.jsx(ye,{children:U.map(t=>e.jsxs(H,{className:"hover:bg-muted/50",children:[e.jsxs(p,{children:[e.jsx("div",{className:"font-medium",children:t.name}),t.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:t.description})]}),e.jsx(p,{children:e.jsx(R,{variant:"outline",children:t.category||"Uncategorized"})}),e.jsxs(p,{children:[e.jsxs("div",{children:[t.availableQuantity," ",t.unit]}),t.availableQuantity<=t.reorderLevel&&e.jsx(R,{variant:"secondary",className:"mt-1",children:"Low Stock"})]}),e.jsx(p,{children:Q(t.unitCost||0)}),e.jsx(p,{children:Q(t.totalValue||0)}),e.jsx(p,{children:e.jsx("div",{children:t.location})}),e.jsx(p,{children:e.jsx(R,{variant:t.status==="Available"?"default":t.status==="Low Stock"?"secondary":"destructive",children:t.status})}),e.jsx(p,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(z,{children:e.jsxs(F,{children:[e.jsx(O,{asChild:!0,children:e.jsx(x,{size:"sm",variant:"outline",onClick:()=>oe(t.id),children:e.jsx(_,{size:16})})}),e.jsx(q,{children:e.jsx("p",{children:"Manage Rates"})})]})}),e.jsx(z,{children:e.jsxs(F,{children:[e.jsx(O,{asChild:!0,children:e.jsx(x,{size:"sm",variant:"outline",onClick:()=>ne(t),children:e.jsx(fe,{size:16})})}),e.jsx(q,{children:e.jsx("p",{children:"Edit"})})]})}),e.jsx(z,{children:e.jsxs(F,{children:[e.jsx(O,{asChild:!0,children:e.jsx(x,{size:"sm",variant:"outline",onClick:()=>de(t.id),children:e.jsx(Ne,{size:16})})}),e.jsx(q,{children:e.jsx("p",{children:"Delete"})})]})})]})})]},t.id))})]}),U.length===0&&e.jsxs("div",{className:"py-16 text-center",children:[e.jsx(T,{size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No materials found. Add your first material to get started."})]})]})]}),S==="1"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Supplier Rate Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage supplier rates for materials in the Materials tab."})]}),S==="2"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Material Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Analytics dashboard coming soon."})]})]})]}),e.jsxs(W,{open:se,onOpenChange:N,children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"text-indigo-600",size:20}),w?"Edit Material":"Add New Material"]})}),e.jsx(P,{className:"max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"material-name",children:"Material Name *"}),e.jsx(o,{id:"material-name",value:a.name||"",onChange:t=>r({...a,name:t.target.value}),placeholder:"Enter material name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"material-category",children:"Category"}),e.jsx(o,{id:"material-category",value:a.category||"",onChange:t=>r({...a,category:t.target.value}),placeholder:"Enter category"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"material-unit",children:"Unit *"}),e.jsx(o,{id:"material-unit",value:a.unit||"",onChange:t=>r({...a,unit:t.target.value}),placeholder:"e.g., kg, m, pieces"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"material-quantity",children:"Quantity"}),e.jsx(o,{id:"material-quantity",type:"number",value:a.quantity||0,onChange:t=>r({...a,quantity:Number(t.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"material-available",children:"Available Quantity"}),e.jsx(o,{id:"material-available",type:"number",value:a.availableQuantity??a.quantity??0,onChange:t=>r({...a,availableQuantity:Number(t.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"material-cost",children:"Unit Cost"}),e.jsx(o,{id:"material-cost",type:"number",value:a.unitCost||0,onChange:t=>r({...a,unitCost:Number(t.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"material-reorder",children:"Reorder Level"}),e.jsx(o,{id:"material-reorder",type:"number",value:a.reorderLevel||10,onChange:t=>r({...a,reorderLevel:Number(t.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"material-location",children:"Location"}),e.jsx(o,{id:"material-location",value:a.location||"Warehouse",onChange:t=>r({...a,location:t.target.value})})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(i,{htmlFor:"material-description",children:"Description"}),e.jsx(X,{id:"material-description",value:a.description||"",onChange:t=>r({...a,description:t.target.value}),placeholder:"Enter material description",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"material-criticality",children:"Criticality"}),e.jsxs(Z,{value:a.criticality||"Medium",onValueChange:t=>r({...a,criticality:t}),children:[e.jsx($,{children:e.jsx(G,{placeholder:"Select criticality"})}),e.jsxs(J,{children:[e.jsx(I,{value:"High",children:"High"}),e.jsx(I,{value:"Medium",children:"Medium"}),e.jsx(I,{value:"Low",children:"Low"})]})]})]})]})}),e.jsxs(Y,{className:"bg-muted/50",children:[e.jsxs(x,{variant:"outline",onClick:()=>N(!1),children:[e.jsx(k,{size:16,className:"mr-2"}),"Cancel"]}),e.jsxs(x,{onClick:ce,children:[e.jsx(ee,{size:16,className:"mr-2"}),w?"Update Material":"Add Material"]})]})]}),e.jsxs(W,{open:ie,onOpenChange:M,children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"text-indigo-600",size:20}),"Manage Supplier Rates"]})}),e.jsx(P,{children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"supplier-select",children:"Select Supplier *"}),e.jsxs(Z,{value:s.supplierId,onValueChange:t=>v({...s,supplierId:t}),children:[e.jsx($,{children:e.jsx(G,{placeholder:"Choose a supplier"})}),e.jsx(J,{children:re.map(t=>e.jsx(I,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"rate-amount",children:"Rate *"}),e.jsx(o,{id:"rate-amount",type:"number",value:s.rate,onChange:t=>v({...s,rate:Number(t.target.value)}),placeholder:"Enter rate"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"rate-date",children:"Effective Date"}),e.jsx(o,{id:"rate-date",type:"date",value:s.effectiveDate,onChange:t=>v({...s,effectiveDate:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"rate-description",children:"Description"}),e.jsx(X,{id:"rate-description",value:s.description,onChange:t=>v({...s,description:t.target.value}),placeholder:"Enter description",rows:3})]})]})}),e.jsxs(Y,{className:"bg-muted/50",children:[e.jsxs(x,{variant:"outline",onClick:()=>M(!1),children:[e.jsx(k,{size:16,className:"mr-2"}),"Cancel"]}),e.jsxs(x,{onClick:ue,children:[e.jsx(ee,{size:16,className:"mr-2"}),"Save Rate"]})]})]})]})};export{Oe as default};
