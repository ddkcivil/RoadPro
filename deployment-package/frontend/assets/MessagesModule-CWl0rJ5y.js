import{c as S,r as c,j as e,I as G,u as Q,aJ as L,ah as j,az as u,aA as N,O as V,aY as W,aD as b,B as r,Q as Y,aq as J,T as Z,E as v,F as w,H as y,aN as _,ac as K,U as X,a7 as k}from"./index-CewaSTRD.js";import{E as U}from"./ellipsis-vertical-C9SMr15X.js";import{P as ee}from"./paperclip-ovr-ZkE1.js";import{S as se}from"./send-2vQ7VqjI.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=S("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=S("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=S("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),re=({currentUser:t,users:h,messages:o,projectId:g,onSendMessage:E})=>{const[i,T]=c.useState("general"),[x,m]=c.useState(""),[A,P]=c.useState(""),M=c.useRef(null),R=()=>{var s;(s=M.current)==null||s.scrollIntoView({behavior:"smooth"})};c.useEffect(()=>{R()},[o,i]);const p=i==="general"?o.filter(s=>s.receiverId==="general"&&s.projectId===g):o.filter(s=>(s.senderId===(t==null?void 0:t.id)&&s.receiverId===i||s.senderId===i&&s.receiverId===(t==null?void 0:t.id))&&s.projectId===g),B=s=>{s.preventDefault(),x.trim()&&(E(x,i,g),m(""))},$=s=>h.find(n=>n.id===s),H=h.filter(s=>s.id!==(t==null?void 0:t.id)&&s.name.toLowerCase().includes(A.toLowerCase())),z=s=>{if(!s){k.info("No phone number available for this user.");return}const n=s.replace(/[^0-9]/g,"");window.open(`https://wa.me/${n}`,"_blank")},F=s=>{if(!s){k.info("No email address available for this user.");return}window.location.href=`mailto:${s}`},D=()=>k.info("Attachment Feature: Opens file picker."),O=()=>{m(s=>s+"Ref: RFI/CH/12+500 ")},q=()=>{m(s=>s+"Ref: Item 4.01 (GSB) ")},a=$(i);return e.jsxs("div",{className:"flex h-[calc(100vh-140px)] rounded-lg border bg-card text-card-foreground shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex w-80 flex-col border-r bg-muted/40",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-3",children:"Messages"}),e.jsx(G,{placeholder:"Search people...",value:A,onChange:s=>P(s.target.value),icon:e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsxs(L,{className:"flex-1",children:[e.jsx("div",{className:"px-4 py-2 uppercase text-xs font-bold text-muted-foreground mt-1",children:"Channels"}),e.jsxs("div",{onClick:()=>T("general"),className:`flex items-center gap-2 px-4 py-3 cursor-pointer transition-all 
                                ${i==="general"?"bg-primary/10 border-r-4 border-primary":"hover:bg-muted/60"}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-md bg-primary/20 flex items-center justify-center text-primary",children:e.jsx(C,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:`font-semibold ${i==="general"?"text-primary":"text-foreground"}`,children:"Project General"}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:"Team announcements"})]})]}),e.jsx("div",{className:"px-4 py-2 uppercase text-xs font-bold text-muted-foreground mt-4",children:"Direct Messages"}),H.map(s=>{const n=o.filter(l=>l.senderId===s.id&&l.receiverId===(t==null?void 0:t.id)||l.senderId===(t==null?void 0:t.id)&&l.receiverId===s.id).pop(),d=o.filter(l=>l.senderId===s.id&&l.receiverId===(t==null?void 0:t.id)&&!l.read).length;return e.jsxs("div",{onClick:()=>T(s.id),className:`flex items-center gap-2 px-4 py-3 cursor-pointer transition-all 
                                        ${i===s.id?"bg-primary/10 border-r-4 border-primary":"hover:bg-muted/60"}`,title:s.phone?`Phone: ${s.phone}`:"",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(j,{className:"h-10 w-10",children:[e.jsx(u,{src:s.avatar}),e.jsx(N,{children:s.name.charAt(0)})]}),d>0&&e.jsx("span",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full bg-red-500 ring-2 ring-background"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:`font-semibold ${i===s.id?"text-primary":"text-foreground"}`,children:s.name}),n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(n.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:n?n.senderId===(t==null?void 0:t.id)?"You: "+n.content:n.content:s.role})]})]},s.id)})]})]}),e.jsxs("div",{className:"flex flex-1 flex-col bg-background",children:[e.jsxs("div",{className:"flex min-h-[80px] items-center justify-between border-b bg-card px-6 py-2 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[i==="general"?e.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary flex items-center justify-center text-primary-foreground shadow",children:e.jsx(C,{className:"h-6 w-6"})}):e.jsxs(j,{className:"h-12 w-12",children:[e.jsx(u,{src:a==null?void 0:a.avatar}),e.jsx(N,{children:a==null?void 0:a.name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-foreground leading-tight",children:i==="general"?"Project General":a==null?void 0:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i==="general"?`${h.length} members`:e.jsxs("span",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-x-3 text-sm mt-1",children:[e.jsx(V,{className:"font-bold",children:a==null?void 0:a.role}),(a==null?void 0:a.phone)&&e.jsxs("span",{className:"flex items-center gap-1 font-mono text-muted-foreground",children:[e.jsx(W,{className:"h-3 w-3"})," ",a.phone]}),(a==null?void 0:a.email)&&e.jsxs("span",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(b,{className:"h-3 w-3"})," ",a.email]})]})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i!=="general"&&a&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>F(a.email),className:"hidden md:flex",children:[e.jsx(b,{className:"mr-2 h-4 w-4"})," Email"]}),e.jsxs(r,{variant:"default",size:"sm",onClick:()=>z(a.phone),className:"hidden md:flex bg-green-500 hover:bg-green-600 text-white",children:[e.jsx(I,{className:"mr-2 h-4 w-4"})," WhatsApp"]}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>F(a.email),className:"md:hidden",children:e.jsx(b,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>z(a.phone),className:"md:hidden bg-green-500/10 hover:bg-green-500/20 text-green-600",children:e.jsx(I,{className:"h-5 w-5"})}),e.jsx(Y,{orientation:"vertical",className:"h-6 mx-2"})]}),e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx(U,{className:"h-5 w-5 text-muted-foreground"})})]})]}),e.jsxs(L,{className:"flex-1 p-6 space-y-4",children:[p.length===0?e.jsxs("div",{className:"text-center py-10 opacity-60",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:i==="general"?e.jsx(C,{className:"h-8 w-8 text-muted-foreground"}):e.jsx(I,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground",children:i==="general"?"No announcements yet.":`Start a conversation with ${a==null?void 0:a.name.split(" ")[0]}.`})]}):p.map((s,n)=>{const d=s.senderId===(t==null?void 0:t.id),l=$(s.senderId),f=n===0||p[n-1].senderId!==s.senderId;return e.jsx("div",{className:`flex ${d?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex max-w-[70%] gap-2 ${d?"flex-row-reverse":"flex-row"}`,children:[!d&&f&&e.jsxs(j,{className:"h-8 w-8",children:[e.jsx(u,{src:l==null?void 0:l.avatar}),e.jsx(N,{children:l==null?void 0:l.name.charAt(0)})]}),!d&&!f&&e.jsx("div",{className:"w-8"})," ",e.jsxs("div",{children:[f&&!d&&e.jsx("p",{className:"text-xs text-muted-foreground ml-1 mb-1",children:l==null?void 0:l.name}),e.jsxs("div",{className:`p-3 rounded-2xl shadow-sm text-sm relative 
                                                         ${d?"bg-primary text-primary-foreground rounded-tr-sm":"bg-card border rounded-tl-sm"}`,children:[s.content,e.jsxs("div",{className:`text-xs mt-1 flex items-center ${d?"justify-end text-primary-foreground/80":"justify-end text-muted-foreground"}`,children:[new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d&&(s.read?e.jsx(ae,{className:"h-3 w-3 ml-1"}):e.jsx(J,{className:"h-3 w-3 ml-1"}))]})]})]})]})},s.id)}),e.jsx("div",{ref:M})]}),e.jsxs("div",{className:"border-t bg-card p-4",children:[e.jsx("div",{className:"flex gap-2 mb-2 px-1",children:e.jsxs(Z,{children:[e.jsxs(v,{children:[e.jsx(w,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"icon",onClick:D,children:e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsx(y,{children:"Attach File"})]}),e.jsxs(v,{children:[e.jsx(w,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"icon",onClick:O,children:e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsx(y,{children:"Link RFI"})]}),e.jsxs(v,{children:[e.jsx(w,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"icon",onClick:q,children:e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsx(y,{children:"Link BOQ Item"})]})]})}),e.jsxs("form",{onSubmit:B,className:"flex gap-2",children:[e.jsx(X,{placeholder:`Message ${i==="general"?"#general":a==null?void 0:a.name.split(" ")[0]}...`,value:x,onChange:s=>m(s.target.value),className:"flex-1 resize-none min-h-[48px] rounded-lg p-3 bg-muted/60 border-0 focus-visible:ring-offset-0 focus-visible:ring-transparent"}),e.jsx(r,{type:"submit",disabled:!x.trim(),size:"icon",className:"h-12 w-12 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground",children:e.jsx(se,{className:"h-6 w-6"})})]})]})]})]})};export{re as default};
