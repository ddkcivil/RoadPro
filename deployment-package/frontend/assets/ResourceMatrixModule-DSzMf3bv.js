import{c as ee,r as m,j as e,n as W,B as g,P as H,v as D,w as F,x as y,A as a,z as L,O as R,K as r,V as b,W as f,X as N,Y as C,Z as t,I as h,a0 as le,a2 as ae,R as U,D as se,f as te,h as ne,e as ie,U as re,k as ce,aH as X,ax as Y}from"./index-CewaSTRD.js";import{T as de,a as oe,b as M}from"./tabs-b2piEQ7z.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ee("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),ve=({project:c,onProjectUpdate:A})=>{var E,z,P,V;const[x,S]=m.useState(c.resources||[]),[I,w]=m.useState(c.resourceAllocations||[]),[Z,T]=m.useState(!1),[s,d]=m.useState({}),[Q,$]=m.useState(0),[he,xe]=m.useState(0),[i,v]=m.useState({resourceId:"",allocatedTo:"",allocatedQuantity:0,startDate:"",endDate:"",notes:""});m.useEffect(()=>{S(c.resources||[]),w(c.resourceAllocations||[])},[c]);const k=l=>{d(l?{...l}:{name:"",type:"Material",category:"",unit:"",unitCost:0,totalQuantity:0,availableQuantity:0,allocatedQuantity:0,status:"Available",criticality:"Medium",supplier:"",leadTime:0,reorderLevel:0,notes:""}),T(!0)},K=()=>{let l;if(s.id)l=x.map(n=>n.id===s.id?s:n);else{const n={...s,id:`res-${Date.now()}`,quantity:s.totalQuantity||0,location:s.location||"Warehouse",lastUpdated:new Date().toISOString().split("T")[0],availableQuantity:s.totalQuantity,allocatedQuantity:0};l=[...x,n]}S(l),A({...c,resources:l}),T(!1)},G=l=>{if(window.confirm("Are you sure you want to delete this resource?")){const n=x.filter(u=>u.id!==l);S(n),A({...c,resources:n})}},J=()=>{if(!i.resourceId||!i.allocatedTo||i.allocatedQuantity<=0){alert("Please fill in all required fields");return}const l=x.find(o=>o.id===i.resourceId);if(l&&l.availableQuantity<i.allocatedQuantity){alert(`Insufficient quantity. Available: ${l.availableQuantity}`);return}const n={id:`alloc-${Date.now()}`,...i,status:"Planned"},u=[...I,n];w(u);const j=x.map(o=>o.id===i.resourceId?{...o,availableQuantity:o.availableQuantity-i.allocatedQuantity,allocatedQuantity:o.allocatedQuantity+i.allocatedQuantity}:o);S(j),A({...c,resources:j,resourceAllocations:u}),v({resourceId:"",allocatedTo:"",allocatedQuantity:0,startDate:"",endDate:"",notes:""})},q=l=>{switch(l){case"Material":return e.jsx(X,{size:16});case"Labor":return e.jsx(Y,{size:16});case"Equipment":return e.jsx(ue,{size:16});case"Subcontractor":return e.jsx(Y,{size:16});default:return e.jsx(X,{size:16})}},_=l=>{var o,O,B;const n=(o=c.schedule)==null?void 0:o.find(p=>p.id===l);if(n)return n.name;const u=(O=c.boq)==null?void 0:O.find(p=>p.id===l);if(u)return u.description;const j=(B=c.structures)==null?void 0:B.flatMap(p=>p.components).find(p=>p.id===l);return j?j.name:l};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs(W,{className:"p-4 mb-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Resource & Material Matrix"}),e.jsxs(g,{onClick:()=>k(),children:[e.jsx(H,{size:16,className:"mr-2"}),"Add Resource"]})]}),e.jsx(de,{value:Q.toString(),onValueChange:l=>$(parseInt(l)),className:"mb-4",children:e.jsxs(oe,{children:[e.jsx(M,{value:"0",children:"Resources"}),e.jsx(M,{value:"1",children:"Allocations"}),e.jsx(M,{value:"2",children:"Matrix View"})]})}),Q===0&&e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(y,{children:[e.jsx(a,{className:"font-bold",children:"Name"}),e.jsx(a,{className:"font-bold",children:"Type"}),e.jsx(a,{className:"font-bold",children:"Category"}),e.jsx(a,{className:"font-bold",children:"Unit"}),e.jsx(a,{className:"font-bold text-right",children:"Total Qty"}),e.jsx(a,{className:"font-bold text-right",children:"Available"}),e.jsx(a,{className:"font-bold text-right",children:"Allocated"}),e.jsx(a,{className:"font-bold",children:"Status"}),e.jsx(a,{className:"font-bold",children:"Criticality"}),e.jsx(a,{className:"font-bold",children:"Actions"})]})}),e.jsx(L,{children:x.map(l=>e.jsxs(y,{children:[e.jsx(a,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[q(l.type),e.jsx("span",{className:"font-bold text-sm",children:l.name})]})}),e.jsx(a,{children:e.jsx(R,{children:l.type})}),e.jsx(a,{children:l.category}),e.jsx(a,{children:l.unit}),e.jsx(a,{className:"text-right",children:l.totalQuantity}),e.jsx(a,{className:"text-right",children:l.availableQuantity}),e.jsx(a,{className:"text-right",children:l.allocatedQuantity}),e.jsx(a,{children:e.jsx(R,{children:l.status})}),e.jsx(a,{children:e.jsx(R,{children:l.criticality})}),e.jsx(a,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>k(l),children:"Edit"}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>G(l.id),children:"Delete"})]})})]},l.id))})]}),Q===1&&e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"p-4 mb-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Allocate Resources"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"resource-select",children:"Resource"}),e.jsxs(b,{value:i.resourceId,onValueChange:l=>v({...i,resourceId:l}),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select Resource"})}),e.jsx(C,{children:x.map(l=>e.jsxs(t,{value:l.id,children:[l.name," (",l.availableQuantity," available)"]},l.id))})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"allocate-to-select",children:"Allocate To"}),e.jsxs(b,{value:i.allocatedTo,onValueChange:l=>v({...i,allocatedTo:l}),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select Task/Item"})}),e.jsxs(C,{children:[e.jsx(t,{value:"",children:"Select Task/Item"}),(E=c.schedule)==null?void 0:E.map(l=>e.jsxs(t,{value:l.id,children:[l.name," (Schedule)"]},l.id)),(z=c.boq)==null?void 0:z.map(l=>e.jsxs(t,{value:l.id,children:[l.description," (BOQ)"]},l.id)),(P=c.structures)==null?void 0:P.flatMap(l=>l.components.map(n=>e.jsxs(t,{value:n.id,children:[n.name," - ",l.name," (Structure)"]},n.id)))]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"quantity-input",children:"Quantity"}),e.jsx(h,{id:"quantity-input",type:"number",value:i.allocatedQuantity,onChange:l=>v({...i,allocatedQuantity:Number(l.target.value)})})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"start-date-input",children:"Start Date"}),e.jsx(h,{id:"start-date-input",type:"date",value:i.startDate,onChange:l=>v({...i,startDate:l.target.value})})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"end-date-input",children:"End Date"}),e.jsx(h,{id:"end-date-input",type:"date",value:i.endDate,onChange:l=>v({...i,endDate:l.target.value})})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"notes-input",children:"Notes"}),e.jsx(h,{id:"notes-input",value:i.notes,onChange:l=>v({...i,notes:l.target.value})})]}),e.jsx("div",{className:"col-span-full",children:e.jsxs(g,{onClick:J,children:[e.jsx(H,{size:16,className:"mr-2"}),"Allocate Resource"]})})]})]}),e.jsxs(D,{className:"mt-4",children:[e.jsx(F,{children:e.jsxs(y,{children:[e.jsx(a,{className:"font-bold",children:"Resource"}),e.jsx(a,{className:"font-bold",children:"Allocated To"}),e.jsx(a,{className:"font-bold text-right",children:"Quantity"}),e.jsx(a,{className:"font-bold",children:"Period"}),e.jsx(a,{className:"font-bold",children:"Status"}),e.jsx(a,{className:"font-bold",children:"Notes"})]})}),e.jsx(L,{children:I.map(l=>{var n;return e.jsxs(y,{children:[e.jsx(a,{children:((n=x.find(u=>u.id===l.resourceId))==null?void 0:n.name)||l.resourceId}),e.jsx(a,{children:_(l.allocatedTo)}),e.jsx(a,{className:"text-right",children:l.allocatedQuantity}),e.jsxs(a,{children:[l.startDate," to ",l.endDate]}),e.jsx(a,{children:e.jsx(R,{children:l.status})}),e.jsx(a,{children:l.notes})]},l.id)})})]})]}),Q===2&&e.jsxs("div",{children:[e.jsx(le,{className:"mb-4",children:e.jsx(ae,{children:"Resource-Task Matrix showing allocation of resources to specific tasks and activities"})}),e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(y,{children:[e.jsx(a,{className:"font-bold",children:"Resource"}),(V=c.schedule)==null?void 0:V.slice(0,5).map(l=>e.jsx(U.Fragment,{children:e.jsxs(a,{className:"font-bold text-center",children:[l.name.substring(0,15),"..."]})},l.id)),e.jsx(a,{className:"font-bold",children:"Total Allocated"})]})}),e.jsx(L,{children:x.map(l=>{var n;return e.jsxs(y,{children:[e.jsx(a,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[q(l.type),e.jsx("span",{className:"font-bold text-sm",children:l.name})]})}),(n=c.schedule)==null?void 0:n.slice(0,5).map(u=>{const j=I.find(o=>o.resourceId===l.id&&o.allocatedTo===u.id);return e.jsx(U.Fragment,{children:e.jsx(a,{className:"text-center",children:j?j.allocatedQuantity:"-"})},u.id)}),e.jsx(a,{className:"text-right font-bold",children:l.allocatedQuantity})]},l.id)})})]})]})]}),e.jsxs(se,{open:Z,onOpenChange:T,children:[e.jsx(te,{children:e.jsx(ne,{children:s.id?"Edit Resource":"New Resource"})}),e.jsx(ie,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"name-input",children:"Name"}),e.jsx(h,{id:"name-input",value:s.name,onChange:l=>d({...s,name:l.target.value})})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"type-select",children:"Type"}),e.jsxs(b,{value:s.type,onValueChange:l=>d({...s,type:l}),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select Type"})}),e.jsxs(C,{children:[e.jsx(t,{value:"Material",children:"Material"}),e.jsx(t,{value:"Labor",children:"Labor"}),e.jsx(t,{value:"Equipment",children:"Equipment"}),e.jsx(t,{value:"Subcontractor",children:"Subcontractor"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"category-input",children:"Category"}),e.jsx(h,{id:"category-input",value:s.category,onChange:l=>d({...s,category:l.target.value})})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"unit-input",children:"Unit"}),e.jsx(h,{id:"unit-input",value:s.unit,onChange:l=>d({...s,unit:l.target.value})})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"unit-cost-input",children:"Unit Cost"}),e.jsx(h,{id:"unit-cost-input",type:"number",value:s.unitCost,onChange:l=>d({...s,unitCost:Number(l.target.value)})})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"total-quantity-input",children:"Total Quantity"}),e.jsx(h,{id:"total-quantity-input",type:"number",value:s.totalQuantity,onChange:l=>d({...s,totalQuantity:Number(l.target.value)})})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"status-select",children:"Status"}),e.jsxs(b,{value:s.status,onValueChange:l=>d({...s,status:l}),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select Status"})}),e.jsxs(C,{children:[e.jsx(t,{value:"Available",children:"Available"}),e.jsx(t,{value:"Allocated",children:"Allocated"}),e.jsx(t,{value:"In Transit",children:"In Transit"}),e.jsx(t,{value:"Reserved",children:"Reserved"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"criticality-select",children:"Criticality"}),e.jsxs(b,{value:s.criticality,onValueChange:l=>d({...s,criticality:l}),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select Criticality"})}),e.jsxs(C,{children:[e.jsx(t,{value:"Low",children:"Low"}),e.jsx(t,{value:"Medium",children:"Medium"}),e.jsx(t,{value:"High",children:"High"}),e.jsx(t,{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"supplier-select",children:"Supplier"}),e.jsxs(b,{value:s.supplier||"",onValueChange:l=>d({...s,supplier:l}),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select Supplier"})}),e.jsxs(C,{children:[e.jsx(t,{value:"",children:e.jsx("em",{children:"Select Supplier"})}),e.jsx(t,{value:"Nepal Cement Ltd",children:"Nepal Cement Ltd"}),e.jsx(t,{value:"Local Sand Suppliers",children:"Local Sand Suppliers"}),e.jsx(t,{value:"Local Stone Crushers",children:"Local Stone Crushers"}),e.jsx(t,{value:"Mukunda Steel",children:"Mukunda Steel"}),e.jsx(t,{value:"Equipment Rental Co.",children:"Equipment Rental Co."}),e.jsx(t,{value:"Local Asphalt Plant",children:"Local Asphalt Plant"}),e.jsx(t,{value:"Local Quarry",children:"Local Quarry"}),e.jsx(t,{value:"ABC Excavation",children:"ABC Excavation"}),e.jsx(t,{value:"XYZ Concrete Works",children:"XYZ Concrete Works"}),e.jsx(t,{value:"PQR Paving Solutions",children:"PQR Paving Solutions"}),e.jsx(t,{value:"Internal Team",children:"Internal Team"}),e.jsx(t,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"lead-time-input",children:"Lead Time (days)"}),e.jsx(h,{id:"lead-time-input",type:"number",value:s.leadTime,onChange:l=>d({...s,leadTime:Number(l.target.value)})})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"reorder-level-input",children:"Reorder Level"}),e.jsx(h,{id:"reorder-level-input",type:"number",value:s.reorderLevel,onChange:l=>d({...s,reorderLevel:Number(l.target.value)})})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(r,{htmlFor:"notes-textarea",children:"Notes"}),e.jsx(re,{id:"notes-textarea",value:s.notes,onChange:l=>d({...s,notes:l.target.value})})]})]})}),e.jsxs(ce,{children:[e.jsx(g,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsx(g,{onClick:K,children:"Save"})]})]})]})};export{ve as default};
