import{r as c,a5 as Q,j as e,B as u,P as ee,n as ae,aS as ve,b0 as je,t as ye,ah as fe,az as Ne,aA as Ae,O as se,G as Te,ag as Se,J as De,v as Ce,w as be,x as te,y,z as we,A as f,D as F,e as k,f as R,h as V,i as _,K as d,I as m,k as B,V as Ie,W as Pe,X as Oe,Y as Me,Z as L}from"./index-CewaSTRD.js";import{f as Ee}from"./exportUtils-B5u6ZY-6.js";import{T as Fe,a as ke,b as ne,c as re}from"./tabs-b2piEQ7z.js";import"./currencyUtils-RmnVW5tT.js";const Re=1,Ve=1e6;let U=0;function _e(){return U=(U+1)%Number.MAX_SAFE_INTEGER,U.toString()}const z=new Map,ie=t=>{if(z.has(t))return;const n=setTimeout(()=>{z.delete(t),T({type:"REMOVE_TOAST",toastId:t})},Ve);z.set(t,n)},Be=(t,n)=>{switch(n.type){case"ADD_TOAST":return{...t,toasts:[n.toast,...t.toasts].slice(0,Re)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(r=>r.id===n.toast.id?{...r,...n.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=n;return r?ie(r):t.toasts.forEach(x=>{ie(x.id)}),{...t,toasts:t.toasts.map(x=>x.id===r||r===void 0?{...x,open:!1}:x)}}case"REMOVE_TOAST":return n.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(r=>r.id!==n.toastId)}}},P=[];let O={toasts:[]};function T(t){O=Be(O,t),P.forEach(n=>{n(O)})}function Le({...t}){const n=_e(),r=N=>T({type:"UPDATE_TOAST",toast:{...N,id:n}}),x=()=>T({type:"DISMISS_TOAST",toastId:n});return T({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:N=>{N||x()}}}),{id:n,dismiss:x,update:r}}function Ue(){const[t,n]=c.useState(O);return c.useEffect(()=>(P.push(n),()=>{const r=P.indexOf(n);r>-1&&P.splice(r,1)}),[t]),{...t,toast:Le,dismiss:r=>T({type:"DISMISS_TOAST",toastId:r})}}const ra=({project:t,onProjectUpdate:n,userRole:r,settings:x})=>{var W,X,Z,K;const[N,le]=c.useState("vendors"),[ce,S]=c.useState(!1),[G,D]=c.useState(!1),[de,C]=c.useState(!1),[ze,Ge]=c.useState(!1),[$e,qe]=c.useState(!1),[He,Ye]=c.useState(!1),[g,$]=c.useState(null),[Je,q]=c.useState(null),[H,M]=c.useState(null),{toast:oe}=Ue(),b=((W=t.agencies)==null?void 0:W.filter(a=>a.type==="agency"))||[],w=((X=t.agencies)==null?void 0:X.filter(a=>a.type==="subcontractor"))||[],me=(t.agencyPayments||[]).filter(a=>a.agencyId&&b.concat(w).some(l=>l.id===a.agencyId)),[s,o]=c.useState({name:"",trade:"",contactPerson:"",phone:"",email:"",address:"",status:"Active",type:"agency",contractValue:0,startDate:"",endDate:"",materialCategories:[],deliveryAreas:[],preferredDeliveryMethods:[],licenseNumber:"",taxId:"",paymentTerms:"",deliveryLeadTime:7,avatar:""}),[i,j]=c.useState({date:new Date().toISOString().split("T")[0],amount:0,reference:"",type:"Bill Payment",description:""}),[We,Xe]=c.useState({materialId:"",rate:0,effectiveDate:new Date().toISOString().split("T")[0],status:"Active",description:""}),[Ze,Ke]=c.useState({materialName:"",quantity:1,unit:"",rate:0,receivedDate:new Date().toISOString().split("T")[0],status:"Ordered",remarks:"",orderedDate:new Date().toISOString().split("T")[0],expectedDeliveryDate:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0],deliveryLocation:"",transportMode:"",deliveryCharges:0,taxAmount:0}),[Qe,ea]=c.useState({billNumber:"",date:new Date().toISOString().split("T")[0],periodFrom:new Date().toISOString().split("T")[0],periodTo:new Date().toISOString().split("T")[0],items:[],grossAmount:0,netAmount:0,status:"Draft",description:""}),E=b.concat(w).find(a=>a.id===g);E!=null&&E.rates,(Z=t.agencyMaterials)!=null&&Z.filter(a=>a.agencyId===g),(K=t.agencyBills)!=null&&K.filter(a=>a.agencyId===g);const h=(a,l="success")=>{oe({title:l==="error"?"Error":l==="warning"?"Warning":"Info",description:a,variant:l==="error"?"destructive":"default"})},he=()=>{o({name:"",trade:"",contactPerson:"",phone:"",email:"",address:"",status:"Active",type:"agency",contractValue:0,startDate:"",endDate:"",materialCategories:[],deliveryAreas:[],preferredDeliveryMethods:[],licenseNumber:"",taxId:"",paymentTerms:"",deliveryLeadTime:7,avatar:""}),q(null),M(null),S(!0)},ue=a=>{o({id:a.id,name:a.name,trade:a.trade,contactPerson:a.contactPerson,phone:a.phone,email:a.email,address:a.address,status:a.status,type:a.type||"agency",contractValue:a.contractValue,startDate:a.startDate,endDate:a.endDate,avatar:a.avatar}),M(a.avatar||null),D(!0)},Y=r===Q.ADMIN||r===Q.PROJECT_MANAGER,xe=a=>{var l,p;if(!Y){h("Only Admin and Project Manager can delete agencies","error");return}if(window.confirm("Are you sure you want to delete this agency? This will also delete all associated payments.")){const I=((l=t.agencies)==null?void 0:l.filter(v=>v.id!==a))||[],A=((p=t.agencyPayments)==null?void 0:p.filter(v=>v.agencyId!==a))||[];n({...t,agencies:I,agencyPayments:A}),g===a&&$(null)}},J=()=>{var l,p,I;if(!((l=s.name)!=null&&l.trim())){h("Agency name is required","error");return}if(!((p=s.trade)!=null&&p.trim())){h("Trade is required","error");return}if(s.contractValue&&s.contractValue<0){h("Contract value must be a positive number","error");return}if(s.phone&&!/^\+?[1-9][\d\-\s]{8,}$/.test(s.phone)){h("Please enter a valid phone number","error");return}if(s.email&&!/^[\w\.-]+@[\w\.-]+\.[a-zA-Z]{2,}$/.test(s.email)){h("Please enter a valid email address","error");return}if(s.startDate&&s.endDate&&new Date(s.startDate)>new Date(s.endDate)){h("Start date cannot be later than end date","error");return}let a="";if(H?a=H:a=`https://ui-avatars.com/api/?name=${encodeURIComponent(s.name||"Agency")}&background=random`,G&&s.id){const A=((I=t.agencies)==null?void 0:I.map(v=>v.id===s.id?{...v,...s,avatar:a,materialCategories:s.materialCategories,deliveryAreas:s.deliveryAreas,preferredDeliveryMethods:s.preferredDeliveryMethods,licenseNumber:s.licenseNumber,taxId:s.taxId,paymentTerms:s.paymentTerms,deliveryLeadTime:s.deliveryLeadTime}:v))||[];n({...t,agencies:A})}else{const A={id:`agency-${Date.now()}`,name:s.name,trade:s.trade,contactPerson:s.contactPerson||"",phone:s.phone||"",email:s.email||"",address:s.address||"",status:s.status||"Active",type:s.type||"agency",contractValue:s.contractValue||0,startDate:s.startDate||"",endDate:s.endDate||"",avatar:a,materialCategories:s.materialCategories,deliveryAreas:s.deliveryAreas,preferredDeliveryMethods:s.preferredDeliveryMethods,licenseNumber:s.licenseNumber,taxId:s.taxId,paymentTerms:s.paymentTerms,deliveryLeadTime:s.deliveryLeadTime};n({...t,agencies:[...t.agencies||[],A]})}S(!1),D(!1),o({name:"",trade:"",contactPerson:"",phone:"",email:"",address:"",status:"Active",type:"agency",contractValue:0,startDate:"",endDate:"",materialCategories:[],deliveryAreas:[],preferredDeliveryMethods:[],licenseNumber:"",taxId:"",paymentTerms:"",deliveryLeadTime:7,avatar:""}),q(null),M(null)},ge=()=>{var l;if(!g){h("Please select an agency first","error");return}if(!i.amount||isNaN(Number(i.amount))||Number(i.amount)<=0){h("Please enter a valid positive amount","error");return}if(!((l=i.reference)!=null&&l.trim())){h("Please enter a reference number","error");return}if(!i.date){h("Please select a payment date","error");return}const a={id:`pay-${Date.now()}`,agencyId:g,date:i.date,amount:Number(i.amount),reference:i.reference,type:i.type||"Bill Payment",description:i.description||"",status:"Confirmed"};n({...t,agencyPayments:[...t.agencyPayments||[],a]}),C(!1),j({date:new Date().toISOString().split("T")[0],amount:0,reference:"",type:"Bill Payment",description:""})},pe=()=>{if(!g){h("Please select an agency first","error");return}j({...i,agencyId:g}),C(!0)};return e.jsxs("div",{className:"animate-in fade-in duration-500 p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4 items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-indigo-600 tracking-widest uppercase",children:"AGENCY MANAGEMENT"}),e.jsx("h1",{className:"text-2xl font-black text-slate-800",children:"Agency & Vendor Hub"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Manage agencies, subcontractors, and vendor relationships"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(u,{onClick:he,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"})," Add Agency"]})})]}),e.jsx(ae,{children:e.jsxs(Fe,{value:N,onValueChange:le,children:[e.jsxs(ke,{className:"grid w-full grid-cols-2",children:[e.jsxs(ne,{value:"vendors",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Vendors"]}),e.jsxs(ne,{value:"payments",children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Payments"]})]}),e.jsx(re,{value:"vendors",className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.concat(w).map(a=>e.jsx(ae,{className:"cursor-pointer hover:shadow-md transition-shadow",children:e.jsxs(ye,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs(fe,{children:[e.jsx(Ne,{src:a.avatar}),e.jsx(Ae,{children:a.name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.trade})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Status:"}),e.jsx(se,{variant:a.status==="Active"?"default":"secondary",children:a.status})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Type:"}),e.jsx("span",{children:a.type})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Contact:"}),e.jsx("span",{children:a.contactPerson})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>ue(a),children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>$(a.id),children:e.jsx(Se,{className:"h-4 w-4"})}),Y&&e.jsx(u,{variant:"outline",size:"sm",onClick:()=>xe(a.id),children:e.jsx(De,{className:"h-4 w-4"})})]})]})},a.id))})}),e.jsxs(re,{value:"payments",className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4 items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Agency Payments"}),e.jsxs(u,{onClick:pe,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"})," Add Payment"]})]}),e.jsxs(Ce,{children:[e.jsx(be,{children:e.jsxs(te,{children:[e.jsx(y,{children:"Agency"}),e.jsx(y,{children:"Date"}),e.jsx(y,{children:"Reference"}),e.jsx(y,{children:"Type"}),e.jsx(y,{className:"text-right",children:"Amount"}),e.jsx(y,{children:"Status"})]})}),e.jsx(we,{children:me.map(a=>{var l;return e.jsxs(te,{children:[e.jsx(f,{children:((l=b.concat(w).find(p=>p.id===a.agencyId))==null?void 0:l.name)||"Unknown"}),e.jsx(f,{children:a.date}),e.jsx(f,{children:a.reference}),e.jsx(f,{children:a.type}),e.jsx(f,{className:"text-right",children:Ee(a.amount,x)}),e.jsx(f,{children:e.jsx(se,{variant:a.status==="Confirmed"?"default":"secondary",children:a.status})})]},a.id)})})]})]})]})}),e.jsx(F,{open:ce,onOpenChange:S,children:e.jsxs(k,{className:"sm:max-w-[600px]",children:[e.jsxs(R,{children:[e.jsx(V,{children:"Add New Agency"}),e.jsx(_,{children:"Enter the details for the new agency."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"name",className:"text-right",children:"Name"}),e.jsx(m,{id:"name",value:s.name,onChange:a=>o({...s,name:a.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"trade",className:"text-right",children:"Trade"}),e.jsx(m,{id:"trade",value:s.trade,onChange:a=>o({...s,trade:a.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"contact",className:"text-right",children:"Contact"}),e.jsx(m,{id:"contact",value:s.contactPerson,onChange:a=>o({...s,contactPerson:a.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(m,{id:"phone",value:s.phone,onChange:a=>o({...s,phone:a.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(m,{id:"email",value:s.email,onChange:a=>o({...s,email:a.target.value}),className:"col-span-3"})]})]}),e.jsxs(B,{children:[e.jsx(u,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(u,{onClick:J,children:"Save Agency"})]})]})}),e.jsx(F,{open:G,onOpenChange:D,children:e.jsxs(k,{className:"sm:max-w-[600px]",children:[e.jsxs(R,{children:[e.jsx(V,{children:"Edit Agency"}),e.jsx(_,{children:"Update the agency details."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"edit-name",className:"text-right",children:"Name"}),e.jsx(m,{id:"edit-name",value:s.name,onChange:a=>o({...s,name:a.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"edit-trade",className:"text-right",children:"Trade"}),e.jsx(m,{id:"edit-trade",value:s.trade,onChange:a=>o({...s,trade:a.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"edit-contact",className:"text-right",children:"Contact"}),e.jsx(m,{id:"edit-contact",value:s.contactPerson,onChange:a=>o({...s,contactPerson:a.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"edit-phone",className:"text-right",children:"Phone"}),e.jsx(m,{id:"edit-phone",value:s.phone,onChange:a=>o({...s,phone:a.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"edit-email",className:"text-right",children:"Email"}),e.jsx(m,{id:"edit-email",value:s.email,onChange:a=>o({...s,email:a.target.value}),className:"col-span-3"})]})]}),e.jsxs(B,{children:[e.jsx(u,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),e.jsx(u,{onClick:J,children:"Update Agency"})]})]})}),e.jsx(F,{open:de,onOpenChange:C,children:e.jsxs(k,{className:"sm:max-w-[500px]",children:[e.jsxs(R,{children:[e.jsx(V,{children:"Add Payment"}),e.jsx(_,{children:"Record a payment to the selected agency."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"payment-date",className:"text-right",children:"Date"}),e.jsx(m,{id:"payment-date",type:"date",value:i.date,onChange:a=>j({...i,date:a.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"payment-amount",className:"text-right",children:"Amount"}),e.jsx(m,{id:"payment-amount",type:"number",value:i.amount,onChange:a=>j({...i,amount:Number(a.target.value)}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"payment-reference",className:"text-right",children:"Reference"}),e.jsx(m,{id:"payment-reference",value:i.reference,onChange:a=>j({...i,reference:a.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(d,{htmlFor:"payment-type",className:"text-right",children:"Type"}),e.jsxs(Ie,{value:i.type,onValueChange:a=>j({...i,type:a}),children:[e.jsx(Pe,{className:"col-span-3",children:e.jsx(Oe,{})}),e.jsxs(Me,{children:[e.jsx(L,{value:"Advance",children:"Advance"}),e.jsx(L,{value:"Bill Payment",children:"Bill Payment"}),e.jsx(L,{value:"Retention",children:"Retention"})]})]})]})]}),e.jsxs(B,{children:[e.jsx(u,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(u,{onClick:ge,children:"Save Payment"})]})]})})]})};export{ra as default};
