const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CNWtt4QL.js","assets/index-CewaSTRD.js","assets/index-BYBA0f86.css","assets/tiny-invariant-CopsF_GD.js"])))=>i.map(i=>d[i]);
import{c as Oe,r as m,j as e,ah as ss,aA as ts,Q as L,U as as,B as o,a5 as we,n as _,o as ns,P as Ce,aJ as H,M as ye,u as ls,I as b,v as rs,w as is,x as J,y as k,z as os,A as D,ac as v,O as Se,aT as cs,aU as ds,aV as ms,aW as xs,aX as De,J as Ue,D as ke,e as Ie,f as Le,h as Te,i as us,aC as hs,V as X,W as q,X as K,Y as Q,Z as I,k as fs,a8 as Ae,C as ps,_ as js}from"./index-CewaSTRD.js";import{o as Re}from"./ocrService-D7IQRzPx.js";import{F as Y,E as Me}from"./folder-BKxSgyFR.js";import{I as gs}from"./image-Bteq2faF.js";import{E as Ns}from"./ellipsis-vertical-C9SMr15X.js";import{S as Ee}from"./sparkles-CWxKTUax.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=Oe("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=Oe("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]),vs=({entityId:i,entityType:R,comments:h,onAddComment:T,currentUser:M})=>{const[N,p]=m.useState(""),E=()=>{N.trim()&&(T({entityId:i,entityType:R,authorId:M.id,authorName:M.name,content:N.trim()}),p(""))};return e.jsxs("div",{className:"mt-4 pt-4 border-t border-solid border-border",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Comments"}),e.jsxs("div",{className:"space-y-4",children:[h.map(u=>e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(ss,{className:"h-8 w-8",children:e.jsx(ts,{children:u.authorName.charAt(0)})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("p",{className:"font-semibold text-sm",children:u.authorName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(u.timestamp).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-foreground mt-1",children:u.content})]})]},u.id)),h.length===0&&e.jsx("p",{className:"text-muted-foreground text-sm",children:"No comments yet. Be the first to add one!"})]}),e.jsx(L,{className:"my-6"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(as,{value:N,onChange:u=>p(u.target.value),placeholder:"Write a comment...",rows:3,className:"resize-none"}),e.jsx(o,{onClick:E,className:"self-end",children:"Add Comment"})]})]})};let Z,ee,V;const Fe=["General","Contracts","Drawings","Reports","Correspondence","Financials","Sub-Docs"],ks=({project:i,userRole:R,onProjectUpdate:h})=>{var de,me;const T=s=>new Promise((n,r)=>{const a=new FileReader;a.readAsDataURL(s),a.onload=()=>n(a.result),a.onerror=l=>r(l)}),M=s=>{try{const n=atob(s.split(",")[1]),r=s.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(n.length),l=new Uint8Array(a);for(let x=0;x<n.length;x++)l[x]=n.charCodeAt(x);const c=new Blob([a],{type:r});return URL.createObjectURL(c)}catch(n){return console.error("Error converting base64 to blob URL:",n),""}},N=s=>s.fileUrl?s.fileUrl.startsWith("data:")?M(s.fileUrl):s.fileUrl:"";m.useEffect(()=>((async()=>{try{const n=await js(()=>import("./index-CNWtt4QL.js"),__vite__mapDeps([0,1,2,3]));Z=n.Document,ee=n.Page,V=n.pdfjs,V&&V.GlobalWorkerOptions&&(V.GlobalWorkerOptions.workerSrc="/pdfjs-worker/pdf.worker.min.mjs")}catch(n){console.warn("Failed to load PDF components:",n),Z=()=>e.jsx("div",{className:"text-center p-4 text-muted-foreground",children:"PDF viewer unavailable"}),ee=()=>e.jsx("div",{className:"text-center p-4 text-muted-foreground",children:"PDF page unavailable"})}})(),()=>{var n;(n=i.documents)==null||n.forEach(r=>{r.fileUrl&&r.fileUrl.startsWith("blob:")&&URL.revokeObjectURL(r.fileUrl)}),t!=null&&t.fileUrl&&t.fileUrl.startsWith("blob:")&&URL.revokeObjectURL(t.fileUrl)}),[i.documents]);const[p,E]=m.useState("General"),[u,ze]=m.useState(""),[Ve,P]=m.useState(!1),[F,se]=m.useState("SIMPLE"),[g,A]=m.useState("IDLE"),[d,w]=m.useState({subject:"",refNo:"",date:"",letterDate:"",correspondenceType:void 0,sender:"",recipient:"",subId:""}),[U,W]=m.useState([]),[t,f]=m.useState(null),[$,te]=m.useState(""),[O,B]=m.useState(1),[z,We]=m.useState(null),[ae,ne]=m.useState(1),$e=({numPages:s})=>{We(s),B(1)},Be=()=>B(s=>Math.max(1,s-1)),Ge=()=>z!==null&&B(s=>Math.min(z,s+1)),_e=()=>ne(s=>Math.min(2,s+.2)),He=()=>ne(s=>Math.max(.5,s-.2)),le=((de=i.agencies)==null?void 0:de.filter(s=>s.type==="subcontractor"))||[],re=m.useMemo(()=>(i.documents||[]).filter(s=>{var n;return(s.folder===p||p==="All")&&(s.name.toLowerCase().includes(u.toLowerCase())||((n=s.subject)==null?void 0:n.toLowerCase().includes(u.toLowerCase())))}),[i.documents,p,u]),Je=s=>{s.target.files&&W(Array.from(s.target.files))},Xe=async()=>{if(U.length===0)return;A("PROCESSING");const s=U[0];if((i.documents||[]).find(a=>a.name===s.name&&Math.abs(parseFloat(a.size)-parseFloat(`${(s.size/1024/1024).toFixed(2)}`))<.1)){alert(`Document '${s.name}' already exists. Skipping duplicate.`),A("IDLE");return}const r=new FileReader;r.onloadend=async()=>{var xe,ue,he,fe,pe,je,ge,Ne,be,ve;await Re.initialize();const l=(await Re.processDocument(s)).structuredData,c=((xe=l.subjects)==null?void 0:xe[0])||((ue=l.invoices)==null?void 0:ue[0])||((he=l.codes)==null?void 0:he[0])||"Document Analysis",x=((fe=l.refs)==null?void 0:fe[0])||((pe=l.codes)==null?void 0:pe[0])||((je=l.invoices)==null?void 0:je[0])||"",C=((ge=l.dates)==null?void 0:ge[0])||"",y=new Date().toISOString().split("T")[0],S=((Ne=l.senders)==null?void 0:Ne[0])||((be=l.contractors)==null?void 0:be[0])||"Unknown",j=((ve=l.recipients)==null?void 0:ve[0])||"Project Team",G=S.includes("Project")||S.includes("Team")?"outgoing":"incoming";w({subject:c,refNo:x,date:y,letterDate:C,correspondenceType:G,sender:S,recipient:j,subId:""}),A("REVIEW")},r.readAsDataURL(s)},ie=(s,n)=>{const r=n.trim();if(!r)return;const a=(i.documents||[]).map(l=>{if(l.id===s){const c=l.tags||[];return c.includes(r)?l:{...l,tags:[...c,r]}}return l});h({...i,documents:a}),t&&t.id===s&&f(l=>l?{...l,tags:[...l.tags||[],r]}:null),te("")},qe=(s,n)=>{const r=(i.documents||[]).map(a=>a.id===s?{...a,tags:(a.tags||[]).filter(l=>l!==n)}:a);h({...i,documents:r}),t&&t.id===s&&f(a=>a?{...a,tags:(a.tags||[]).filter(l=>l!==n)}:null)},Ke=async()=>{var r;const s=[],n=[];for(const a of U){if((i.documents||[]).find(j=>j.name===a.name&&Math.abs(parseFloat(j.size)-parseFloat(`${(a.size/1024/1024).toFixed(2)}`))<.1)){n.push(a.name);continue}const x={id:`ver-${Date.now()}-${Math.random()}`,version:1,date:new Date().toISOString().split("T")[0],size:`${(a.size/1024/1024).toFixed(2)} MB`,filePath:`uploads/${Date.now()}_${a.name}`,uploadedBy:"Current User"},C=await T(a),y=a.type.includes("image")||[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(j=>a.name.toLowerCase().endsWith(j)),S=a.type.includes("pdf")||a.name.toLowerCase().endsWith(".pdf");s.push({id:`doc-${Date.now()}-${Math.random()}`,name:a.name,type:y?"IMAGE":S?"PDF":"OTHER",date:g==="REVIEW"?d.date:new Date().toISOString().split("T")[0],size:`${(a.size/1024/1024).toFixed(2)} MB`,folder:oe,tags:d.subId?[((r=le.find(j=>j.id===d.subId))==null?void 0:r.name)||""]:[],subject:g==="REVIEW"?d.subject:void 0,refNo:g==="REVIEW"?d.refNo:void 0,letterDate:g==="REVIEW"?d.letterDate:void 0,correspondenceType:g==="REVIEW"?d.correspondenceType:void 0,fileUrl:C,currentVersion:1,versions:[x],createdBy:"Current User",lastModified:new Date().toISOString().split("T")[0],status:"Active"})}s.length>0&&h({...i,documents:[...i.documents||[],...s]}),n.length>0&&alert(`Skipped ${n.length} duplicate document(s): ${n.join(", ")}`),s.length>0&&alert(`Successfully added ${s.length} document(s).`),P(!1),W([]),A("IDLE")},[oe,Qe]=m.useState("General"),Ye=R===we.ADMIN||R===we.PROJECT_MANAGER,ce=s=>{if(!Ye){alert("Only Admin and Project Manager can delete documents");return}if(confirm("Permanently delete this document?")){const n=(i.documents||[]).find(r=>r.id===s);n!=null&&n.fileUrl&&n.fileUrl.startsWith("blob:")&&URL.revokeObjectURL(n.fileUrl),(t==null?void 0:t.id)===s&&t.fileUrl&&t.fileUrl.startsWith("blob:")&&URL.revokeObjectURL(t.fileUrl),h({...i,documents:(i.documents||[]).filter(r=>r.id!==s)}),(t==null?void 0:t.id)===s&&f(null)}},Ze=async(s,n)=>{const r=(i.documents||[]).find(l=>l.id===s);if(r){const l=r.versions.find(c=>c.version===r.currentVersion);if(l&&l.filePath.split("_").pop()===n.name&&Math.abs(parseFloat(l.size)-parseFloat(`${(n.size/1024/1024).toFixed(2)} MB`))<.1){alert("This file appears to be the same as the current version. Not adding as new version.");return}}const a=[];for(const l of i.documents||[])if(l.id===s){l.fileUrl&&l.fileUrl.startsWith("blob:")&&URL.revokeObjectURL(l.fileUrl);const c=l.versions.length+1,C={id:`ver-${Date.now()}-${Math.random()}`,version:c,date:new Date().toISOString().split("T")[0],size:`${(n.size/1024/1024).toFixed(2)} MB`,filePath:`uploads/${Date.now()}_${n.name}`,uploadedBy:"Current User",notes:"Uploaded new version"},y=await T(n),S=n.type.includes("image")||[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(G=>n.name.toLowerCase().endsWith(G)),j=n.type.includes("pdf")||n.name.toLowerCase().endsWith(".pdf");a.push({...l,type:S?"IMAGE":j?"PDF":"OTHER",fileUrl:y,versions:[...l.versions,C],currentVersion:c,lastModified:new Date().toISOString().split("T")[0]})}else a.push(l);if(h({...i,documents:a}),(t==null?void 0:t.id)===s){const l=await T(n);f(c=>{if(!c)return null;c.fileUrl&&c.fileUrl.startsWith("blob:")&&URL.revokeObjectURL(c.fileUrl);const x=n.type.includes("image")||[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(y=>n.name.toLowerCase().endsWith(y)),C=n.type.includes("pdf")||n.name.toLowerCase().endsWith(".pdf");return{...c,type:x?"IMAGE":C?"PDF":"OTHER",fileUrl:l}})}},es=(s,n)=>{const r=(i.documents||[]).map(a=>{if(a.id===s){const l=a.fileUrl;l&&l.startsWith("blob:")&&URL.revokeObjectURL(l);const c=a.versions.find(x=>x.id===n);if(c)return{...a,currentVersion:c.version,lastModified:new Date().toISOString().split("T")[0]}}return a});h({...i,documents:r}),(t==null?void 0:t.id)===s&&f(a=>a?(a.fileUrl&&a.fileUrl.startsWith("blob:")&&URL.revokeObjectURL(a.fileUrl),{...a,fileUrl:void 0}):null)};return e.jsxs("div",{className:"flex h-[calc(100vh-140px)] gap-4 p-4",children:[e.jsxs(_,{className:"w-60 flex flex-col",children:[e.jsx(ns,{className:"border-b px-4 py-3",children:e.jsxs(o,{onClick:()=>P(!0),className:"w-full",children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"})," New Upload"]})}),e.jsxs(H,{className:"flex-1 p-2",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-2 px-2",children:"Folders"}),e.jsxs(o,{variant:p==="All"?"secondary":"ghost",className:"w-full justify-start mb-1",onClick:()=>E("All"),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"})," All Documents"]}),e.jsx(L,{className:"my-2"}),Fe.map(s=>e.jsxs(o,{variant:p===s?"secondary":"ghost",className:"w-full justify-start mb-1",onClick:()=>E(s),children:[e.jsx(Y,{className:ye("mr-2 h-4 w-4",p===s?"text-indigo-600":"text-slate-400")})," ",s]},s))]})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(Y,{className:"h-4 w-4"})," ",e.jsx("span",{children:"Project Storage"})," ",e.jsx("span",{className:"mx-1",children:"/"})," ",e.jsx("span",{className:"font-semibold text-foreground",children:p})]}),e.jsxs("div",{className:"relative w-72",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(b,{placeholder:"Search files...",className:"pl-10",value:u,onChange:s=>ze(s.target.value)})]})]}),e.jsx(_,{className:"flex-1 overflow-hidden",children:e.jsx(H,{className:"h-full w-full rounded-md border",children:e.jsxs(rs,{children:[e.jsx(is,{className:"bg-slate-50",children:e.jsxs(J,{children:[e.jsx(k,{children:"Name"}),e.jsx(k,{children:"Reference / Subject"}),e.jsx(k,{children:"Tags"}),e.jsx(k,{children:"Date"}),e.jsx(k,{children:"Size"}),e.jsx(k,{className:"text-right",children:"Actions"})]})}),e.jsx(os,{children:re.length>0?re.map(s=>{var n;return e.jsxs(J,{className:"cursor-pointer",onClick:()=>f(s),children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="Unavailable"?e.jsx(v,{className:"h-4 w-4 text-gray-400"}):s.type==="IMAGE"?e.jsx(gs,{className:"h-4 w-4 text-blue-500"}):e.jsx(v,{className:"h-4 w-4 text-rose-500"}),e.jsxs("span",{className:ye("font-medium",s.status==="Unavailable"&&"line-through text-muted-foreground"),children:[s.name," ",s.status==="Unavailable"&&" (Unavailable)"]})]})}),e.jsxs(D,{children:[e.jsx("p",{className:"font-semibold text-sm",children:s.refNo||"-"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate w-[200px]",children:s.subject||"No subject"})]}),e.jsx(D,{children:e.jsx("div",{className:"flex gap-1 flex-wrap max-w-[200px]",children:(n=s.tags)==null?void 0:n.map((r,a)=>e.jsx(Se,{variant:"outline",className:"h-4 text-xs",children:r},a))})}),e.jsx(D,{className:"text-sm text-muted-foreground",children:s.date}),e.jsx(D,{className:"text-sm text-muted-foreground",children:s.size}),e.jsx(D,{className:"text-right",children:e.jsxs(cs,{children:[e.jsx(ds,{asChild:!0,children:e.jsxs(o,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Ns,{className:"h-4 w-4"})]})}),e.jsxs(ms,{align:"end",children:[e.jsx(xs,{children:"Actions"}),e.jsxs(De,{onClick:()=>handleDownloadDocument(s),children:[e.jsx(bs,{className:"mr-2 h-4 w-4"})," Download"]}),e.jsxs(De,{onClick:()=>ce(s.id),children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})})]},s.id)}):e.jsx(J,{children:e.jsxs(D,{colSpan:6,className:"h-60 text-center text-muted-foreground",children:[e.jsx(Pe,{className:"mx-auto h-12 w-12 text-slate-300 mb-2"}),"No files in this folder."]})})})]})})})]}),e.jsx(ke,{open:Ve,onOpenChange:P,children:e.jsxs(Ie,{className:"sm:max-w-[800px]",children:[e.jsxs(Le,{children:[e.jsx(Te,{children:"Add to Project Archive"}),e.jsx(us,{children:"Upload documents or scan them using AI OCR."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[e.jsx("div",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed rounded-lg h-80 bg-muted/20",children:U.length>0?e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"mx-auto h-12 w-12 text-primary mb-2"}),e.jsx("p",{className:"font-semibold truncate w-48 mx-auto",children:U[0].name}),e.jsx(o,{variant:"link",size:"sm",onClick:()=>{W([]),A("IDLE")},children:"Clear"}),F==="SCAN"&&e.jsxs(o,{className:"w-full mt-4",onClick:Xe,disabled:g==="PROCESSING",children:[g==="PROCESSING"?e.jsx(hs,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ee,{className:"mr-2 h-4 w-4"}),g==="PROCESSING"?"Reading Content...":"Analyze Document"]})]}):e.jsxs(o,{className:"relative",children:["Browse Files",e.jsx(b,{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",multiple:F==="SIMPLE",onChange:Je})]})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:F==="SIMPLE"?"secondary":"outline",onClick:()=>se("SIMPLE"),className:"flex-1",children:"Standard Upload"}),e.jsxs(o,{variant:F==="SCAN"?"secondary":"outline",onClick:()=>se("SCAN"),className:"flex-1",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"})," AI OCR Scan"]})]}),e.jsxs(X,{value:oe,onValueChange:Qe,children:[e.jsx(q,{children:e.jsx(K,{placeholder:"Target Folder"})}),e.jsx(Q,{children:Fe.map(s=>e.jsx(I,{value:s,children:s},s))})]}),e.jsxs(X,{value:d.subId,onValueChange:s=>w({...d,subId:s}),children:[e.jsx(q,{children:e.jsx(K,{placeholder:"Associated Subcontractor"})}),e.jsxs(Q,{children:[e.jsx(I,{value:"",children:"None / General"}),le.map(s=>e.jsx(I,{value:s.id,children:s.name},s.id))]})]}),e.jsx(b,{placeholder:"Subject Line",value:d.subject,onChange:s=>w({...d,subject:s.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{placeholder:"Reference No",value:d.refNo,onChange:s=>w({...d,refNo:s.target.value})}),e.jsx(b,{type:"date",value:d.letterDate,onChange:s=>w({...d,letterDate:s.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{value:d.correspondenceType||"",onValueChange:s=>w({...d,correspondenceType:s}),children:[e.jsx(q,{children:e.jsx(K,{placeholder:"Correspondence Type"})}),e.jsxs(Q,{children:[e.jsx(I,{value:"",children:"Not Specified"}),e.jsx(I,{value:"incoming",children:"Incoming"}),e.jsx(I,{value:"outgoing",children:"Outgoing"})]})]}),e.jsx(b,{type:"date",value:d.date,onChange:s=>w({...d,date:s.target.value})})]})]})]}),e.jsxs(fs,{children:[e.jsx(o,{variant:"outline",onClick:()=>P(!1),children:"Cancel"}),e.jsx(o,{onClick:Ke,disabled:U.length===0||g==="PROCESSING",children:"Save to Database"})]})]})}),e.jsx(ke,{open:!!t,onOpenChange:()=>f(null),children:t&&e.jsxs(Ie,{className:"max-w-[calc(100vw-6rem)] h-[calc(100vh-6rem)] flex flex-col p-0",children:[e.jsxs(Le,{className:"flex flex-row items-center justify-between px-6 py-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5 text-primary"}),e.jsx(Te,{className:"text-lg font-bold",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:N(t),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"})," Open Full"]})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>f(null),children:e.jsx(Ae,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden bg-muted/20",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:t.fileUrl?e.jsxs("div",{className:"w-full h-full flex flex-col",children:[t.type==="PDF"||t.fileUrl.toLowerCase().endsWith(".pdf")?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(Z,{file:N(t),loading:e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading PDF..."}),error:e.jsxs("div",{className:"flex flex-col items-center justify-center p-4 text-destructive",children:[e.jsx(v,{className:"h-12 w-12 mb-2"}),e.jsx("p",{children:"Failed to load PDF"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 text-center",children:"This document may have an expired link. Please re-upload the file."})]}),onLoadSuccess:$e,onError:()=>{var s;if((s=t.fileUrl)!=null&&s.startsWith("blob:")){const n=(i.documents||[]).map(r=>r.id===t.id?{...r,status:"Unavailable",fileUrl:void 0}:r);h({...i,documents:n}),f(r=>r?{...r,status:"Unavailable",fileUrl:void 0}:null)}},children:e.jsx(ee,{pageNumber:O,scale:ae,renderTextLayer:!1,renderAnnotationLayer:!1})})}):t.type==="IMAGE"||[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(s=>t.fileUrl.toLowerCase().endsWith(s))?e.jsx("img",{src:N(t),alt:"Document Preview",className:"max-w-full max-h-full object-contain rounded-lg"}):e.jsxs("div",{className:"text-center p-4 text-muted-foreground",children:[e.jsx(v,{className:"mx-auto h-12 w-12 mb-2"}),e.jsx("p",{children:"Preview not available for this file type"}),e.jsx("p",{className:"text-sm",children:t.name}),e.jsx(o,{variant:"outline",size:"sm",className:"mt-4",asChild:!0,children:e.jsxs("a",{href:N(t),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"})," Download File"]})})]}),(t.type==="PDF"||t.fileUrl.toLowerCase().endsWith(".pdf"))&&e.jsxs("div",{className:"flex items-center justify-center gap-2 p-2 bg-background/50 border-t",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:Be,disabled:O<=1,children:"Prev"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",O," of ",z]}),e.jsx(o,{variant:"outline",size:"sm",onClick:Ge,disabled:O>=(z||1),children:"Next"}),e.jsx(L,{orientation:"vertical",className:"h-6 mx-2"}),e.jsx(o,{variant:"outline",size:"sm",onClick:He,children:"-"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[Math.round(ae*100),"%"]}),e.jsx(o,{variant:"outline",size:"sm",onClick:_e,children:"+"})]})]}):e.jsxs("div",{className:"text-center p-4 text-muted-foreground",children:[e.jsx(v,{className:"mx-auto h-12 w-12 mb-2"}),e.jsx("p",{children:t.status==="Unavailable"?"This document is no longer available. Please re-upload the file.":"No preview available"}),e.jsx("p",{className:"text-sm",children:t.name})]})}),e.jsxs("div",{className:"w-80 border-l bg-background p-4 overflow-y-auto",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-4",children:"Document Metadata"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Subject"}),e.jsx("p",{className:"font-medium",children:t.subject||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reference Number"}),e.jsx("p",{className:"font-medium",children:t.refNo||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Organization Tags"}),e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[(me=t.tags)==null?void 0:me.map(s=>e.jsxs(Se,{variant:"secondary",className:"h-5 text-xs flex items-center",children:[s,e.jsx("button",{onClick:()=>qe(t.id,s),className:"ml-1 focus:outline-none",children:e.jsx(Ae,{className:"h-3 w-3"})})]},s)),(!t.tags||t.tags.length===0)&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"No tags added"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{placeholder:"Add custom tag...",value:$,onChange:s=>te(s.target.value),onKeyPress:s=>s.key==="Enter"&&ie(t.id,$),className:"h-9"}),e.jsx(o,{size:"icon",onClick:()=>ie(t.id,$),children:e.jsx(Ce,{className:"h-4 w-4"})})]})]}),e.jsx(L,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-2",children:"Version History"}),e.jsxs(_,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Current Version: ",t.currentVersion]}),e.jsx(b,{type:"file",id:`version-upload-${t.id}`,className:"hidden",onChange:s=>{s.target.files&&s.target.files[0]&&Ze(t.id,s.target.files[0])}}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>{var s;return(s=document.getElementById(`version-upload-${t.id}`))==null?void 0:s.click()},children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"})," New Version"]})]}),e.jsx(H,{className:"h-32",children:t.versions.map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.version===t.currentVersion?e.jsx(ps,{className:"h-4 w-4 text-green-500"}):e.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("p",{children:["Version ",s.version," - ",s.date]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.size," | ",s.uploadedBy]})]})]}),s.version!==t.currentVersion&&e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>es(t.id,s.id),children:"Restore"})]},s.id))})]})]}),e.jsx(L,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-2",children:"Discussion"}),e.jsx(vs,{entityId:t.id,entityType:"document",comments:t.comments||[],currentUser:{id:"current-user",name:"Current User"},onAddComment:s=>{const n={...s,id:`comment-${Date.now()}-${Math.random()}`,timestamp:new Date().toISOString()},r=(i.documents||[]).map(a=>a.id===t.id?{...a,comments:[...a.comments||[],n]}:a);h({...i,documents:r}),f(a=>a?{...a,comments:[...a.comments||[],n]}:null)}})]}),e.jsx(L,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Audit Trail"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Created: ",t.date]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Size: ",t.size]})]}),e.jsxs(o,{variant:"destructive",className:"w-full mt-4",onClick:()=>{ce(t.id),f(null)},children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"})," Delete Document"]})]})]})]})]})})]})};export{ks as default};
