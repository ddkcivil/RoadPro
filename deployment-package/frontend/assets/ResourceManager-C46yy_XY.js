import{c as Ne,r as f,j as e,B as d,aH as k,n as w,ac as J,o as R,p as $,t as C,v as K,w as X,x as D,y as v,z as Y,A as g,O as F,G as ve,J as Z,D as E,e as H,f as M,h as z,K as T,I as p,k as W,a8 as ge,a0 as pe,aZ as ye,a1 as fe,a2 as be,a7 as B}from"./index-CewaSTRD.js";import{T as we,a as Ie,b as V,c as _}from"./tabs-b2piEQ7z.js";import{H as Ce}from"./history-DhVPXOxI.js";import{S as ee}from"./shopping-cart-CrE7RZOM.js";import{T as Le}from"./triangle-alert-DCByPDj1.js";import{C as se}from"./circle-check-ClQeHiCK.js";import{F as Se}from"./filter-BSFQ0ETk.js";import{S as te}from"./save-CV1km07e.js";import{P as Te}from"./printer-DtXb5IMq.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=Ne("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),qe={boqItemExists:(n,c)=>n.boq?n.boq.some(y=>{var x,h,u,o;return((x=y.description)==null?void 0:x.toLowerCase())===((h=c.description)==null?void 0:h.toLowerCase())&&((u=y.itemNo)==null?void 0:u.toLowerCase())===((o=c.itemNo)==null?void 0:o.toLowerCase())}):!1,inventoryItemExists:(n,c)=>n.inventory?n.inventory.some(y=>{var x,h,u,o;return((x=y.itemName)==null?void 0:x.toLowerCase())===((h=c.itemName)==null?void 0:h.toLowerCase())&&((u=y.unit)==null?void 0:u.toLowerCase())===((o=c.unit)==null?void 0:o.toLowerCase())}):!1,structureAssetExists:(n,c)=>n.structures?n.structures.some(y=>{var x,h,u,o;return((x=y.name)==null?void 0:x.toLowerCase())===((h=c.name)==null?void 0:h.toLowerCase())&&((u=y.location)==null?void 0:u.toLowerCase())===((o=c.location)==null?void 0:o.toLowerCase())}):!1},He=({project:n,onProjectUpdate:c,userRole:y})=>{var G,Q;const[x,h]=f.useState("inventory"),[u,o]=f.useState(!1),[ne,q]=f.useState(!1),[re,ie]=f.useState(null),[le,L]=f.useState(!1),[a,b]=f.useState({itemName:"",quantity:0,unit:"unit",reorderLevel:10,location:"Warehouse"}),[S,A]=f.useState(null),[l,O]=f.useState({poNumber:`PO-${Date.now().toString().slice(-6)}`,vendor:"",date:new Date().toISOString().split("T")[0],items:[]}),j=n.inventory||[],I=n.purchaseOrders||[],P=f.useMemo(()=>{const s=j.filter(r=>r.quantity<=r.reorderLevel),t=j.filter(r=>r.quantity>r.reorderLevel&&r.quantity<=r.reorderLevel*1.5),i=j.length-s.length-t.length;return{critical:s,warning:t,healthy:i}},[j]),ce=()=>{b({itemName:"",quantity:0,unit:"unit",reorderLevel:10,location:"Warehouse"}),A(null),L(!0)},de=s=>{b({id:s.id,itemName:s.itemName,quantity:s.quantity,unit:s.unit,reorderLevel:s.reorderLevel,location:s.location}),A(s.id),L(!0)},oe=s=>{const t=j.filter(i=>i.id!==s);c({...n,inventory:t})},me=()=>{var s;if(!((s=a.itemName)!=null&&s.trim())){B.error("Item name is required");return}if(typeof a.quantity!="number"||a.quantity<0){B.error("Quantity must be a non-negative number");return}if(typeof a.reorderLevel!="number"||a.reorderLevel<0){B.error("Reorder level must be a non-negative number");return}if(!S){const t={itemName:a.itemName,unit:a.unit||"unit"};if(qe.inventoryItemExists(n,t)&&!confirm(`An inventory item with name '${a.itemName}' and unit '${a.unit||"unit"}' already exists. Do you want to add it anyway?`))return}if(S){const t=j.map(i=>i.id===S?{...i,...a,lastUpdated:new Date().toISOString().split("T")[0]}:i);c({...n,inventory:t})}else{const t={id:`inv-${Date.now()}`,name:a.itemName||"",itemName:a.itemName||"",quantity:a.quantity||0,unit:a.unit||"unit",reorderLevel:a.reorderLevel||10,location:a.location||"Warehouse",status:"Available",lastUpdated:new Date().toISOString().split("T")[0]};c({...n,inventory:[...j,t]})}L(!1),b({itemName:"",quantity:0,unit:"unit",reorderLevel:10,location:"Warehouse"}),A(null)},xe=()=>{const s=j.filter(t=>t.quantity<=t.reorderLevel).map(t=>({id:`poi-${Date.now()}-${t.id}`,itemId:t.id,itemName:t.itemName,quantity:t.reorderLevel*2,unitPrice:0}));O({poNumber:`PO-${Date.now().toString().slice(-6)}`,vendor:"",date:new Date().toISOString().split("T")[0],items:s}),o(!0)},he=()=>{var i;if(!l.vendor||!((i=l.items)!=null&&i.length))return;const s=l.items.reduce((r,m)=>r+m.quantity*m.unitPrice,0),t={...l,id:`po-${Date.now()}`,status:"Issued",totalAmount:s};c({...n,purchaseOrders:[...I,t]}),o(!1)},ue=s=>{const t=I.find(m=>m.id===s);if(!t||t.status==="Received")return;const i=j.map(m=>{const U=t.items.find(je=>je.itemName===m.itemName);return U?{...m,quantity:m.quantity+U.quantity,lastUpdated:new Date().toISOString().split("T")[0]}:m}),r=I.map(m=>m.id===s?{...m,status:"Received"}:m);c({...n,inventory:i,purchaseOrders:r}),q(!1)},N=I.find(s=>s.id===re);return e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex justify-between mb-2 items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Resource & Material Matrix"}),e.jsx("p",{className:"text-muted-foreground",children:"Site inventory management and automated reorder alerts"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(d,{variant:"outline",children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Stock Ledger"]}),e.jsxs(d,{onClick:ce,children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Add Inventory Item"]}),e.jsxs(d,{onClick:xe,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Draft Purchase Order"]})]})]}),e.jsx(w,{children:e.jsxs(we,{value:x,onValueChange:h,children:[e.jsxs(Ie,{children:[e.jsxs(V,{value:"inventory",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Stock Inventory"]}),e.jsxs(V,{value:"po",children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Purchase Orders"]}),e.jsxs(V,{value:"trends",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Consumption Trends"]})]}),e.jsx(_,{value:"inventory",className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-1 space-y-4",children:[e.jsxs(w,{className:P.critical.length>0?"border-red-500":"",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx($,{children:"CRITICAL"}),e.jsx(Le,{className:"h-5 w-5 text-red-500"})]})}),e.jsx(C,{children:e.jsx("p",{className:"text-3xl font-bold",children:P.critical.length})})]}),e.jsxs(w,{children:[e.jsx(R,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx($,{children:"WARNING"}),e.jsx(ae,{className:"h-5 w-5 text-yellow-500"})]})}),e.jsx(C,{children:e.jsx("p",{className:"text-3xl font-bold",children:P.warning.length})})]}),e.jsxs(w,{children:[e.jsx(R,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx($,{children:"HEALTHY"}),e.jsx(se,{className:"h-5 w-5 text-green-500"})]})}),e.jsx(C,{children:e.jsx("p",{className:"text-3xl font-bold",children:P.healthy})})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(w,{children:e.jsx(C,{children:e.jsxs(K,{children:[e.jsx(X,{children:e.jsxs(D,{children:[e.jsx(v,{children:"Item Name"}),e.jsx(v,{className:"text-right",children:"Stock Level"}),e.jsx(v,{className:"text-right",children:"Threshold"}),e.jsx(v,{className:"text-right",children:"Location"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(Y,{children:j.map(s=>e.jsxs(D,{children:[e.jsxs(g,{children:[e.jsx("p",{className:"font-bold",children:s.itemName}),e.jsx("p",{className:"text-muted-foreground",children:s.location})]}),e.jsx(g,{className:"text-right",children:e.jsxs("p",{className:`font-bold ${s.quantity<=s.reorderLevel?"text-red-500":""}`,children:[s.quantity," ",s.unit]})}),e.jsx(g,{className:"text-right",children:e.jsx(F,{variant:"outline",children:s.reorderLevel})}),e.jsx(g,{className:"text-right",children:s.location}),e.jsxs(g,{className:"text-right",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>de(s),children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>oe(s.id),children:e.jsx(Z,{className:"h-4 w-4"})})]})]},s.id))})]})})})})]})}),e.jsx(_,{value:"po",className:"p-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-4 items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Procurement Ledger"}),e.jsxs(d,{variant:"outline",size:"sm",children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Filter Status"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[I.map(s=>e.jsx(w,{className:"cursor-pointer hover:border-primary",onClick:()=>{ie(s.id),q(!0)},children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-primary",children:s.poNumber}),e.jsx("p",{className:"font-semibold",children:s.vendor})]}),e.jsx(F,{variant:s.status==="Received"?"default":"secondary",children:s.status.toUpperCase()})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.date," â€¢ ",s.items.length," items"]}),e.jsxs("p",{className:"font-bold",children:["$",s.totalAmount.toLocaleString()]})]})]})},s.id)),I.length===0&&e.jsxs("div",{className:"col-span-2 py-16 text-center border-dashed border-2 rounded-lg",children:[e.jsx(J,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No purchase orders"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new purchase order."})]})]})]})})]})}),e.jsx(E,{open:le,onOpenChange:L,children:e.jsxs(H,{children:[e.jsx(M,{children:e.jsxs(z,{className:"flex items-center",children:[e.jsx(k,{className:"mr-2 h-5 w-5"})," ",S?"Edit Inventory Item":"Add New Inventory Item"]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(T,{htmlFor:"item-name",className:"text-right",children:"Item Name"}),e.jsx(p,{id:"item-name",value:a.itemName||"",onChange:s=>b({...a,itemName:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(T,{htmlFor:"quantity",className:"text-right",children:"Quantity"}),e.jsx(p,{id:"quantity",type:"number",value:a.quantity,onChange:s=>b({...a,quantity:Number(s.target.value)}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(T,{htmlFor:"unit",className:"text-right",children:"Unit"}),e.jsx(p,{id:"unit",value:a.unit||"",onChange:s=>b({...a,unit:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(T,{htmlFor:"reorder-level",className:"text-right",children:"Reorder Level"}),e.jsx(p,{id:"reorder-level",type:"number",value:a.reorderLevel,onChange:s=>b({...a,reorderLevel:Number(s.target.value)}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(T,{htmlFor:"location",className:"text-right",children:"Location"}),e.jsx(p,{id:"location",value:a.location||"",onChange:s=>b({...a,location:s.target.value}),className:"col-span-3"})]})]}),e.jsxs(W,{children:[e.jsxs(d,{variant:"outline",onClick:()=>L(!1),children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Cancel"]}),e.jsxs(d,{onClick:me,children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),S?"Update Item":"Add Item"]})]})]})}),e.jsx(E,{open:u,onOpenChange:o,children:e.jsxs(H,{className:"max-w-3xl",children:[e.jsx(M,{children:e.jsxs(z,{className:"flex items-center",children:[e.jsx(ee,{className:"mr-2 h-5 w-5"})," New Purchase Order (PO)"]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(p,{placeholder:"Vendor / Supplier Name",value:l.vendor,onChange:s=>O({...l,vendor:s.target.value})}),e.jsx(p,{value:l.poNumber,disabled:!0}),e.jsx(p,{type:"date",value:l.date,disabled:!0})]}),e.jsx("h3",{className:"text-sm font-semibold mt-4",children:"ORDER ITEMS"}),e.jsx(w,{children:e.jsx(C,{children:e.jsxs(K,{children:[e.jsx(X,{children:e.jsxs(D,{children:[e.jsx(v,{children:"Item Name"}),e.jsx(v,{className:"text-right",children:"Quantity"}),e.jsx(v,{className:"text-right",children:"Est. Rate"}),e.jsx(v,{className:"text-right",children:"Total"}),e.jsx(v,{className:"text-right"})]})}),e.jsx(Y,{children:(G=l.items)==null?void 0:G.map((s,t)=>e.jsxs(D,{children:[e.jsx(g,{children:s.itemName}),e.jsx(g,{className:"text-right",children:e.jsx(p,{type:"number",value:s.quantity,onChange:i=>{const r=[...l.items||[]];r[t].quantity=Number(i.target.value),O({...l,items:r})},className:"w-20"})}),e.jsx(g,{className:"text-right",children:e.jsx(p,{type:"number",value:s.unitPrice,onChange:i=>{const r=[...l.items||[]];r[t].unitPrice=Number(i.target.value),O({...l,items:r})},className:"w-24"})}),e.jsxs(g,{className:"text-right font-bold",children:["$",(s.quantity*s.unitPrice).toLocaleString()]}),e.jsx(g,{className:"text-right",children:e.jsx(d,{variant:"ghost",size:"icon",children:e.jsx(Z,{className:"h-4 w-4"})})})]},t))})]})})}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-900 text-white p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"TOTAL PO VALUE"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",(((Q=l.items)==null?void 0:Q.reduce((s,t)=>s+t.quantity*t.unitPrice,0))||0).toLocaleString()]})]})]}),e.jsxs(W,{children:[e.jsx(d,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsxs(d,{onClick:he,disabled:!l.vendor,children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Issue Purchase Order"]})]})]})}),e.jsx(E,{open:ne,onOpenChange:q,children:N&&e.jsxs(H,{children:[e.jsx(M,{children:e.jsxs(z,{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:N.poNumber}),e.jsx("p",{className:"text-muted-foreground",children:N.vendor})]}),e.jsx(F,{variant:N.status==="Received"?"default":"secondary",children:N.status})]})}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsx("div",{className:"space-y-2",children:N.items.map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.itemName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:`${s.quantity} units @ $${s.unitPrice}`})]}),e.jsxs("p",{className:"font-bold",children:["$",(s.quantity*s.unitPrice).toLocaleString()]})]},t))}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("p",{children:"Order Total:"}),e.jsxs("p",{className:"text-primary",children:["$",N.totalAmount.toLocaleString()]})]}),N.status==="Issued"&&e.jsxs(pe,{children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx(fe,{children:"In Transit"}),e.jsx(be,{children:"This order is currently in transit. Verify delivery on site before receiving."})]})]}),e.jsxs(W,{children:[e.jsxs(d,{variant:"outline",children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Print PO"]}),e.jsx("div",{className:"flex-grow"}),e.jsx(d,{variant:"outline",onClick:()=>q(!1),children:"Close"}),N.status==="Issued"&&e.jsxs(d,{onClick:()=>ue(N.id),children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Confirm Receipt"]})]})]})})]})};export{He as default};
