import{c as xe,r as n,a5 as d,j as e,B as i,n as z,o as je,p as ge,t as L,v as O,w as G,x as C,y as o,z as $,A as m,ah as y,az as U,aA as E,O as q,aD as B,aE as pe,a8 as R,J as ue,D as H,e as V,f as _,h as J,i as Z,K as c,I as h,V as X,W as K,X as W,Y,Z as Q,k as ee,aF as j}from"./index-CewaSTRD.js";import{U as se}from"./user-plus-CMrYzzGb.js";import{U as ae}from"./upload-CcYQvXh5.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=xe("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),be=()=>{const[S,te]=n.useState(!0),[A,p]=n.useState([]),[u,F]=n.useState([]),[re,b]=n.useState(!1),[ie,w]=n.useState(!1),[a,g]=n.useState(null),[r,N]=n.useState({name:"",email:"",role:d.SITE_ENGINEER,phone:""}),[D,v]=n.useState(null),[P,f]=n.useState(null);n.useEffect(()=>{(async()=>{try{const[l,t]=await Promise.all([j.getUsers(),j.getPendingRegistrations()]);p(l),F(t)}catch(l){console.error("Error loading data:",l)}finally{te(!1)}})()},[]);const ne=async s=>{if(s.preventDefault(),!r.name.trim()){alert("User name is required");return}if(!r.email.trim()){alert("Email is required");return}if(!/^[\w\.-]+@[\w\.-]+\.[a-zA-Z]{2,}$/.test(r.email)){alert("Please enter a valid email address");return}if(r.phone&&!/^\+?[1-9][\d\-\s]{8,}$/.test(r.phone)){alert("Please enter a valid phone number");return}try{const l=await j.createUser({name:r.name,email:r.email,phone:r.phone,role:r.role});p(t=>[...t,l]),b(!1),N({name:"",email:"",role:d.SITE_ENGINEER,phone:""}),v(null),f(null)}catch(l){alert(l.message||"Failed to create user")}},ce=async s=>{if(s.preventDefault(),!a)return;if(!a.name.trim()){alert("User name is required");return}if(!a.email.trim()){alert("Email is required");return}if(!/^[\w\.-]+@[\w\.-]+\.[a-zA-Z]{2,}$/.test(a.email)){alert("Please enter a valid email address");return}if(a.phone&&!/^\+?[1-9][\d\-\s]{8,}$/.test(a.phone)){alert("Please enter a valid phone number");return}if(A.some(t=>t.id!==a.id&&t.email.toLowerCase()===a.email.toLowerCase())){alert(`Duplicate: A user with email "${a.email}" already exists.`);return}try{const t=await j.updateUser(a.id,{name:a.name,email:a.email,phone:a.phone,role:a.role}),x=A.map(T=>T.id===a.id?t:T);p(x),w(!1),g(null),v(null),f(null)}catch(t){alert(t.message||"Failed to update user")}},de=async s=>{if(window.confirm("Are you sure you want to delete this user?"))try{await j.deleteUser(s),p(l=>l.filter(t=>t.id!==s)),alert("User deleted successfully")}catch(l){alert(l.message||"Failed to delete user")}},oe=s=>{g(s),w(!0),f(null),v(null)},k=s=>{var t;const l=(t=s.target.files)==null?void 0:t[0];if(l){v(l);const x=new FileReader;x.onloadend=()=>{f(x.result)},x.readAsDataURL(l)}},I=()=>{v(null),f(null)},me=async s=>{try{const l=await j.approveRegistration(s.id);p(t=>[...t,l]),F(t=>t.filter(x=>x.id!==s.id)),alert(`User ${s.name} has been approved and added to the system.`)}catch(l){alert(l.message||"Failed to approve user")}},he=async s=>{if(window.confirm(`Are you sure you want to reject ${s.name}'s registration?`))try{await j.rejectRegistration(s.id),F(l=>l.filter(t=>t.id!==s.id)),alert(`User ${s.name}'s registration has been rejected.`)}catch(l){alert(l.message||"Failed to reject user")}},M=s=>{switch(s){case d.ADMIN:return"bg-red-500/20 text-red-700";case d.PROJECT_MANAGER:return"bg-blue-500/20 text-blue-700";case d.SITE_ENGINEER:return"bg-green-500/20 text-green-700";case d.LAB_TECHNICIAN:return"bg-yellow-500/20 text-yellow-700";case d.SUPERVISOR:return"bg-purple-500/20 text-purple-700";default:return"bg-gray-500/20 text-gray-700"}};return e.jsxs("div",{className:"p-4 h-[calc(100vh-140px)] overflow-y-auto",children:[S&&e.jsx("div",{className:"flex justify-center items-center h-48",children:e.jsx("p",{className:"text-lg text-slate-600",children:"Loading user data..."})}),!S&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between mb-4 items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"User Management"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Manage system access and roles"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",onClick:()=>b(!0),children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Add User"]}),u.length>0&&e.jsxs(i,{variant:"secondary",onClick:()=>{},children:["Pending (",u.length,")"]})]})]}),u.length>0&&e.jsxs(z,{className:"mb-6 border-amber-300",children:[e.jsx(je,{className:"bg-amber-100 border-b border-amber-300",children:e.jsxs(ge,{className:"text-xl font-bold text-amber-900",children:["Pending Registrations (",u.length,")"]})}),e.jsx(L,{className:"p-0",children:e.jsxs(O,{children:[e.jsx(G,{children:e.jsxs(C,{className:"bg-amber-50",children:[e.jsx(o,{className:"font-bold text-sm",children:"User"}),e.jsx(o,{className:"font-bold text-sm",children:"Requested Role"}),e.jsx(o,{className:"font-bold text-sm",children:"Email"}),e.jsx(o,{className:"font-bold text-sm",children:"Phone"}),e.jsx(o,{className:"text-right font-bold text-sm",children:"Actions"})]})}),e.jsx($,{children:u.map(s=>e.jsxs(C,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{children:[e.jsx(U,{src:s.avatar}),e.jsx(E,{children:s.name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Registered: ",new Date(s.createdAt).toLocaleDateString()]})]})]})}),e.jsx(m,{children:e.jsx(q,{className:M(s.requestedRole),children:s.requestedRole})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.email})]})}),e.jsx(m,{children:s.phone||"-"}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>me(),children:[e.jsx(pe,{className:"mr-1 h-4 w-4"})," Approve"]}),e.jsxs(i,{variant:"destructive",size:"sm",onClick:()=>he(),children:[e.jsx(R,{className:"mr-1 h-4 w-4"})," Reject"]})]})})]},s.id))})]})})]}),e.jsx(z,{children:e.jsx(L,{className:"p-0",children:e.jsxs(O,{children:[e.jsx(G,{children:e.jsxs(C,{className:"bg-slate-50",children:[e.jsx(o,{className:"font-bold text-sm",children:"User"}),e.jsx(o,{className:"font-bold text-sm",children:"Email"}),e.jsx(o,{className:"font-bold text-sm",children:"Phone"}),e.jsx(o,{className:"text-right font-bold text-sm",children:"Actions"})]})}),e.jsx($,{children:A.map(s=>e.jsxs(C,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{children:[e.jsx(U,{src:s.avatar}),e.jsx(E,{children:s.name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.name}),e.jsx(q,{className:M(s.role),children:s.role})]})]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.email})]})}),e.jsx(m,{children:s.phone||"-"}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>oe(s),children:[e.jsx(le,{className:"mr-1 h-4 w-4"})," Edit"]}),e.jsxs(i,{variant:"destructive",size:"sm",onClick:()=>de(s.id),children:[e.jsx(ue,{className:"mr-1 h-4 w-4"})," Delete"]})]})})]},s.id))})]})})}),e.jsx(H,{open:re,onOpenChange:b,children:e.jsxs(V,{className:"sm:max-w-[425px]",children:[e.jsxs(_,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"text-indigo-600"})," Add New User"]}),e.jsx(Z,{children:"Fill in the details for the new user."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(y,{className:"w-16 h-16",children:[e.jsx(U,{src:P||void 0}),e.jsx(E,{children:r.name?r.name.charAt(0):"U"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(i,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(c,{htmlFor:"avatar-upload",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"})," Upload Photo"]})}),e.jsx(h,{id:"avatar-upload",type:"file",className:"sr-only",accept:"image/*",onChange:k}),D&&e.jsxs(i,{variant:"ghost",size:"sm",onClick:I,children:[e.jsx(R,{className:"mr-2 h-4 w-4"})," Clear Photo"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"JPG, PNG, Max 5MB"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(c,{htmlFor:"name",className:"text-right",children:"Full Name"}),e.jsx(h,{id:"name",value:r.name,onChange:s=>N({...r,name:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(c,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:r.email,onChange:s=>N({...r,email:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(c,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(h,{id:"phone",value:r.phone,onChange:s=>N({...r,phone:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(c,{htmlFor:"role",className:"text-right",children:"Role"}),e.jsxs(X,{value:r.role,onValueChange:s=>N({...r,role:s}),children:[e.jsx(K,{className:"col-span-3",children:e.jsx(W,{placeholder:"Select a role"})}),e.jsx(Y,{children:Object.values(d).map(s=>e.jsx(Q,{value:s,children:s},s))})]})]})]}),e.jsxs(ee,{children:[e.jsx(i,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(i,{onClick:ne,children:"Add User"})]})]})}),e.jsx(H,{open:ie,onOpenChange:w,children:e.jsxs(V,{className:"sm:max-w-[425px]",children:[e.jsxs(_,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"text-indigo-600"})," Edit User"]}),e.jsx(Z,{children:"Update user details."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(y,{className:"w-16 h-16",children:[e.jsx(U,{src:P||a.avatar||void 0}),e.jsx(E,{children:a.name.charAt(0)})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(i,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(c,{htmlFor:"edit-avatar-upload",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"})," Change Photo"]})}),e.jsx(h,{id:"edit-avatar-upload",type:"file",className:"sr-only",accept:"image/*",onChange:s=>k(s)}),(P||D)&&e.jsxs(i,{variant:"ghost",size:"sm",onClick:I,children:[e.jsx(R,{className:"mr-2 h-4 w-4"})," Clear Photo"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"JPG, PNG, Max 5MB"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(c,{htmlFor:"edit-name",className:"text-right",children:"Full Name"}),e.jsx(h,{id:"edit-name",value:a.name,onChange:s=>g({...a,name:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(c,{htmlFor:"edit-email",className:"text-right",children:"Email"}),e.jsx(h,{id:"edit-email",type:"email",value:a.email,onChange:s=>g({...a,email:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(c,{htmlFor:"edit-phone",className:"text-right",children:"Phone"}),e.jsx(h,{id:"edit-phone",value:a.phone||"",onChange:s=>g({...a,phone:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(c,{htmlFor:"edit-role",className:"text-right",children:"Role"}),e.jsxs(X,{value:a.role,onValueChange:s=>g({...a,role:s}),children:[e.jsx(K,{className:"col-span-3",children:e.jsx(W,{placeholder:"Select a role"})}),e.jsx(Y,{children:Object.values(d).map(s=>e.jsx(Q,{value:s,children:s},s))})]})]})]})}),e.jsxs(ee,{children:[e.jsx(i,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(i,{onClick:ce,children:"Save Changes"})]})]})})]})]})};export{be as default};
