import{c as le,r as u,j as e,aj as jt,al as bt,an as ie,am as oe,ar as vt,as as yt,at as Je,ap as Nt,ao as St,M,a5 as ze,B as P,P as he,C as Ke,au as Ce,I as X,u as wt,L as Dt,T as me,E as fe,F as pe,H as ge,O as ee,a6 as We,J as Te,v as ke,y as Ie,x as te,A as p,z as Ee,$ as Ue,av as Ct,D as Tt,e as kt,f as It,h as Et,K as O,V as je,W as be,X as ve,Y as ye,Z as L,a0 as qe,a1 as Mt,a2 as Ye,k as Rt}from"./index-CewaSTRD.js";import{S as Me}from"./StatCard-Di6peEL8.js";import{f as At}from"./exportUtils-B5u6ZY-6.js";import{g as Pt}from"./currencyUtils-RmnVW5tT.js";import{S as zt}from"./switch-4wBij9kJ.js";import{T as Ot,a as Ft,b as Re}from"./tabs-b2piEQ7z.js";import{C as _t}from"./clock-CdXHNXMZ.js";import{F as Oe}from"./file-check-HERxK4FE.js";import{P as Xe}from"./pen-DxURiB25.js";import{S as Vt}from"./save-CV1km07e.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=le("ChartBar",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M7 16h8",key:"srdodz"}],["path",{d:"M7 11h12",key:"127s9w"}],["path",{d:"M7 6h3",key:"w9rmul"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=le("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=le("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=le("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=le("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=le("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function $t(s,a=[]){let l=[];function i(m,n){const o=u.createContext(n),g=l.length;l=[...l,n];const y=f=>{var D;const{scope:v,children:k,...E}=f,C=((D=v==null?void 0:v[s])==null?void 0:D[g])||o,T=u.useMemo(()=>E,Object.values(E));return e.jsx(C.Provider,{value:T,children:k})};y.displayName=m+"Provider";function w(f,v){var C;const k=((C=v==null?void 0:v[s])==null?void 0:C[g])||o,E=u.useContext(k);if(E)return E;if(n!==void 0)return n;throw new Error(`\`${f}\` must be used within \`${m}\``)}return[y,w]}const c=()=>{const m=l.map(n=>u.createContext(n));return function(o){const g=(o==null?void 0:o[s])||m;return u.useMemo(()=>({[`__scope${s}`]:{...o,[s]:g}}),[o,g])}};return c.scopeName=s,[i,Kt(c,...a)]}function Kt(...s){const a=s[0];if(s.length===1)return a;const l=()=>{const i=s.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(m){const n=i.reduce((o,{useScope:g,scopeName:y})=>{const f=g(m)[`__scope${y}`];return{...o,...f}},{});return u.useMemo(()=>({[`__scope${a.scopeName}`]:n}),[n])}};return l.scopeName=a.scopeName,l}function Wt(s){const a=Ut(s),l=u.forwardRef((i,c)=>{const{children:m,...n}=i,o=u.Children.toArray(m),g=o.find(Yt);if(g){const y=g.props.children,w=o.map(f=>f===g?u.Children.count(y)>1?u.Children.only(null):u.isValidElement(y)?y.props.children:null:f);return e.jsx(a,{...n,ref:c,children:u.isValidElement(y)?u.cloneElement(y,void 0,w):null})}return e.jsx(a,{...n,ref:c,children:m})});return l.displayName=`${s}.Slot`,l}function Ut(s){const a=u.forwardRef((l,i)=>{const{children:c,...m}=l;if(u.isValidElement(c)){const n=Gt(c),o=Xt(m,c.props);return c.type!==u.Fragment&&(o.ref=i?jt(i,n):n),u.cloneElement(c,o)}return u.Children.count(c)>1?u.Children.only(null):null});return a.displayName=`${s}.SlotClone`,a}var qt=Symbol("radix.slottable");function Yt(s){return u.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===qt}function Xt(s,a){const l={...a};for(const i in a){const c=s[i],m=a[i];/^on[A-Z]/.test(i)?c&&m?l[i]=(...o)=>{const g=m(...o);return c(...o),g}:c&&(l[i]=c):i==="style"?l[i]={...c,...m}:i==="className"&&(l[i]=[c,m].filter(Boolean).join(" "))}return{...s,...l}}function Gt(s){var i,c;let a=(i=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:i.get,l=a&&"isReactWarning"in a&&a.isReactWarning;return l?s.ref:(a=(c=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:c.get,l=a&&"isReactWarning"in a&&a.isReactWarning,l?s.props.ref:s.props.ref||s.ref)}var Zt=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ne=Zt.reduce((s,a)=>{const l=Wt(`Primitive.${a}`),i=u.forwardRef((c,m)=>{const{asChild:n,...o}=c,g=n?l:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(g,{...o,ref:m})});return i.displayName=`Primitive.${a}`,{...s,[a]:i}},{}),et=["PageUp","PageDown"],tt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],st={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},de="Slider",[_e,Jt,es]=vt(de),[nt]=$t(de,[es]),[ts,Ae]=nt(de),rt=u.forwardRef((s,a)=>{const{name:l,min:i=0,max:c=100,step:m=1,orientation:n="horizontal",disabled:o=!1,minStepsBetweenThumbs:g=0,defaultValue:y=[i],value:w,onValueChange:f=()=>{},onValueCommit:v=()=>{},inverted:k=!1,form:E,...C}=s,T=u.useRef(new Set),D=u.useRef(0),R=n==="horizontal"?ss:ns,[I=[],se]=bt({prop:w,defaultProp:y,onChange:N=>{var _;(_=[...T.current][D.current])==null||_.focus(),f(N)}}),F=u.useRef(I);function K(N){const Q=os(I,N);U(N,Q)}function W(N){U(N,D.current)}function ce(){const N=F.current[D.current];I[D.current]!==N&&v(I)}function U(N,Q,{commit:_}={commit:!1}){const z=xs(m),G=hs(Math.round((N-i)/m)*m+i,z),ne=Je(G,[i,c]);se((B=[])=>{const q=is(B,ne,Q);if(us(q,g*m)){D.current=q.indexOf(ne);const Y=String(q)!==String(B);return Y&&_&&v(q),Y?q:B}else return B})}return e.jsx(ts,{scope:s.__scopeSlider,name:l,disabled:o,min:i,max:c,valueIndexToChangeRef:D,thumbs:T.current,values:I,orientation:n,form:E,children:e.jsx(_e.Provider,{scope:s.__scopeSlider,children:e.jsx(_e.Slot,{scope:s.__scopeSlider,children:e.jsx(R,{"aria-disabled":o,"data-disabled":o?"":void 0,...C,ref:a,onPointerDown:ie(C.onPointerDown,()=>{o||(F.current=I)}),min:i,max:c,inverted:k,onSlideStart:o?void 0:K,onSlideMove:o?void 0:W,onSlideEnd:o?void 0:ce,onHomeKeyDown:()=>!o&&U(i,0,{commit:!0}),onEndKeyDown:()=>!o&&U(c,I.length-1,{commit:!0}),onStepKeyDown:({event:N,direction:Q})=>{if(!o){const G=et.includes(N.key)||N.shiftKey&&tt.includes(N.key)?10:1,ne=D.current,B=I[ne],q=m*G*Q;U(B+q,ne,{commit:!0})}}})})})})});rt.displayName=de;var[at,it]=nt(de,{startEdge:"left",endEdge:"right",size:"width",direction:1}),ss=u.forwardRef((s,a)=>{const{min:l,max:i,dir:c,inverted:m,onSlideStart:n,onSlideMove:o,onSlideEnd:g,onStepKeyDown:y,...w}=s,[f,v]=u.useState(null),k=oe(a,R=>v(R)),E=u.useRef(void 0),C=yt(c),T=C==="ltr",D=T&&!m||!T&&m;function $(R){const I=E.current||f.getBoundingClientRect(),se=[0,I.width],K=Be(se,D?[l,i]:[i,l]);return E.current=I,K(R-I.left)}return e.jsx(at,{scope:s.__scopeSlider,startEdge:D?"left":"right",endEdge:D?"right":"left",direction:D?1:-1,size:"width",children:e.jsx(lt,{dir:C,"data-orientation":"horizontal",...w,ref:k,style:{...w.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:R=>{const I=$(R.clientX);n==null||n(I)},onSlideMove:R=>{const I=$(R.clientX);o==null||o(I)},onSlideEnd:()=>{E.current=void 0,g==null||g()},onStepKeyDown:R=>{const se=st[D?"from-left":"from-right"].includes(R.key);y==null||y({event:R,direction:se?-1:1})}})})}),ns=u.forwardRef((s,a)=>{const{min:l,max:i,inverted:c,onSlideStart:m,onSlideMove:n,onSlideEnd:o,onStepKeyDown:g,...y}=s,w=u.useRef(null),f=oe(a,w),v=u.useRef(void 0),k=!c;function E(C){const T=v.current||w.current.getBoundingClientRect(),D=[0,T.height],R=Be(D,k?[i,l]:[l,i]);return v.current=T,R(C-T.top)}return e.jsx(at,{scope:s.__scopeSlider,startEdge:k?"bottom":"top",endEdge:k?"top":"bottom",size:"height",direction:k?1:-1,children:e.jsx(lt,{"data-orientation":"vertical",...y,ref:f,style:{...y.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:C=>{const T=E(C.clientY);m==null||m(T)},onSlideMove:C=>{const T=E(C.clientY);n==null||n(T)},onSlideEnd:()=>{v.current=void 0,o==null||o()},onStepKeyDown:C=>{const D=st[k?"from-bottom":"from-top"].includes(C.key);g==null||g({event:C,direction:D?-1:1})}})})}),lt=u.forwardRef((s,a)=>{const{__scopeSlider:l,onSlideStart:i,onSlideMove:c,onSlideEnd:m,onHomeKeyDown:n,onEndKeyDown:o,onStepKeyDown:g,...y}=s,w=Ae(de,l);return e.jsx(Ne.span,{...y,ref:a,onKeyDown:ie(s.onKeyDown,f=>{f.key==="Home"?(n(f),f.preventDefault()):f.key==="End"?(o(f),f.preventDefault()):et.concat(tt).includes(f.key)&&(g(f),f.preventDefault())}),onPointerDown:ie(s.onPointerDown,f=>{const v=f.target;v.setPointerCapture(f.pointerId),f.preventDefault(),w.thumbs.has(v)?v.focus():i(f)}),onPointerMove:ie(s.onPointerMove,f=>{f.target.hasPointerCapture(f.pointerId)&&c(f)}),onPointerUp:ie(s.onPointerUp,f=>{const v=f.target;v.hasPointerCapture(f.pointerId)&&(v.releasePointerCapture(f.pointerId),m(f))})})}),ot="SliderTrack",dt=u.forwardRef((s,a)=>{const{__scopeSlider:l,...i}=s,c=Ae(ot,l);return e.jsx(Ne.span,{"data-disabled":c.disabled?"":void 0,"data-orientation":c.orientation,...i,ref:a})});dt.displayName=ot;var Ve="SliderRange",ct=u.forwardRef((s,a)=>{const{__scopeSlider:l,...i}=s,c=Ae(Ve,l),m=it(Ve,l),n=u.useRef(null),o=oe(a,n),g=c.values.length,y=c.values.map(v=>ht(v,c.min,c.max)),w=g>1?Math.min(...y):0,f=100-Math.max(...y);return e.jsx(Ne.span,{"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,...i,ref:o,style:{...s.style,[m.startEdge]:w+"%",[m.endEdge]:f+"%"}})});ct.displayName=Ve;var Le="SliderThumb",ut=u.forwardRef((s,a)=>{const l=Jt(s.__scopeSlider),[i,c]=u.useState(null),m=oe(a,o=>c(o)),n=u.useMemo(()=>i?l().findIndex(o=>o.ref.current===i):-1,[l,i]);return e.jsx(rs,{...s,ref:m,index:n})}),rs=u.forwardRef((s,a)=>{const{__scopeSlider:l,index:i,name:c,...m}=s,n=Ae(Le,l),o=it(Le,l),[g,y]=u.useState(null),w=oe(a,$=>y($)),f=g?n.form||!!g.closest("form"):!0,v=Nt(g),k=n.values[i],E=k===void 0?0:ht(k,n.min,n.max),C=ls(i,n.values.length),T=v==null?void 0:v[o.size],D=T?ds(T,E,o.direction):0;return u.useEffect(()=>{if(g)return n.thumbs.add(g),()=>{n.thumbs.delete(g)}},[g,n.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[o.startEdge]:`calc(${E}% + ${D}px)`},children:[e.jsx(_e.ItemSlot,{scope:s.__scopeSlider,children:e.jsx(Ne.span,{role:"slider","aria-label":s["aria-label"]||C,"aria-valuemin":n.min,"aria-valuenow":k,"aria-valuemax":n.max,"aria-orientation":n.orientation,"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,tabIndex:n.disabled?void 0:0,...m,ref:w,style:k===void 0?{display:"none"}:s.style,onFocus:ie(s.onFocus,()=>{n.valueIndexToChangeRef.current=i})})}),f&&e.jsx(xt,{name:c??(n.name?n.name+(n.values.length>1?"[]":""):void 0),form:n.form,value:k},i)]})});ut.displayName=Le;var as="RadioBubbleInput",xt=u.forwardRef(({__scopeSlider:s,value:a,...l},i)=>{const c=u.useRef(null),m=oe(c,i),n=St(a);return u.useEffect(()=>{const o=c.current;if(!o)return;const g=window.HTMLInputElement.prototype,w=Object.getOwnPropertyDescriptor(g,"value").set;if(n!==a&&w){const f=new Event("input",{bubbles:!0});w.call(o,a),o.dispatchEvent(f)}},[n,a]),e.jsx(Ne.input,{style:{display:"none"},...l,ref:m,defaultValue:a})});xt.displayName=as;function is(s=[],a,l){const i=[...s];return i[l]=a,i.sort((c,m)=>c-m)}function ht(s,a,l){const m=100/(l-a)*(s-a);return Je(m,[0,100])}function ls(s,a){return a>2?`Value ${s+1} of ${a}`:a===2?["Minimum","Maximum"][s]:void 0}function os(s,a){if(s.length===1)return 0;const l=s.map(c=>Math.abs(c-a)),i=Math.min(...l);return l.indexOf(i)}function ds(s,a,l){const i=s/2,m=Be([0,50],[0,i]);return(i-m(a)*l)*l}function cs(s){return s.slice(0,-1).map((a,l)=>s[l+1]-a)}function us(s,a){if(a>0){const l=cs(s);return Math.min(...l)>=a}return!0}function Be(s,a){return l=>{if(s[0]===s[1]||a[0]===a[1])return a[0];const i=(a[1]-a[0])/(s[1]-s[0]);return a[0]+i*(l-s[0])}}function xs(s){return(String(s).split(".")[1]||"").length}function hs(s,a){const l=Math.pow(10,a);return Math.round(s*l)/l}var mt=rt,ms=dt,fs=ct,ps=ut;const ft=u.forwardRef(({className:s,...a},l)=>e.jsxs(mt,{ref:l,className:M("relative flex w-full touch-none select-none items-center",s),...a,children:[e.jsx(ms,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(fs,{className:"absolute h-full bg-primary"})}),e.jsx(ps,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));ft.displayName=mt.displayName;const re=48,Ze=70,gs=250,ks=({project:s,userRole:a,onProjectUpdate:l})=>{var Qe,$e;const i={primary:{main:"#4f46e5",dark:"#3730a3"},error:{main:"#ef4444"},warning:{main:"#f59e0b"},divider:"#e5e7eb",text:{secondary:"#6b7280"}},[c,m]=u.useState(!1),[n,o]=u.useState({}),[g,y]=u.useState("0"),[w,f]=u.useState(""),[v,k]=u.useState(0),[E,C]=u.useState(""),[T,D]=u.useState(""),[$,R]=u.useState(""),[I,se]=u.useState(""),[F,K]=u.useState("GANTT"),[W,ce]=u.useState("WEEK"),U=u.useRef(null),[N,Q]=u.useState(null),_=[ze.PROJECT_MANAGER,ze.ADMIN,ze.SITE_ENGINEER].includes(a),z=u.useMemo(()=>{switch(W){case"MONTH":return 10;case"WEEK":return 40;case"DAY":return 100;default:return 40}},[W]),G=u.useMemo(()=>{const t={};return s.rfis.forEach(r=>{r.linkedTaskId&&(t[r.linkedTaskId]||(t[r.linkedTaskId]=[]),t[r.linkedTaskId].push(r))}),t},[s.rfis]),{startDate:ne,daysCount:B,dateScale:q}=u.useMemo(()=>{if(s.schedule.length===0){const j=new Date;return j.setHours(0,0,0,0),{startDate:j,daysCount:60,dateScale:[]}}const t=s.schedule.flatMap(j=>[new Date(j.startDate),new Date(j.endDate)]),r=new Date(Math.min(...t.map(j=>j.getTime())));r.setHours(0,0,0,0),r.setDate(r.getDate()-10);const x=new Date(Math.max(...t.map(j=>j.getTime())));x.setDate(x.getDate()+30);const d=Math.ceil((x.getTime()-r.getTime())/(1e3*60*60*24)),h=[];for(let j=0;j<=d;j++){const b=new Date(r);b.setDate(r.getDate()+j),h.push(b)}return{startDate:r,daysCount:d,dateScale:h}},[s.schedule]),Y=t=>{const r=new Date(t);return r.setHours(0,0,0,0),(r.getTime()-ne.getTime())/(1e3*60*60*24)*z},He=t=>{let r=[...t],x=!0,d=0;for(;x&&d<10;)x=!1,d++,r=r.map(h=>{let j=new Date(h.startDate),b=new Date(h.endDate),H=!1,V=!1;if(h.dependencies.forEach(S=>{const A=r.find(J=>J.id===S.taskId);if(!A)return;const Z=S.lag||0;switch(S.type){case"FS":const J=new Date(A.endDate);J.setDate(J.getDate()+Z),j<J&&(j=new Date(J),j.setDate(j.getDate()+1),H=!0);break;case"SS":const ae=new Date(A.startDate);ae.setDate(ae.getDate()+Z),j<ae&&(j=new Date(ae),H=!0);break;case"FF":const we=new Date(A.endDate);we.setDate(we.getDate()+Z),b<we&&(b=new Date(we),V=!0);break;case"SF":const De=new Date(A.startDate);De.setDate(De.getDate()+Z),b<De&&(b=new Date(De),V=!0);break}}),H||V){if(H&&!V){const S=new Date(h.endDate).getTime()-new Date(h.startDate).getTime();b=new Date(j.getTime()+S)}else if(V&&!H&&b<j){const S=new Date(h.endDate).getTime()-new Date(h.startDate).getTime();j=new Date(b.getTime()-S)}else H&&V&&b<j&&(b=new Date(j),b.setDate(b.getDate()+1));return x=!0,{...h,startDate:j.toISOString().split("T")[0],endDate:b.toISOString().split("T")[0]}}return h});return r},Se=t=>{o(t?{...t}:{name:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date(Date.now()+864e5*7).toISOString().split("T")[0],progress:0,status:"On Track",isCritical:!1,dependencies:[],boqItemId:""}),m(!0)},pt=()=>{if(!n.name||!n.startDate||!n.endDate)return;let t;if(n.id)t=s.schedule.map(r=>r.id===n.id?{...r,...n}:r);else{const r={id:`task-${Date.now()}`,name:n.name,startDate:n.startDate,endDate:n.endDate,progress:Number(n.progress)||0,status:n.status||"On Track",dependencies:[],isCritical:n.isCritical||!1,boqItemId:n.boqItemId};t=[...s.schedule,r]}l({...s,schedule:He(t)}),m(!1),o({}),y("0")},gt=t=>{if(window.confirm("Are you sure you want to delete this task?")){const r=s.schedule.filter(x=>x.id!==t);l({...s,schedule:r})}},Pe=(t,r,x)=>{if(!_)return;t.stopPropagation();const d=s.schedule.find(h=>h.id===r);d&&Q({id:r,type:x,initialX:t.clientX,initialValue:{start:d.startDate,end:d.endDate,progress:d.progress}})};u.useEffect(()=>{const t=x=>{if(!N)return;const d=x.clientX-N.initialX,h=Math.round(d/z),j=s.schedule.map(b=>{var H,V;if(b.id===N.id){if(N.type==="MOVE"){const S=new Date(N.initialValue.start);S.setDate(S.getDate()+h);const A=new Date(N.initialValue.end);return A.setDate(A.getDate()+h),{...b,startDate:S.toISOString().split("T")[0],endDate:A.toISOString().split("T")[0]}}else if(N.type==="RESIZE_START"){const S=new Date(N.initialValue.start);return S.setDate(S.getDate()+h),S>=new Date(b.endDate)?b:{...b,startDate:S.toISOString().split("T")[0]}}else if(N.type==="RESIZE_END"){const S=new Date(N.initialValue.end);return S.setDate(S.getDate()+h),S<=new Date(b.startDate)?b:{...b,endDate:S.toISOString().split("T")[0]}}else if(N.type==="PROGRESS"){const S=Y(b.startDate),A=Y(b.endDate)-S,Z=(H=U.current)==null?void 0:H.getBoundingClientRect(),J=x.clientX-((Z==null?void 0:Z.left)||0)+(((V=U.current)==null?void 0:V.scrollLeft)||0)-gs-S,ae=Math.min(100,Math.max(0,Math.round(J/A*100)));return{...b,progress:ae}}}return b});l({...s,schedule:He(j)})},r=()=>Q(null);return N&&(window.addEventListener("mousemove",t),window.addEventListener("mouseup",r)),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",r)}},[N,z,s.schedule]);const ue=u.useMemo(()=>{let t=s.schedule;return I&&(t=t.filter(r=>r.name.toLowerCase().includes(I.toLowerCase()))),[...t].sort((r,x)=>new Date(r.startDate).getTime()-new Date(x.startDate).getTime())},[s.schedule,I]),xe=u.useMemo(()=>(ue.length+(_?1:0))*re,[ue.length,_]);return e.jsxs("div",{className:"h-[calc(100vh-140px)] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between mb-3 items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Project Schedule"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Interactive Gantt timeline with dependency resolution"})]}),e.jsx("div",{className:"flex gap-2 items-center",children:e.jsxs(P,{variant:"default",className:"flex items-center gap-2",onClick:()=>Se(),children:[e.jsx(he,{size:18}),"Add Activity"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsx(Me,{title:"Total Activities",value:s.schedule.length,icon:Ge,color:"#1976d2"}),e.jsx(Me,{title:"Completed",value:s.schedule.filter(t=>t.status==="Completed").length,icon:Ke,color:"#4caf50"}),e.jsx(Me,{title:"Delayed",value:s.schedule.filter(t=>t.status==="Delayed").length,icon:Ce,color:"#f44336"}),e.jsx(Me,{title:"On Track",value:s.schedule.filter(t=>t.status==="On Track").length,icon:_t,color:"#ff9800"})]}),e.jsxs("div",{className:"border rounded-lg p-2 mb-4 flex gap-2 items-center",children:[e.jsxs("div",{className:"w-64",children:[e.jsx(X,{placeholder:"Filter tasks...",value:I,onChange:t=>se(t.target.value),className:"w-full"}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(wt,{size:16})})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"})," ",e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-1 bg-gray-100 rounded-md p-1",children:[" ",e.jsx("button",{className:M("px-4 py-1 rounded-md",F==="GANTT"?"bg-blue-500 text-white":"hover:bg-gray-200"),onClick:()=>K("GANTT"),children:e.jsx(Lt,{size:18})}),e.jsx("button",{className:M("px-4 py-1 rounded-md",F==="LIST"?"bg-blue-500 text-white":"hover:bg-gray-200"),onClick:()=>K("LIST"),children:e.jsx(Ge,{size:18})}),e.jsx("button",{className:M("px-4 py-1 rounded-md",F==="RESOURCES"?"bg-blue-500 text-white":"hover:bg-gray-200"),onClick:()=>K("RESOURCES"),children:e.jsx(Oe,{size:18})}),e.jsx("button",{className:M("px-4 py-1 rounded-md",F==="CAPACITY"?"bg-blue-500 text-white":"hover:bg-gray-200"),onClick:()=>K("CAPACITY"),children:e.jsx(Dt,{size:18})}),e.jsx("button",{className:M("px-4 py-1 rounded-md",F==="MILESTONES"?"bg-blue-500 text-white":"hover:bg-gray-200"),onClick:()=>K("MILESTONES"),children:e.jsx(Fe,{size:18})})]}),e.jsxs("div",{className:"flex gap-1",children:[" ",e.jsx(me,{children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{size:"sm",variant:"outline",onClick:()=>ce("MONTH"),className:W==="MONTH"?"bg-blue-500 text-white":"",children:e.jsx(Qt,{size:16})})}),e.jsx(ge,{children:"Month View"})]})}),e.jsx(me,{children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{size:"sm",variant:"outline",onClick:()=>ce("WEEK"),className:W==="WEEK"?"bg-blue-500 text-white":"",children:e.jsx(Bt,{size:16})})}),e.jsx(ge,{children:"Week View"})]})}),e.jsx(me,{children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{size:"sm",variant:"outline",onClick:()=>ce("DAY"),className:W==="DAY"?"bg-blue-500 text-white":"",children:e.jsx(Ht,{size:16})})}),e.jsx(ge,{children:"Day View"})]})})]})]}),e.jsx("div",{className:"flex-grow"}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded bg-red-100 text-red-700 text-xs font-bold",children:[" ",e.jsx(Ce,{size:14}),"Critical Path"]})]}),F==="LIST"?e.jsxs("div",{className:"border rounded-lg overflow-hidden flex-1 bg-background",children:[" ",e.jsxs("table",{className:"w-full",children:[e.jsxs("thead",{className:"bg-accent",children:[" ",e.jsxs("tr",{children:[e.jsx("th",{className:"font-bold py-2 px-4 text-left",children:"Activity Name"})," ",e.jsx("th",{className:"font-bold py-2 px-4 text-left",children:"Schedule Range"}),e.jsx("th",{className:"font-bold py-2 px-4 text-left",children:"Inspections"}),e.jsx("th",{className:"font-bold py-2 px-4 text-left",children:"Progress"}),e.jsx("th",{className:"font-bold py-2 px-4 text-left",children:"Status"}),e.jsx("th",{className:"font-bold py-2 px-4 text-right",children:"Actions"})]})]}),e.jsx("tbody",{children:ue.map(t=>{var x;const r=G[t.id]||[];return e.jsxs("tr",{className:"hover:bg-accent/50",children:[" ",e.jsxs("td",{className:"py-2 px-4",children:[" ",e.jsxs("div",{className:"flex items-center gap-1.5",children:[" ",t.isCritical&&e.jsx(Ce,{size:14,className:"text-red-500"}),e.jsx("span",{className:"text-sm font-bold",children:t.name})," ",t.boqItemId&&e.jsxs(ee,{variant:"outline",className:"ml-1 text-xs px-2 py-1",children:["BOQ: ",((x=s.boq.find(d=>d.id===t.boqItemId))==null?void 0:x.itemNo)||"N/A"]})," "]})]}),e.jsxs("td",{className:"py-2 px-4",children:[" ",e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[" ",e.jsx(We,{size:12}),e.jsxs("span",{className:"text-xs font-medium",children:[t.startDate," — ",t.endDate]})," "]})]}),e.jsxs("td",{className:"py-2 px-4",children:[" ",r.length>0?e.jsx(me,{children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx("div",{className:"cursor-pointer",children:e.jsxs(ee,{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-bold bg-yellow-100 text-yellow-800",children:[e.jsx(Oe,{size:12}),r.length]})})}),e.jsxs(ge,{children:[r.length," Linked Inspection Requests"]})]})}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})," "]}),e.jsxs("td",{className:"py-2 px-4 w-40",children:[" ",e.jsxs("div",{className:"flex items-center gap-1.5",children:[" ",e.jsx("div",{className:"flex-1 h-1.5 rounded-full bg-gray-200 overflow-hidden",children:e.jsx("div",{className:M("h-full",t.progress===100?"bg-green-500":"bg-primary"),style:{width:`${t.progress}%`}})}),e.jsxs("span",{className:"text-xs font-bold",children:[t.progress,"%"]})," "]})]}),e.jsxs("td",{className:"py-2 px-4",children:[" ",e.jsx(ee,{className:M("text-xs font-bold px-2 py-1 border",t.status==="Completed"?"border-green-500 text-green-700":t.status==="Delayed"?"border-red-500 text-red-700":"border-blue-500 text-blue-700"),children:t.status})]}),e.jsxs("td",{className:"py-2 px-4 text-right",children:[" ",e.jsxs(P,{variant:"ghost",size:"icon",className:"p-1 mr-1",onClick:()=>Se(t),children:[" ",e.jsx(Xe,{size:16})]}),e.jsxs(P,{variant:"ghost",size:"icon",className:"p-1 text-red-500",onClick:()=>gt(t.id),children:[" ",e.jsx(Te,{size:16})]})]})]},t.id)})})]})]}):F==="RESOURCES"?e.jsxs("div",{className:"border rounded-lg overflow-hidden flex-1 bg-background",children:[" ",e.jsxs("div",{className:"p-2 border-b border-border bg-accent",children:[" ",e.jsx("h3",{className:"text-base font-bold",children:"Resource Allocation Overview"})," "]}),e.jsxs("div",{className:"p-2",children:[" ",e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[" ",e.jsxs("div",{children:[" ",e.jsx("h3",{className:"text-base font-bold mb-2",children:"Resource Allocation by Task"})," ",e.jsxs("div",{className:"border rounded-lg p-2 max-h-96 overflow-auto",children:[" ",e.jsxs(ke,{children:[e.jsx(Ie,{children:e.jsxs(te,{children:[e.jsx(p,{children:"Task"}),e.jsx(p,{children:"Resource"}),e.jsx(p,{children:"Quantity"}),e.jsx(p,{children:"Period"}),e.jsx(p,{children:"Status"})]})}),e.jsx(Ee,{children:(s.resourceAllocations||[]).map(t=>{const r=s.schedule.find(d=>d.id===t.allocatedTo),x=(s.resources||[]).find(d=>d.id===t.resourceId);return e.jsxs(te,{children:[e.jsx(p,{children:(r==null?void 0:r.name)||"Unknown Task"}),e.jsx(p,{children:(x==null?void 0:x.name)||"Unknown Resource"}),e.jsxs(p,{children:[t.allocatedQuantity," ",(x==null?void 0:x.unit)||""]}),e.jsxs(p,{children:[t.startDate," to ",t.endDate]}),e.jsx(p,{children:e.jsx(ee,{variant:"outline",className:M(t.status==="Completed"&&"border-green-500 text-green-700",t.status==="In Progress"&&"border-blue-500 text-blue-700",t.status!=="Completed"&&t.status!=="In Progress"&&"border-gray-500 text-gray-700"),children:t.status})})," "]},t.id)})})]}),(s.resourceAllocations||[]).length===0&&e.jsxs("p",{className:"text-center py-4 text-sm text-muted-foreground",children:[" ","No resource allocations found"]})]})]}),e.jsxs("div",{className:"col-span-1 md:col-span-1",children:[" ",e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Resource Availability"})," ",e.jsxs("div",{className:"border rounded-lg p-2 max-h-96 overflow-auto",children:[" ",e.jsxs(ke,{children:[e.jsx(Ie,{children:e.jsxs(te,{children:[e.jsx(p,{children:"Resource"}),e.jsx(p,{children:"Available"}),e.jsx(p,{children:"Allocated"}),e.jsx(p,{children:"Total"}),e.jsx(p,{children:"Status"})]})}),e.jsx(Ee,{children:(s.resources||[]).map(t=>{const r=(s.resourceAllocations||[]).filter(d=>d.resourceId===t.id).reduce((d,h)=>d+h.allocatedQuantity,0),x=t.totalQuantity-r;return e.jsxs(te,{children:[e.jsx(p,{children:t.name}),e.jsxs(p,{children:[x," ",t.unit]}),e.jsxs(p,{children:[r," ",t.unit]}),e.jsxs(p,{children:[t.totalQuantity," ",t.unit]}),e.jsx(p,{children:e.jsx(ee,{className:M(t.status==="Available"&&"border-green-500 text-green-700",t.status==="Allocated"&&"border-blue-500 text-blue-700",(t.status==="In Transit"||t.status==="Reserved")&&"border-orange-500 text-orange-700"),children:t.status})})," "]},t.id)})})]}),(s.resources||[]).length===0&&e.jsxs("p",{className:"text-center py-4 text-sm text-muted-foreground",children:[" ","No resources defined"]})]})]})]})]})]}):F==="CAPACITY"?e.jsxs("div",{className:"border rounded-lg overflow-hidden flex-1 bg-background",children:[" ",e.jsxs("div",{className:"p-2 border-b border-border bg-accent",children:[" ",e.jsx("h3",{className:"text-base font-bold",children:"Capacity Management"})," "]}),e.jsxs("div",{className:"p-2",children:[" ",e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[" ",e.jsxs("div",{children:[" ",e.jsx("h3",{className:"text-base font-bold mb-2",children:"Resource Capacity Utilization"})," ",e.jsxs("div",{className:"border rounded-lg p-2",children:[" ",e.jsxs(ke,{children:[e.jsx(Ie,{children:e.jsxs(te,{children:[e.jsx(p,{children:"Resource"}),e.jsx(p,{children:"Capacity"}),e.jsx(p,{children:"Utilized"}),e.jsx(p,{children:"Available"}),e.jsx(p,{children:"Utilization %"}),e.jsx(p,{children:"Status"})]})}),e.jsx(Ee,{children:(s.resources||[]).map(t=>{const r=(s.resourceAllocations||[]).filter(h=>h.resourceId===t.id).reduce((h,j)=>h+j.allocatedQuantity,0),x=t.totalQuantity-r,d=t.totalQuantity>0?Math.round(r/t.totalQuantity*100):0;return e.jsxs(te,{children:[e.jsx(p,{children:t.name}),e.jsxs(p,{children:[t.totalQuantity," ",t.unit]}),e.jsxs(p,{children:[r," ",t.unit]}),e.jsxs(p,{children:[x," ",t.unit]}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[" ",e.jsxs("div",{className:"flex-1",children:[" ",e.jsx(Ue,{value:d,className:M("h-2 rounded-md",d>90?"bg-red-500":d>75?"bg-orange-500":"bg-green-500")})]}),e.jsxs("span",{className:"text-sm font-bold",children:[d,"%"]})," "]})}),e.jsx(p,{children:e.jsx(ee,{className:M(d>90?"border-red-500 text-red-700":d>75?"border-orange-500 text-orange-700":d>50?"border-blue-500 text-blue-700":"border-green-500 text-green-700"),children:d>90?"Over Utilized":d>75?"High Utilization":d>50?"Normal":"Under Utilized"})})," "]},t.id)})})]}),(s.resources||[]).length===0&&e.jsxs("p",{className:"text-center py-4 text-sm text-muted-foreground",children:[" ","No resources defined"]})]})]}),e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Capacity Planning by Period"})," ",e.jsxs("div",{className:"border rounded-lg p-2",children:[" ",e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Visualize resource capacity over time"})," ",e.jsxs("div",{className:"h-72 flex items-center justify-center border border-dashed border-border rounded-md",children:[" ",e.jsx("p",{className:"text-base text-muted-foreground",children:"Capacity planning chart will be displayed here"})," "]})]})]})]})]})]}):F==="MILESTONES"?e.jsxs("div",{className:"border rounded-xl overflow-hidden flex-1 bg-background",children:[" ",e.jsxs("div",{className:"p-4 border-b border-border bg-accent",children:[" ",e.jsx("h3",{className:"text-lg font-bold",children:"Milestone Tracking"})," "]}),e.jsxs("div",{className:"p-4",children:[" ",e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[" ",e.jsxs("div",{children:[" ",e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[" ",e.jsx("h3",{className:"text-lg font-bold",children:"Project Milestones"})," ",e.jsxs(P,{onClick:()=>{const t={id:`milestone-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:"New Milestone",description:"Milestone description",date:new Date().toISOString().split("T")[0],status:"Planned",priority:"Medium",notes:"Add details"},r=[...s.milestones||[],t];l({...s,milestones:r})},children:[e.jsx(he,{size:16,className:"mr-2"})," Add Milestone"]})]}),e.jsxs("div",{className:"border rounded-lg p-2",children:[" ",e.jsxs(ke,{children:[e.jsx(Ie,{children:e.jsxs(te,{children:[e.jsx(p,{children:"Name"}),e.jsx(p,{children:"Description"}),e.jsx(p,{children:"Scheduled Date"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Priority"}),e.jsx(p,{children:"Progress"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(Ee,{children:(s.milestones||[]).map(t=>{const r=new Date(t.date)<new Date&&t.status!=="Completed",x=new Date(t.date)>new Date&&t.status==="Planned",d=t.status==="Completed";return e.jsxs(te,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[" ",e.jsx(Fe,{size:16,className:M(d&&"text-emerald-500",r&&"text-red-500",!d&&!r&&"text-amber-500")})," ",e.jsx("span",{className:"font-bold",children:t.name})," "]})}),e.jsx(p,{children:t.description})," ",e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[" ",e.jsx(We,{size:14}),e.jsx("span",{children:t.date})," ",r&&e.jsx(Ce,{size:14,className:"text-red-500"})," ",x&&e.jsx(Ct,{size:14,className:"text-amber-500"})," "]})}),e.jsx(p,{children:e.jsx(ee,{className:M(t.status==="Completed"&&"border-green-500 text-green-700",t.status==="Missed"&&"border-red-500 text-red-700",t.status==="Planned"&&"border-blue-500 text-blue-700"),children:t.status})})," ",e.jsx(p,{children:e.jsx(ee,{className:M(t.priority==="Critical"&&"border-red-500 text-red-700",t.priority==="High"&&"border-orange-500 text-orange-700",t.priority==="Medium"&&"border-gray-500 text-gray-700"),children:t.priority})})," ",e.jsx(p,{children:e.jsx(Ue,{value:t.status==="Completed"?100:t.status==="In Progress"?50:0,className:M("h-1.5 rounded-full w-24",t.status==="Completed"?"bg-green-500":"bg-primary")})}),e.jsxs(p,{children:[e.jsx(P,{variant:"ghost",size:"icon",onClick:()=>{const h=t.status==="Completed"?"In Progress":"Completed",j=(s.milestones||[]).map(b=>b.id===t.id?{...b,status:h,completedDate:h==="Completed"?new Date().toISOString().split("T")[0]:b.completedDate}:b);l({...s,milestones:j})},children:t.status==="Completed"?e.jsx(Ke,{size:16,className:"text-emerald-500"}):e.jsx(Xe,{size:16})}),e.jsx(P,{variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>{if(window.confirm("Are you sure you want to delete this milestone?")){const h=(s.milestones||[]).filter(j=>j.id!==t.id);l({...s,milestones:h})}},children:e.jsx(Te,{size:16})})]})]},t.id)})})]}),(s.milestones||[]).length===0&&e.jsxs("div",{className:"text-center py-4",children:[" ",e.jsx(Fe,{size:48,className:"text-gray-300"})," ",e.jsx("h3",{className:"text-lg text-muted-foreground mt-2",children:"No Milestones Defined"})," ",e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Add milestones to track important project events and achievements"})," "]})]})]})]})]})]}):e.jsxs("div",{ref:U,className:"flex-1 overflow-auto bg-background rounded-xl border border-border relative user-select-none",children:[" ",e.jsxs("div",{className:"sticky left-0 w-[250px] z-10 bg-background border-r border-border",children:[" ",e.jsxs("div",{className:"h-[70px] flex items-center px-2 border-b border-border bg-accent",children:[" ",e.jsx("span",{className:"text-xs font-bold text-muted-foreground",children:"TASK NAME"})," "]}),ue.map((t,r)=>e.jsxs("div",{className:"h-[48px] flex items-center px-2 border-b border-border hover:bg-accent cursor-pointer",onClick:()=>Se(t),children:[" ",e.jsxs("div",{className:"flex items-center gap-1 overflow-hidden",children:[" ",e.jsx("span",{className:"text-xs text-muted-foreground font-bold min-w-[20px]",children:r+1})," ",e.jsx("span",{className:M("font-bold",t.isCritical?"text-red-500":"text-primary")+" truncate flex-1",children:t.name})," ",G[t.id]&&e.jsx(me,{children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx("div",{children:e.jsx(Oe,{size:12,className:"text-amber-500 shrink-0"})})}),e.jsxs(ge,{children:[G[t.id].length," Linked RFIs"]})]})})," "]})]},t.id)),_&&e.jsxs(P,{className:"h-[48px] px-2 border-b border-border cursor-pointer text-primary transition-all duration-200 w-full justify-start hover:bg-primary/10",onClick:()=>Se(),children:[e.jsx(he,{size:16,className:"stroke-3"}),e.jsx("span",{className:"font-extrabold tracking-wider ml-1",children:"NEW ACTIVITY"})," "]})]}),e.jsxs("div",{className:"absolute top-0 left-[250px] w-full min-h-full",children:[" ",e.jsxs("div",{className:"h-[70px] bg-accent border-b border-border sticky top-0 z-10",children:[" ",e.jsx("svg",{width:B*z,height:Ze,children:q.map((t,r)=>{const x=t.getDate()===1,d=r*z;return e.jsxs("g",{children:[e.jsx("line",{x1:d,y1:0,x2:d,y2:Ze+xe,stroke:i.divider,strokeWidth:1}),z>20&&e.jsx("text",{x:d+z/2,y:55,textAnchor:"middle",fontSize:"10",fontWeight:"bold",fill:i.text.secondary,children:t.getDate()}),(x||r===0)&&e.jsxs("text",{x:d+5,y:25,fontWeight:"900",fontSize:"11",fill:i.text.secondary,children:[t.toLocaleString("default",{month:"short"}).toUpperCase()," ",t.getFullYear()]})]},r)})})]}),e.jsxs("div",{className:"relative",children:[" ",e.jsxs("svg",{width:B*z,height:xe,children:[e.jsx("defs",{children:e.jsx("pattern",{id:"progress-pattern",patternUnits:"userSpaceOnUse",width:"8",height:"8",children:e.jsx("path",{d:"M-2,2 l4,-4 M0,8 l8,-8 M6,10 l4,-4",stroke:i.primary.dark,strokeWidth:"2"})})}),e.jsx("line",{x1:Y(new Date().toISOString().split("T")[0]),y1:0,x2:Y(new Date().toISOString().split("T")[0]),y2:xe,stroke:i.error.main,strokeWidth:1,strokeDasharray:"4 2"}),ue.map((t,r)=>{var S;const x=Y(t.startDate),d=Math.max(z,Y(t.endDate)-x+z),h=r*re+re/2.5,j=re/2,b=t.isCritical?i.error.main:i.primary.main,H=t.isCritical?M("bg-red-100"):M("bg-blue-100"),V=((S=G[t.id])==null?void 0:S.length)||0;return e.jsxs("g",{className:M("gantt-bar-group",_?"cursor-grab":"cursor-default"),onMouseDown:A=>Pe(A,t.id,"MOVE"),children:[e.jsx("line",{x1:0,y1:(r+1)*re,x2:B*z,y2:(r+1)*re,stroke:i.divider,strokeWidth:1}),e.jsx("rect",{x,y:h,width:d,height:j,rx:6,fill:H}),e.jsx("rect",{x,y:h,width:d*t.progress/100,height:j,rx:6,fill:b}),e.jsx("rect",{x,y:h,width:d,height:j,rx:6,fill:"url(#progress-pattern)",opacity:.1,className:"pointer-events-none"}),e.jsx("rect",{x,y:h,width:10,height:j,fill:"transparent",className:"cursor-col-resize",onMouseDown:A=>Pe(A,t.id,"RESIZE_START")}),e.jsx("rect",{x:x+d-10,y:h,width:10,height:j,fill:"transparent",className:"cursor-col-resize",onMouseDown:A=>Pe(A,t.id,"RESIZE_END")}),V>0&&W!=="MONTH"&&e.jsxs("g",{transform:`translate(${x+4}, ${h+j/2-6})`,children:[e.jsx("rect",{width:"12",height:"12",rx:"2",fill:i.warning.main}),e.jsx("text",{x:"6",y:"9",textAnchor:"middle",fontSize:"8",fontWeight:"black",fill:"white",children:V})]}),W!=="MONTH"&&e.jsx("foreignObject",{x:x+d+8,y:h-2,width:100,height:re,children:e.jsxs("div",{className:"flex gap-1 items-center h-full",children:[" ",e.jsxs("span",{className:"text-xs font-bold text-muted-foreground",children:[t.progress,"%"]})," "]})})]},t.id)}),_&&e.jsx("line",{x1:0,y1:xe,x2:B*z,y2:xe,stroke:i.divider,strokeWidth:1})]})]})]})]}),e.jsxs(Tt,{open:c,onOpenChange:()=>m(!1),children:[" ",e.jsxs(kt,{className:"max-w-md",children:[" ",e.jsx(It,{children:e.jsx(Et,{className:"font-bold",children:n.id?"Edit Activity":"New Activity"})}),e.jsxs(Ot,{value:g,onValueChange:t=>y(t),className:"mb-3",children:[" ",e.jsxs(Ft,{children:[e.jsx(Re,{value:"0",children:"Basic"}),e.jsx(Re,{value:"1",children:"Dependencies"}),e.jsx(Re,{value:"2",children:"BOQ Linkage"}),e.jsx(Re,{value:"3",children:"Resources"})]})]}),g==="0"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[" ",e.jsx(O,{htmlFor:"task-name",children:"Name"}),e.jsx(X,{id:"task-name",value:n.name||"",onChange:t=>o({...n,name:t.target.value})})," ",e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[" ",e.jsxs("div",{children:[" ",e.jsx(O,{htmlFor:"start-date",children:"Start Date"}),e.jsx(X,{id:"start-date",type:"date",value:n.startDate||"",onChange:t=>o({...n,startDate:t.target.value})})," "]}),e.jsxs("div",{children:[" ",e.jsx(O,{htmlFor:"end-date",children:"End Date"}),e.jsx(X,{id:"end-date",type:"date",value:n.endDate||"",onChange:t=>o({...n,endDate:t.target.value})})," "]})]}),e.jsxs("div",{className:"flex flex-col",children:[" ",e.jsxs(O,{children:["Progress (",n.progress||0,"%)"]})," ",e.jsx(ft,{value:[n.progress||0],onValueChange:t=>o({...n,progress:t[0]}),max:100,step:1})," "]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[" ",e.jsx(zt,{id:"critical-path",checked:n.isCritical||!1,onCheckedChange:t=>o({...n,isCritical:t})}),e.jsx(O,{htmlFor:"critical-path",children:"Critical Path"})]}),e.jsx(O,{htmlFor:"status",children:"Status"})," ",e.jsxs(je,{value:n.status||"On Track",onValueChange:t=>o({...n,status:t}),children:[" ",e.jsx(be,{id:"status",children:e.jsx(ve,{placeholder:"Select Status"})}),e.jsxs(ye,{children:[e.jsx(L,{value:"Not Started",children:"Not Started"}),e.jsx(L,{value:"On Track",children:"On Track"}),e.jsx(L,{value:"Delayed",children:"Delayed"}),e.jsx(L,{value:"Completed",children:"Completed"})]})]})]}),g==="1"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[" ",e.jsx("h4",{className:"text-lg font-bold",children:"Task Dependencies"})," ",e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Define predecessor relationships with other tasks"})," ",(n.dependencies||[]).map((t,r)=>{const x=s.schedule.find(d=>d.id===t.taskId);return e.jsxs("div",{className:"border p-2 rounded-lg",children:[" ",e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[" ",e.jsxs("h5",{className:"text-base font-bold",children:["Dependency ",r+1]})," ",e.jsx(P,{variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>{const d=[...n.dependencies||[]];d.splice(r,1),o({...n,dependencies:d})},children:e.jsx(Te,{size:16})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[" ",e.jsxs("div",{className:"col-span-2",children:[" ",e.jsx(O,{htmlFor:`predecessor-task-${r}`,children:"Predecessor Task"})," ",e.jsxs(je,{value:t.taskId||"",onValueChange:d=>{const h=[...n.dependencies||[]];h[r]={...h[r],taskId:d},o({...n,dependencies:h})},children:[" ",e.jsx(be,{id:`predecessor-task-${r}`,children:e.jsx(ve,{placeholder:"Select Predecessor Task"})}),e.jsx(ye,{children:s.schedule.filter(d=>d.id!==n.id).map(d=>e.jsx(L,{value:d.id,children:d.name},d.id))})]})]}),e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx(O,{htmlFor:`dependency-type-${r}`,children:"Type"})," ",e.jsxs(je,{value:t.type||"FS",onValueChange:d=>{const h=[...n.dependencies||[]];h[r]={...h[r],type:d},o({...n,dependencies:h})},children:[" ",e.jsx(be,{id:`dependency-type-${r}`,children:e.jsx(ve,{placeholder:"Select Type"})}),e.jsxs(ye,{children:[e.jsx(L,{value:"FS",children:"Finish to Start (FS)"})," ",e.jsx(L,{value:"SS",children:"Start to Start (SS)"}),e.jsx(L,{value:"FF",children:"Finish to Finish (FF)"}),e.jsx(L,{value:"SF",children:"Start to Finish (SF)"})]})]})]}),e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx(O,{htmlFor:`lag-days-${r}`,children:"Lag (days)"}),e.jsx(X,{id:`lag-days-${r}`,type:"number",value:t.lag||0,onChange:d=>{const h=[...n.dependencies||[]];h[r]={...h[r],lag:Number(d.target.value)},o({...n,dependencies:h})}})," "]})]}),x&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[" ","Links: ",x.name," → ",n.name]})]},r)}),e.jsxs(P,{variant:"outline",onClick:()=>{const t={taskId:"",type:"FS",lag:0};o({...n,dependencies:[...n.dependencies||[],t]})},children:[e.jsx(he,{size:16,className:"mr-2"})," Add Dependency"]}),e.jsxs(qe,{className:"mt-2",children:[" ",e.jsx(Mt,{className:"font-bold",children:"Dependency Types:"})," ",e.jsxs(Ye,{children:[" ",e.jsxs("ul",{className:"list-disc list-inside ml-2",children:[" ",e.jsx("li",{children:"FS (Finish to Start): Current task starts after predecessor finishes"}),e.jsx("li",{children:"SS (Start to Start): Current task starts after predecessor starts"}),e.jsx("li",{children:"FF (Finish to Finish): Current task finishes after predecessor finishes"}),e.jsx("li",{children:"SF (Start to Finish): Current task finishes after predecessor starts"})]})]})]})]}),g==="2"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[" ",e.jsx("h4",{className:"text-lg font-bold",children:"BOQ Item Linkage"})," ",e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Link this activity to Bill of Quantities items"})," ",e.jsx(O,{htmlFor:"linked-boq-item",children:"Linked BOQ Item"})," ",e.jsxs(je,{value:n.boqItemId||"",onValueChange:t=>o({...n,boqItemId:t}),children:[" ",e.jsx(be,{id:"linked-boq-item",children:e.jsx(ve,{placeholder:"No BOQ Item"})}),e.jsxs(ye,{children:[e.jsx(L,{value:"",children:e.jsx("em",{children:"No BOQ Item"})})," ",s.boq.map(t=>e.jsx(L,{value:t.id,children:e.jsxs("div",{children:[" ",e.jsxs("p",{className:"text-sm font-bold",children:["[",t.itemNo,"] ",t.description.substring(0,50),t.description.length>50?"...":""]})," ",e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Rate: ",At(t.rate||0,s.settings)," per ",t.unit]})," "]})},t.id))]})]}),n.boqItemId&&e.jsxs(qe,{className:"mt-2",children:[" ",e.jsxs(Ye,{children:[" ","This activity is linked to BOQ item:",(Qe=s.boq.find(t=>t.id===n.boqItemId))==null?void 0:Qe.itemNo," -",($e=s.boq.find(t=>t.id===n.boqItemId))==null?void 0:$e.description.substring(0,60),"..."]})]})]}),g==="3"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[" ",e.jsx("h4",{className:"text-lg font-bold",children:"Resource Allocation"})," ",e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Allocate resources to this activity"})," ",e.jsxs("div",{children:[" ",e.jsx("h5",{className:"text-base font-bold mb-1",children:"Assigned Resources"})," ",e.jsxs("div",{className:"border p-2 rounded-lg",children:[" ",e.jsxs("div",{className:"flex flex-col gap-2",children:[" ",(s.resourceAllocations||[]).filter(t=>t.allocatedTo===n.id).map(t=>{const r=(s.resources||[]).find(x=>x.id===t.resourceId);return e.jsxs("div",{className:"flex justify-between items-center p-1 border border-border rounded-md",children:[" ",e.jsxs("div",{children:[" ",e.jsx("p",{className:"text-sm font-bold",children:(r==null?void 0:r.name)||"Unknown Resource"})," ",e.jsxs("p",{className:"text-xs text-muted-foreground",children:[" ","Quantity: ",t.allocatedQuantity," ",r==null?void 0:r.unit," | Period: ",t.startDate," to ",t.endDate]})]}),e.jsx(P,{variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>{const x=(s.resourceAllocations||[]).filter(d=>d.id!==t.id);l({...s,resourceAllocations:x})},children:e.jsx(Te,{size:16})})]},t.id)}),(s.resourceAllocations||[]).filter(t=>t.allocatedTo===n.id).length===0&&e.jsxs("p",{className:"text-sm text-muted-foreground text-center py-2",children:[" ","No resources allocated to this task"]})]})]})]}),e.jsxs("div",{children:[" ",e.jsx("h5",{className:"text-base font-bold mb-1",children:"Add New Resource"})," ",e.jsxs("div",{className:"border p-2 rounded-lg",children:[" ",e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[" ",e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx(O,{htmlFor:"resource-select",children:"Resource"})," ",e.jsxs(je,{value:w,onValueChange:t=>f(t),children:[" ",e.jsx(be,{id:"resource-select",children:e.jsx(ve,{placeholder:"Select Resource"})}),e.jsx(ye,{children:(s.resources||[]).filter(t=>t.totalQuantity>0).map(t=>{var r,x,d;return e.jsx(L,{value:t.id,children:e.jsxs("div",{children:[" ",e.jsx("p",{className:"text-sm font-bold",children:t.name})," ",e.jsxs("p",{className:"text-xs text-muted-foreground",children:[" ","Available: ",t.totalQuantity-(((r=s.resourceAllocations)==null?void 0:r.filter(h=>h.resourceId===t.id).reduce((h,j)=>h+j.allocatedQuantity,0))||0)," ",t.unit," | Cost: ",Pt(((x=s.settings)==null?void 0:x.currency)||"USD")," ",(d=t.unitCost)==null?void 0:d.toLocaleString(),"/",t.unit]})]})},t.id)})})]})]}),e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx(O,{htmlFor:"resource-quantity",children:"Quantity"}),e.jsx(X,{id:"resource-quantity",type:"number",value:v,onChange:t=>k(Number(t.target.value)),min:0})," "]}),e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx(O,{htmlFor:"resource-start-date",children:"Start Date"}),e.jsx(X,{id:"resource-start-date",type:"date",value:E,onChange:t=>C(t.target.value)})," "]}),e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx(O,{htmlFor:"resource-end-date",children:"End Date"}),e.jsx(X,{id:"resource-end-date",type:"date",value:T,onChange:t=>D(t.target.value)})," "]}),e.jsxs("div",{className:"col-span-2",children:[" ",e.jsx(O,{htmlFor:"resource-notes",children:"Notes"}),e.jsx(X,{id:"resource-notes",value:$,onChange:t=>R(t.target.value)})," "]})]}),e.jsxs(P,{className:"mt-2 w-full",disabled:!w||v<=0||!E||!T,onClick:()=>{var t;if(n.id){const r={id:`alloc-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,resourceId:w,resourceType:((t=(s.resources||[]).find(d=>d.id===w))==null?void 0:t.type)||"Material",allocatedTo:n.id,allocatedQuantity:v,startDate:E,endDate:T,status:"Planned",notes:$},x=[...s.resourceAllocations||[],r];l({...s,resourceAllocations:x}),f(""),k(0),C(""),D(""),R("")}},children:[e.jsx(he,{size:16,className:"mr-2"})," Allocate Resource"]})]})]})]})]}),e.jsxs(Rt,{className:"p-3",children:[" ",e.jsx(P,{variant:"outline",onClick:()=>{m(!1),o({}),y("0")},children:"Cancel"})," ",e.jsxs(P,{onClick:pt,children:[" ",e.jsx(Vt,{size:18,className:"mr-2"})," Save Activity"]})]})]})]})};export{ks as default};
