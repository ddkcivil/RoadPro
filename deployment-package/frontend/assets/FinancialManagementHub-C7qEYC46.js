import{c as ie,r,j as e,B as o,l as ce,N as q,n as l,m as de,aL as oe,t as n,o as H,p as U,$ as xe,v as A,w as I,x as c,y as a,z as k,A as t,O as F,ag as R,u as E,I as $,V as he,W as me,X as je,Y as ue,Z as ge}from"./index-CewaSTRD.js";import{f as x}from"./exportUtils-B5u6ZY-6.js";import{T as fe,a as Ne,b as S,c as w}from"./tabs-b2piEQ7z.js";import{R as G}from"./receipt-DojscuDk.js";import{P as Q}from"./printer-DtXb5IMq.js";import{P as W}from"./pen-DxURiB25.js";import"./currencyUtils-RmnVW5tT.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=ie("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]]),Ue=({project:h,settings:d,onProjectUpdate:pe,userRole:ve})=>{var L,M,z;const[X,Y]=r.useState("overview"),[Se,we]=r.useState(null),[ye,Z]=r.useState(!1),[Te,Ce]=r.useState({billNumber:"",date:new Date().toISOString().split("T")[0],dateOfMeasurement:new Date().toISOString().split("T")[0],orderOfBill:(((L=h.contractBills)==null?void 0:L.length)||0)+1,items:[],provisionalSum:0,cpaAmount:0,liquidatedDamages:0}),[Be,J]=r.useState(!1),[Pe,Ae]=r.useState({billNumber:"",subcontractorId:"",description:"",netAmount:0,grossAmount:0,date:new Date().toISOString().split("T")[0],periodFrom:"",periodTo:"",status:"Draft",retentionPercent:0,items:[]}),[y,K]=r.useState(""),[Ie,ke]=r.useState(null),[T,_]=r.useState("all"),[C,ee]=r.useState(""),[Fe,se]=r.useState(!1),[Re,Oe]=r.useState({voNumber:`VO-${(((M=h.variationOrders)==null?void 0:M.length)||0)+1}`,title:"",date:new Date().toISOString().split("T")[0],reason:"",items:[]}),v=h.contractBills||[],m=h.subcontractorBills||[],u=h.rfis||[],g=h.variationOrders||[],te=((z=h.agencies)==null?void 0:z.filter(s=>s.type==="subcontractor"))||[],f=r.useMemo(()=>{const s=h.boq||[],i=s.reduce((b,j)=>b+j.quantity*j.rate,0),p=s.reduce((b,j)=>b+(j.variationQuantity||0)*j.rate,0),N=i+p,O=v.reduce((b,j)=>b+(j.totalAmount||0),0),re=m.reduce((b,j)=>b+(j.netAmount||0),0);return{originalContract:i,variations:p,revisedContract:N,totalBilled:O,totalSubBilled:re,balanceToBill:N-O,paymentPercentage:N>0?O/N*100:0}},[h.boq,v,m]),B=r.useMemo(()=>({total:u.length,pending:u.filter(s=>s.status==="Pending").length,approved:u.filter(s=>s.status==="Approved").length,rejected:u.filter(s=>s.status==="Rejected").length}),[u]),P=r.useMemo(()=>({total:g.length,approved:g.filter(s=>s.status==="Approved").length,pending:g.filter(s=>s.status==="Pending").length,totalValue:g.reduce((s,i)=>s+(i.totalAmount||0),0)}),[g]),V=r.useMemo(()=>u.filter(s=>{var N;const i=s.title.toLowerCase().includes(y.toLowerCase())||((N=s.description)==null?void 0:N.toLowerCase().includes(y.toLowerCase())),p=T==="all"||s.taskId===T;return i&&p}),[u,y,T]),D=r.useMemo(()=>g.filter(s=>s.title.toLowerCase().includes(C.toLowerCase())||s.reason.toLowerCase().includes(C.toLowerCase())),[g,C]),le=()=>{Z(!0)},ae=()=>{J(!0)},ne=()=>{se(!0)};return e.jsxs("div",{className:"p-4 h-[calc(100vh-140px)] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between mb-6 items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Financial Management Hub"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Unified billing, RFI, and variation order management"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",onClick:le,children:[e.jsx(G,{className:"mr-2 h-4 w-4"})," New Contract Bill"]}),e.jsxs(o,{variant:"outline",onClick:ae,children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," New Sub Bill"]}),e.jsxs(o,{onClick:ne,children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," New Variation"]})]})]}),e.jsx(l,{children:e.jsxs(fe,{value:X,onValueChange:Y,children:[e.jsxs(Ne,{className:"grid w-full grid-cols-5 h-12",children:[e.jsxs(S,{value:"overview",children:[e.jsx(de,{className:"mr-2 h-4 w-4"})," Overview"]}),e.jsxs(S,{value:"contract-bills",children:[e.jsx(G,{className:"mr-2 h-4 w-4"})," Contract Bills (",v.length,")"]}),e.jsxs(S,{value:"sub-bills",children:[e.jsx(be,{className:"mr-2 h-4 w-4"})," Sub Bills (",m.length,")"]}),e.jsxs(S,{value:"rfis",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"})," RFIs (",u.length,")"]}),e.jsxs(S,{value:"variations",children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," Variations (",g.length,")"]})]}),e.jsxs(w,{value:"overview",className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Original Contract"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:x(f.originalContract,d)})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Variations"}),e.jsx("p",{className:"text-2xl font-bold text-amber-500",children:x(f.variations,d)})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Revised Contract"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:x(f.revisedContract,d)})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Payment Progress"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[f.paymentPercentage.toFixed(1),"%"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(l,{children:[e.jsx(H,{children:e.jsx(U,{children:"Contract Billing"})}),e.jsxs(n,{children:[e.jsx(xe,{value:f.paymentPercentage,className:"mb-4"}),e.jsxs("p",{className:"text-sm",children:["Billed: ",x(f.totalBilled,d)]}),e.jsxs("p",{className:"text-sm",children:["Balance: ",x(f.balanceToBill,d)]})]})]}),e.jsxs(l,{children:[e.jsx(H,{children:e.jsx(U,{children:"Subcontractor Payments"})}),e.jsxs(n,{children:[e.jsx("p",{className:"text-3xl font-bold text-indigo-600",children:x(f.totalSubBilled,d)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Subcontractor Payments"})]})]})]})]}),e.jsxs(w,{value:"contract-bills",className:"p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Contract Bills"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Interim Payment Certificates and contract billing records"}),e.jsx(l,{children:e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(c,{children:[e.jsx(a,{children:"Bill Number"}),e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Status"}),e.jsx(a,{className:"text-right",children:"Actions"})]})}),e.jsx(k,{children:v.length>0?v.map(s=>e.jsxs(c,{children:[e.jsx(t,{className:"font-medium",children:s.billNumber}),e.jsx(t,{children:new Date(s.date).toLocaleDateString()}),e.jsx(t,{className:"font-bold",children:x(s.totalAmount||0,d)}),e.jsx(t,{children:e.jsx(F,{variant:"default",className:"bg-green-100 text-green-700",children:"Generated"})}),e.jsxs(t,{className:"text-right",children:[e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(R,{className:"h-4 w-4"})})]})]},s.id)):e.jsx(c,{children:e.jsx(t,{colSpan:5,className:"h-48 text-center text-muted-foreground",children:"No contract bills found."})})})]})})]}),e.jsxs(w,{value:"sub-bills",className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Total Bills"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:m.length})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Paid"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>s.status==="Paid").length})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-amber-500",children:m.filter(s=>s.status==="Pending").length})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:x(m.reduce((s,i)=>s+(i.netAmount||0),0),d)})]})})]}),e.jsx(l,{children:e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(c,{children:[e.jsx(a,{children:"Subcontractor"}),e.jsx(a,{children:"Bill Number"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Period"}),e.jsx(a,{className:"text-right",children:"Actions"})]})}),e.jsx(k,{children:m.length>0?m.map(s=>{const i=te.find(p=>p.id===s.subcontractorId);return e.jsxs(c,{children:[e.jsx(t,{className:"font-medium",children:(i==null?void 0:i.name)||"Unknown"}),e.jsx(t,{children:s.billNumber}),e.jsx(t,{className:"font-bold",children:x(s.netAmount||0,d)}),e.jsx(t,{children:e.jsx(F,{variant:s.status==="Paid"?"default":s.status==="Pending"?"secondary":"outline",className:s.status==="Paid"?"bg-green-100 text-green-700":s.status==="Pending"?"bg-amber-100 text-amber-700":"",children:s.status})}),e.jsxs(t,{children:[new Date(s.periodFrom).toLocaleDateString()," - ",new Date(s.periodTo).toLocaleDateString()]}),e.jsxs(t,{className:"text-right",children:[e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(R,{className:"h-4 w-4"})})]})]},s.id)}):e.jsx(c,{children:e.jsx(t,{colSpan:6,className:"h-48 text-center text-muted-foreground",children:"No subcontractor bills found."})})})]})})]}),e.jsxs(w,{value:"rfis",className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Total RFIs"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:B.total})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-amber-500",children:B.pending})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:B.approved})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:B.rejected})]})})]}),e.jsx(l,{className:"mb-6",children:e.jsxs(n,{className:"p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto flex-grow",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx($,{placeholder:"Search RFIs...",value:y,onChange:s=>K(s.target.value),className:"pl-10 w-full"})]}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsxs(he,{value:T,onValueChange:_,children:[e.jsx(me,{className:"w-full",children:e.jsx(je,{placeholder:"All Tasks"})}),e.jsx(ue,{children:e.jsx(ge,{value:"all",children:"All Tasks"})})]})})]})}),e.jsx(l,{children:e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(c,{children:[e.jsx(a,{children:"RFI Number"}),e.jsx(a,{children:"Title"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Date"}),e.jsx(a,{className:"text-right",children:"Actions"})]})}),e.jsx(k,{children:V.length>0?V.map(s=>{var i;return e.jsxs(c,{children:[e.jsxs(t,{className:"font-medium",children:["RFI-",(i=s.id)==null?void 0:i.slice(0,6)]}),e.jsx(t,{children:s.title}),e.jsx(t,{children:e.jsx(F,{variant:s.status==="Approved"?"default":s.status==="Pending"?"secondary":"destructive",className:s.status==="Approved"?"bg-green-100 text-green-700":s.status==="Pending"?"bg-amber-100 text-amber-700":"",children:s.status})}),e.jsx(t,{children:new Date(s.date).toLocaleDateString()}),e.jsxs(t,{className:"text-right",children:[e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(W,{className:"h-4 w-4"})})]})]},s.id)}):e.jsx(c,{children:e.jsx(t,{colSpan:5,className:"h-48 text-center text-muted-foreground",children:"No RFIs found."})})})]})})]}),e.jsxs(w,{value:"variations",className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Total Variations"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:P.total})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:P.approved})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-amber-500",children:P.pending})]})}),e.jsx(l,{children:e.jsxs(n,{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:x(P.totalValue,d)})]})})]}),e.jsx(l,{className:"mb-6",children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx($,{placeholder:"Search variations...",value:C,onChange:s=>ee(s.target.value),className:"pl-10 w-full"})]})})}),e.jsx(l,{children:e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(c,{children:[e.jsx(a,{children:"VO Number"}),e.jsx(a,{children:"Title"}),e.jsx(a,{children:"Reason"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Status"}),e.jsx(a,{className:"text-right",children:"Actions"})]})}),e.jsx(k,{children:D.length>0?D.map(s=>e.jsxs(c,{children:[e.jsx(t,{className:"font-medium",children:s.voNumber}),e.jsx(t,{children:s.title}),e.jsx(t,{children:s.reason}),e.jsx(t,{className:"font-bold",children:x(s.totalAmount||0,d)}),e.jsx(t,{children:e.jsx(F,{variant:s.status==="Approved"?"default":"secondary",className:s.status==="Approved"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700",children:s.status||"Pending"})}),e.jsxs(t,{className:"text-right",children:[e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(W,{className:"h-4 w-4"})})]})]},s.id)):e.jsx(c,{children:e.jsx(t,{colSpan:6,className:"h-48 text-center text-muted-foreground",children:"No variation orders found."})})})]})})]})]})})]})};export{Ue as default};
