# Apache Configuration for RoadPro on dharmadkunwar.com.np

# Enable required modules
# a2enmod rewrite headers proxy proxy_http

<VirtualHost *:80>
    ServerName dharmadkunwar.com.np
    ServerAlias www.dharmadkunwar.com.np
    
    # Document root for frontend files
    DocumentRoot /var/www/html
    
    # API proxy configuration
    ProxyPreserveHost On
    ProxyPass /api/ http://localhost:3001/api/
    ProxyPassReverse /api/ http://localhost:3001/api/
    
    # Frontend routing for SPA
    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Enable rewrite engine for SPA routing
        RewriteEngine On
        
        # Don't rewrite API requests
        RewriteCond %{REQUEST_URI} !^/api/
        
        # Don't rewrite existing files
        RewriteCond %{REQUEST_FILENAME} !-f
        
        # Don't rewrite existing directories
        RewriteCond %{REQUEST_FILENAME} !-d
        
        # Rewrite all other requests to index.html
        RewriteRule ^(.*)$ /index.html [L]
    </Directory>
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/roadpro_error.log
    CustomLog ${APACHE_LOG_DIR}/roadpro_access.log combined
</VirtualHost>

# SSL Configuration (if using HTTPS)
# <VirtualHost *:443>
#     ServerName dharmadkunwar.com.np
#     # ... same configuration as above ...
#     
#     SSLEngine on
#     SSLCertificateFile /path/to/your/certificate.crt
#     SSLCertificateKeyFile /path/to/your/private.key
# </VirtualHost>